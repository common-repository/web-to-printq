/**
 * Created By CloudLab AG
 */
isVML=function(){return"undefined"!=typeof G_vmlCanvasManager},fabric.isInRotateMode=!1
var extendObjectPrototypeMobile={borderOpacityWhenMoving:1,borderScaleFactor:.5,borderColor:"rgba(255,255,255,0.75)",cornerColor:"rgba(255,255,255,0.75)",cornerSize:40,drawControls:function(t,e){if(!this.hasControls)return this
this.cornerSize=fabric.windowWidth<400?70:this.cornerSize,this.cornerSize=fabric.windowWidth>400&&fabric.windowWidth<1200?40:this.cornerSize
var i=this._calculateCurrentDimensions(!0),a=i.x,n=i.y,o=-(a/2),s=-(n/2),r=(this.padding/this.scaleX,this.padding/this.scaleY,this.cornerSize/2),c=(this.transparentCorners?"strokeRect":"fillRect",this.isScaling?this.cornerSize:this.cornerSize/10+13)
if("undefined"!=typeof e.viewport&&(e.viewport[0]<1||e.viewport[3]<1)){var l=e.viewport[0]>e.viewport[3]?e.viewport[3]:e.viewport[0]
c=this.cornerSize*l/1.7}return t.save(),t.lineWidth=1,fabric.isInRotateMode?this.hasRotatingPoint&&t.drawImage(fabric.rotateImage,o+a/2-r,s-this.rotatingPointOffset-r,this.cornerSize,this.cornerSize):(t.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,t.strokeStyle=t.fillStyle=this.cornerColor,this.isScaling&&"bottom"==e.originY&&"right"==e.originX||!this.isScaling?this._drawRoundControl("tl",t,"arc",o,s,c,!1):this._drawRoundControl("tl",t,"arc",o,s,3,!0),this.isScaling&&"bottom"==e.originY&&"left"==e.originX||!this.isScaling?this._drawRoundControl("tr",t,"arc",o+a,s,c,!1):this._drawRoundControl("tr",t,"arc",o+a,s,3,!0),this.isScaling&&"top"==e.originY&&"right"==e.originX||!this.isScaling?this._drawRoundControl("bl",t,"arc",o,s+n,c,!1):this._drawRoundControl("bl",t,"arc",o,s+n,3,!0),this.isScaling&&"top"==e.originY&&"left"==e.originX||!this.isScaling?this._drawRoundControl("br",t,"arc",o+a,s+n,c,!1):this._drawRoundControl("br",t,"arc",o+a,s+n,3,!0),this.get("lockUniScaling")||((this.isScaling&&"bottom"==e.originY&&"center"==e.originX||!this.isScaling)&&a>150?this._drawRoundControl("mt",t,"arc",o+a/2,s,c,!1):this._drawRoundControl("mt",t,"arc",o+a/2,s,3,!0),(this.isScaling&&"top"==e.originY&&"center"==e.originX||!this.isScaling)&&a>150?this._drawRoundControl("mb",t,"arc",o+a/2,s+n,c,!1):this._drawRoundControl("mb",t,"arc",o+a/2,s+n,3,!0),(this.isScaling&&"center"==e.originY&&"left"==e.originX||!this.isScaling)&&(a>150||"textbox"==this.type)?this._drawRoundControl("mr",t,"arc",o+a,s+n/2,c,!1):this._drawRoundControl("mr",t,"arc",o+a,s+n/2,3,!0),(this.isScaling&&"center"==e.originY&&"right"==e.originX||!this.isScaling)&&(a>150||"textbox"==this.type)?this._drawRoundControl("ml",t,"arc",o,s+n/2,c,!1):this._drawRoundControl("ml",t,"arc",o,s+n/2,3,!0))),t.restore(),this},drawBorders:function(t){if(!this.hasBorders)return this
t.save(),t.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,t.strokeStyle=this.borderColor,t.lineWidth=1/this.borderScaleFactor
var e=this._calculateCurrentDimensions(!0),i=e.x,a=e.y
return this.group&&(i*=this.group.scaleX,a*=this.group.scaleY),t.strokeRect(~~-(i/2),~~-(a/2),~~i,~~a),t.restore(),this},_findTargetCorner:function(t){if(!this.hasControls||!this.active)return!1
var e,i,a=t.x,n=t.y
for(var o in this.oCoords)if(this.isControlVisible(o)&&("mtr"!==o||this.hasRotatingPoint)&&("mtr"!==o||fabric.isInRotateMode)&&(!this.get("lockUniScaling")||"mt"!==o&&"mr"!==o&&"mb"!==o&&"ml"!==o)&&(!fabric.isInRotateMode||"bl"!==o&&"br"!==o&&"mb"!==o&&"ml"!==o&&"mr"!==o&&"mt"!==o&&"tl"!==o&&"tr"!==o)&&(i=this._getImageLines(this.oCoords[o].corner),e=this._findCrossPoints({x:a,y:n},i),0!==e&&e%2===1))return this.__corner=o,o
return!1},_drawRoundControl:function(t,e,i,a,n,o,s){this.isControlVisible(t)&&(this.cornerSize,isVML()||this.transparentCorners,e.beginPath(),e.fillStyle=fabric.ColorBorders,e[i](a,n,o,0,2*Math.PI,!1),e.fill(),e.closePath(),s||(e.beginPath(),e.fillStyle="#ffffff",e[i](a,n,o/2,0,2*Math.PI,!1),e.fill(),e.closePath()))}},extendObjectPrototypePC={borderOpacityWhenMoving:.5,borderScaleFactor:1,borderColor:"rgba(153, 209, 34, 0.75)",cornerColor:"rgba(153, 209, 34, 0.75)",cornerSize:10,drawControls:function(t,e){if(!this.hasControls)return this
var i=this._calculateCurrentDimensions(!0),a=i.x,n=i.y,o=-(a/2),s=-(n/2),r=this.cornerSize/2,c=this.transparentCorners?"strokeRect":"fillRect"
return t.save(),t.lineWidth=1,t.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,t.strokeStyle=t.fillStyle=this.cornerColor,this._drawControl("tl",t,c,o-r,s-r),this._drawControl("tr",t,c,o+a-r,s-r),this._drawControl("bl",t,c,o-r,s+n-r),this._drawControl("br",t,c,o+a-r,s+n-r),this.get("lockUniScaling")||(this._drawControl("mt",t,c,o+a/2-r,s-r),this._drawControl("mb",t,c,o+a/2-r,s+n-r),this._drawControl("mr",t,c,o+a-r,s+n/2-r),this._drawControl("ml",t,c,o-r,s+n/2-r)),this.hasRotatingPoint&&this._drawControl("mtr",t,c,o+a/2-r,s-this.rotatingPointOffset-r),t.restore(),this},drawBorders:function(t){if(!this.hasBorders)return this
t.save(),t.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,t.strokeStyle=this.borderColor,t.lineWidth=1/this.borderScaleFactor
var e=this._calculateCurrentDimensions(!0),i=e.x,a=e.y
if(this.group&&(i*=this.group.scaleX,a*=this.group.scaleY),t.strokeRect(~~-(i/2),~~-(a/2),~~i,~~a),this.hasRotatingPoint&&this.isControlVisible("mtr")&&!this.get("lockRotation")&&this.hasControls){var n=-a/2
t.beginPath(),t.moveTo(0,n),t.lineTo(0,n-this.rotatingPointOffset),t.closePath(),t.stroke()}return t.restore(),this},_findTargetCorner:function(t){if(!this.hasControls||!this.active)return!1
var e,i,a=t.x,n=t.y
for(var o in this.oCoords)if(this.isControlVisible(o)&&("mtr"!==o||this.hasRotatingPoint)&&(!this.get("lockUniScaling")||"mt"!==o&&"mr"!==o&&"mb"!==o&&"ml"!==o)&&(i=this._getImageLines(this.oCoords[o].corner),e=this._findCrossPoints({x:a,y:n},i),0!==e&&e%2===1))return this.__corner=o,o
return!1},_drawRoundControl:function(t,e,i,a,n,o,s){return!1}},extendITextPrototypeMobile={editable:!0,enterEditing:function(){return this.isEditing||!this.editable?void this.canvas.fire("text:editing:entered",{target:this}):(this.canvas&&this.exitEditingOnOthers(this.canvas),this.isEditing=!0,this.curvedText||(this.initHiddenTextarea(),this.hiddenTextarea.focus(),this._updateTextarea()),this._tick(),this.fire("editing:entered"),this.canvas?(this.canvas.renderAll(),this.canvas.fire("text:editing:entered",{target:this}),this.initMouseMoveHandler(),this):this)},_isObjectMoved:function(t){var e=this.canvas.getPointer(t)
return Math.abs(this.__mousedownX-e.x)>2||Math.abs(this.__mousedownY-e.y)>2},onMouseDown:function(t){this.__newClickTime=+new Date
var e=this.canvas.getPointer(t.e)
this.isTripleClick(e)?(this.fire("tripleclick",t),this._stopEvent(t.e)):this.isDoubleClick(e)&&(this.fire("dblclick",t),this._stopEvent(t.e))},isDoubleClick:function(t){return this.__newClickTime-this.__lastClickTime<500},initHiddenTextarea:function(){this.hiddenTextarea=fabric.document.createElement("div"),this.hiddenTextarea.setAttribute("contenteditable","true"),this.hiddenTextarea.setAttribute("class","fabric_edit_text"),this.hiddenTextarea.setAttribute("type","text"),fabric.document.body.appendChild(this.hiddenTextarea),fabric.util.addListener(this.hiddenTextarea,"keydown",this.enterTextOnObject.bind(this)),!this._clickHandlerInitialized&&this.canvas&&(fabric.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0)},enterTextOnObject:function(t){this.isEditing&&13==t.keyCode&&(this.text=this.hiddenTextarea.innerText.replace(/^\s+|\s+$/g,""),t.stopImmediatePropagation(),t.preventDefault(),this.canvas&&this.exitEditingOnOthers(this.canvas),this.canvas&&this.canvas.renderAll())},_updateTextarea:function(){if(this.hiddenTextarea){for(var t="",e=0;e<this._textLines.length;e++)t=t+this._textLines[e]+" </br>"
this.hiddenTextarea.innerHTML=t
var i=this.hiddenTextarea.firstChild,a=document.createRange()
a.setStart(i,this.hiddenTextarea.textContent.length),a.setEnd(i,this.hiddenTextarea.textContent.length)
var n=window.getSelection()
n.removeAllRanges(),n.addRange(a)}},initClicks:function(){this.on("tripleclick",function(t){this.selectLine(this.getSelectionStartFromPointer(t.e))})}},extendITextPrototypePC={editable:!0,enterEditing:function(){return this.isEditing||!this.editable?void this.canvas.fire("text:editing:entered",{target:this}):(this.canvas&&this.exitEditingOnOthers(this.canvas),this.isEditing=!0,this.curvedText||(this.initHiddenTextarea(),this.hiddenTextarea.focus(),this._updateTextarea(),this._saveEditingProps(),this._setEditingProps()),this._tick(),this.fire("editing:entered"),this.canvas?(this.canvas.renderAll(),this.canvas.fire("text:editing:entered",{target:this}),this.initMouseMoveHandler(),this):this)},_isObjectMoved:function(t){var e=this.canvas.getPointer(t)
return this.__mousedownX!==e.x||this.__mousedownY!==e.y},onMouseDown:function(t){this.__newClickTime=+new Date
var e=this.canvas.getPointer(t.e)
this.isTripleClick(e)?(this.fire("tripleclick",t),this._stopEvent(t.e)):this.isDoubleClick(e)&&(this.fire("dblclick",t),this._stopEvent(t.e)),this.__lastLastClickTime=this.__lastClickTime,this.__lastClickTime=this.__newClickTime,this.__lastPointer=e,this.__lastIsEditing=this.isEditing,this.__lastSelected=this.selected},isDoubleClick:function(t){return this.__newClickTime-this.__lastClickTime<500&&this.__lastPointer.x===t.x&&this.__lastPointer.y===t.y&&this.__lastIsEditing},initHiddenTextarea:function(){this.hiddenTextarea=fabric.document.createElement("textarea"),this.hiddenTextarea.setAttribute("autocapitalize","off"),this.hiddenTextarea.style.cssText="position: fixed; bottom: 20px; left: 0px; opacity: 0; width: 0px; height: 0px; z-index: -999;",fabric.document.body.appendChild(this.hiddenTextarea),fabric.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this)),fabric.util.addListener(this.hiddenTextarea,"input",this.onInput.bind(this)),fabric.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this)),fabric.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this)),!this._clickHandlerInitialized&&this.canvas&&(fabric.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0)},enterTextOnObject:function(t){return!1},_updateTextarea:function(){this.hiddenTextarea&&(this.hiddenTextarea.value=this.text,this.hiddenTextarea.selectionStart=this.selectionStart,this.hiddenTextarea.selectionEnd=this.selectionEnd)},initClicks:function(){this.on("dblclick",function(t){this.selectWord(this.getSelectionStartFromPointer(t.e))}),this.on("tripleclick",function(t){this.selectLine(this.getSelectionStartFromPointer(t.e))})}}
!function(t){t.widget("printq.persMobileToolbar",t.printq.persBaseWidget,{version:"1.0.0",defaultElement:null,elements:{},state:null,fontSizeUnit:1,previousState:[],sliderOpacity:[],currentActionInfo:[],confirmPanelButtons:[],effectToolBarMobile:[],saveProjectFrameMobile:[],layoutsContainerMobile:[],shapesContainerMobile:[],backgroundsContainerMobile:[],layoutsMobileItem:[],shapesMobileItem:[],backgroundsMobileItem:[],subItemFonts:[],subItemDecoration:[],subItemColors:[],subItemAlign:[],color_group:[],shapeItemMobileTemplate:[],shapesMobileGalleryList:[],mask:[],active:"active",effectItemTemplate:'<li class="group"> <a href="javascript:void(0)" class="mainItem"> <div><div class="imageholder_effect"></div><span class="title">{effectName}</span></div></a></li>',uploadTrigger:[],fineuploader:[],options:{prefix:"ppmt-",states:["text","open","images","edit","effects","transparency","layouts","pagination","shapes","backgrounds","position_edit","transparency_edit","preview","block_options","color_edit","fonts_edit","align_edit","fontsize_edit","crop_edit","filters_edit","shape_edit","pages","decoration_edit","freeDrawing","line_width","colorsDrawing","editText_mode","effect_edit","save_project","load_project","sidebar_open","category-shape"],classes:{def:"ppmt",open:"open"},sliderOpacity:".transparency_slider_mobile",currentActionInfo:".current_action_info",confirmPanelButtons:"#editorBottomBarContainerMobile .confirmPanel li",effectToolBarMobile:".effectToolBarMobile",saveProjectFrameMobile:"#saveProjectFrameMobile",effectsList:["Original","Grayscale","Sepia2","Invert","Sepia","Emboss","Sharpen","Blur"],layoutsContainerMobile:".layoutsContainerMobile",shapesContainerMobile:".shapesContainerMobile",backgroundsContainerMobile:".backgroundsContainerMobile",layoutsMobileItem:".layoutsMobileItem",shapesMobileItem:".shapesMobileItem",backgroundsMobileItem:".backgroundsMobileItem",fineuploader:"#editorTopbarContainerMobile .fineuploader",uploadTrigger:'#editorTopbarContainerMobile #pqd-upload-button input[type="file"]',mask:"#loading-mask",subItemFonts:".mobileDefaultMainToolbar.subItemFonts",subItemDecoration:".mobileDefaultMainToolbar.subItemDecoration",subItemColors:".mobileDefaultMainToolbar.subItemtextColors",subItemAlign:".mobileDefaultMainToolbar.subItemAlign",color_group:".defaultToolbarMobile .color_group",shapeItemMobileTemplate:"#shapeItemMobileTemplate",shapesMobileGalleryList:".shapesMobileGalleryList",open:function(t,e){},changeState:function(t,e){},toggleState:function(t,e){}},_O:function(t){return this.options[t]},_create:function(){if(this.element){var e=this._O("classes")
this.element.toggleClass(e.def,!0),this._on(this.element.find(".clickAction"),{click:function(e){var i=t(e.currentTarget),a=i.data("action"),n=i.data("state")||!1
switch(a){case"changeState":if(n){var o=this.getElement("currentActionInfo"),s=canvas.getActiveObject()||canvas.getActiveGroup()
o.html(translateStrings[n]),this.beforeChangeStateObserver({state:n,object:s}),this.changeState(n)}break
case"font_edit":var s=canvas.getActiveObject()||canvas.getActiveGroup()
that.runHooks("beforeChangeStateObserver",{state:n,object:s})
break
case"color_edit":var s=canvas.getActiveObject()||canvas.getActiveGroup()
that.runHooks("beforeChangeStateObserver",{state:n,object:s})
break
case"undo":undo()
break
case"redo":redo()
break
case"rotate_edit":fabric.isInRotateMode=!fabric.isInRotateMode,canvas.renderAll(),fabric.isInRotateMode?i.find("label").html(translateStrings.rotateOn):i.find("label").html(translateStrings.rotateOff)}}}),this.connectHooks(),this.init()}},changeState:function(t,e){var i=this._O("states"),a=(this._O("footerPanels"),this._O("prefix"))
this.element.toggleClass(a+i.join(" "+a),!1),e||this.previousState.push(this.state),this.state=t,this.element.toggleClass(a+t,!0),this._trigger("changeState",this,{state:t})},toggleState:function(t,e){e="undefined"==e?1:e||0
var i=(this._O("states"),this._O("prefix"))
this.state=e?t:null,this.element.toggleClass(i+t,e),this._trigger("toggleState",this,{state:t,status:e})},beforeChangeStateObserver:function(t){var e=t.state,i=t.object
if(confirmPanelButtons=this.getElement("confirmPanelButtons"),e)switch(e){case"fonts_edit":confirmPanelButtons.data("editEditorOptions",{objectOptions:{fontFamily:i.getFontFamily()},object:i})
var a=this.getElement("subItemFonts")
o=a.find("li[data-state='"+i.getFontFamily()+"']"),a.find("a").removeClass(this.active),o.find("a").addClass(this.active)
break
case"fontsize_edit":confirmPanelButtons.data("editEditorOptions",{objectOptions:{fontSize:i.getFontSize()},object:i})
break
case"align_edit":confirmPanelButtons.data("editEditorOptions",{objectOptions:{textAlign:i.getTextAlign()},object:i})
var n=this.getElement("subItemAlign"),o=n.find("li[data-state='"+i.getTextAlign()+"']")
n.find("a").removeClass(this.active),o.find("a").addClass(this.active)
break
case"decoration_edit":confirmPanelButtons.data("editEditorOptions",{objectOptions:{fontWeight:i.getFontWeight(),fontStyle:i.getFontStyle(),textDecoration:i.getTextDecoration()},object:i})
var s=this.getElement("subItemDecoration"),r=s.find("li[data-state='"+i.getFontWeight()+"']"),c=s.find("li[data-state='"+i.getFontStyle()+"']"),l=s.find("li[data-state='"+i.getTextDecoration()+"']")
s.find("a").removeClass(this.active),r.find("a").addClass(this.active),"italic"===i.getFontStyle()&&c.find("a").addClass(this.active),l.find("a").addClass(this.active)
break
case"transparency_edit":confirmPanelButtons.data("editEditorOptions",{objectOptions:{opacity:i.getOpacity()},object:i})
break
case"effect_edit":confirmPanelButtons.data("editEditorOptions",{objectOptions:{filters:i.filters},object:i})
break
case"color_edit":var h="#000000"
if(["text","i-text","textbox"].indexOf(i.type)<0){var d=i.getObjects()[0]
d&&(h=d.fill)}else h=i.getFill()
confirmPanelButtons.data("editEditorOptions",{objectOptions:{fill:h,fillColorId:i.fillColorId},object:i})
var u=this.getElement("subItemColors"),g=u.find("a[data-colorid='"+i.fillColorId+"']")
u.find("a").removeClass(this.active),g.addClass(this.active)
break
case"category-shape":this.getShapes(t.action)}},getShapes:function(e){var i=this.getElement("shapesMobileGalleryList")
i.html(""),t.printqAjaxRequest.postRequest({url:getShapesUrl,mask:"",data:{offset:0,category:e},onComplete:function(e){return function(i){if(i.success&&"undefined"!=typeof i.shapes&&i.shapes.length){var a=e.getElement("shapeItemMobileTemplate").html(),n=e.getElement("shapesMobileGalleryList")
t.each(i.shapes,function(e,a,n){return function(o,s){var r="shape_"+Math.random().toString(36).substring(5),c=t(a)
c.addClass(r),c.data("shapeUrl",shapeUrlLocation+i.category+s),c.find("a").off("click").on("click",function(e){return function(a){var n=t(a.currentTarget)
t(".shapesMobileItem").removeClass("active"),n.addClass("active"),n.data("shapeUrl"),e.clearConfirmPanelButtons()
var o=e.getElement("confirmPanelButtons")
o.data("actionsEditorOptions",{actionType:"shape",url:shapeUrlLocation+i.category+s})}}(e)),n.append(c),t("<img/>").attr("src",shapeUrlLocation+i.category+s).load(function(t,e,a){return function(){var a=e.find("li."+t)
a.removeClass("empty"),a.find("a").css({"background-image":"url("+shapeUrlLocation+i.category+s+")"}),a.removeClass(t)}}(r,n,e))}}(e,a,n)),e.lockGetShapes=!1}}}(this),onFail:function(t){return function(){alert(translateStrings.error),t.lockGetShapes=!1}}(this)})},afterSelectObject:function(t){if(t){var e=t.object.type,i=t.ppmt
switch(e){case"image":i.changeState("image")
break
case"text":i.changeState("text")
break
case"i-text":i.changeState("text")
break
case"textbox":i.changeState("text")
break
default:i.changeState("general")}}},afterClearSelection:function(t){t&&t.hasOwnProperty("ppmt")&&t.ppmt.changeState("open")},connectHooks:function(){},initTextActions:function(){this._on(this.element.find(".clickTextAction"),{click:function(e){var i=t(e.currentTarget),a=i.data("action"),n=i.data("state")||!1,o=canvas.getActiveObject()
switch(a){case"changeState":if(n){var s=this.getElement("currentActionInfo")
s.html(translateStrings[n]),this.changeState(n),this.beforeChangeStateObserver({state:n,object:o}),"transparency_edit"===n&&this.setDefaultTransparency()}break
case"font":o.set("fontFamily",n)
var r=this.getElement("subItemFonts")
r.find("a").removeClass(this.active),i.find("a").addClass(this.active),canvas.renderAll()
break
case"fontsizeIncrease":var c=parseInt(o.getFontSize())
c+this.fontSizeUnit<120&&(o.set("fontSize",c+this.fontSizeUnit),canvas.renderAll())
break
case"fontsizeDecrease":var c=parseInt(o.getFontSize())
c-this.fontSizeUnit>1&&(o.set("fontSize",c-this.fontSizeUnit),canvas.renderAll())
break
case"position":this.runHooks("positionChange",n)
break
case"decoration":var l=this.getElement("subItemDecoration"),h=l.find("li[data-state='bold']"),d=l.find("li[data-state='italic']"),u=l.find("li[data-state='underline']"),g=l.find("li[data-state='normal']")
switch(n){case"italic":o.setFontStyle("italic"),d.find("a").toggleClass(this.active),g.find("a").removeClass(this.active),canvas.renderAll()
break
case"bold":o.setFontWeight("bold"),h.find("a").toggleClass(this.active),g.find("a").removeClass(this.active),canvas.renderAll()
break
case"normal":o.setFontWeight("normal"),o.setFontStyle("normal"),o.setTextDecoration(""),l.find("a").removeClass(this.active),h.find("a").removeClass(this.active),u.find("a").removeClass(this.active),g.find("a").addClass(this.active),canvas.renderAll()
break
case"underline":o.setTextDecoration("underline"),u.find("a").toggleClass(this.active),g.find("a").removeClass(this.active),canvas.renderAll()}break
case"align":if(["left","right","center","justify"].indexOf(n)>-1){o.setTextAlign(n)
var f=this.getElement("subItemAlign")
f.find("a").removeClass(this.active)
var p=f.find("li[data-state='"+n+"']")
p.find("a").addClass(this.active),canvas.renderAll()}break
case"change-color":var b=i.data("colorid"),v=i.data("color"),m=this.getElement("subItemColors")
o.set("fill",v),o.set("fillColorId",b),m.find("a").removeClass(this.active),i.addClass(this.active),canvas.renderAll()
break
case"duplicate":this.runHooks("cloneObject")}}})},initFooterActions:function(){this._on(this.element.find(".clickActionFooter"),{click:function(e){var i=t(e.currentTarget),a=i.data("state")||!1
switch(a){case"delete":customConfirm(translateStrings.areYouSure,function(t){return function(){t.runHooks("deleteObject")}}(this),function(){})
break
case"edit":var n=canvas.getActiveObject()||canvas.getActiveGroup()
if(n){var o=n.type
"text"!==o&&"textbox"!==o&&"i-text"!==o||n.fire("mouseup",{e:e})}this.changeState("editText_mode",!1)
break
case"release":this.runHooks("clearSelection"),this.changeState("open",!0)
break
case"confirm":if(this.confirmChangers(),"layouts"!=this.state&&"backgrounds"!=this.state&&"shapes"!=this.state||this.changeState("open",!0),"category-shape"==this.state)this.changeState("shape_edit")
else{var s=this.previousState.pop()
this.changeState(s,!0)}break
case"notConfirm":if(this.notConfirmChangers(),"layouts"==this.state||"backgrounds"==this.state||"shapes"==this.state)this.changeState("open",!0)
else{var s=this.previousState.pop()
this.changeState(s,!0)}}}}),canvas.on("text:editing:entered",function(t){return function(e){var i=e.target
i&&!i.curvedText&&"editText_mode"!==t.state&&t.changeState("editText_mode",!0)}}(this))},initImagesActions:function(){this._on(this.element.find(".clickImageAction"),{click:function(e){var i=t(e.currentTarget),a=i.data("action"),n=i.data("state")||!1,o=canvas.getActiveObject()
switch(a){case"changeState":if(n){var s=this.getElement("currentActionInfo")
s.html(translateStrings[n]),this.changeState(n),"effect_edit"===n&&(this.beforeChangeStateObserver({state:n,object:o}),this.populateEffects()),"transparency_edit"===n&&(this.beforeChangeStateObserver({state:n,object:o}),this.setDefaultTransparency())}break
case"duplicate":this.runHooks("cloneObject")}}})},initDefaultActions:function(){this._on(this.element.find(".clickDefaultAction"),{click:function(e){var i=t(e.currentTarget),a=i.data("action"),n=i.data("state")||!1,o=canvas.getActiveObject()
switch(a){case"changeState":if(n){var s=this.getElement("currentActionInfo")
s.html(translateStrings[n]),this.changeState(n),a="category-shape"==n&&i.data("category"),"transparency_edit"!==n&&"color_edit"!==n&&"category-shape"!==n||(this.beforeChangeStateObserver({state:n,object:o,action:a}),"transparency_edit"==n&&this.setDefaultTransparency())}break
case"duplicate":this.runHooks("cloneObject")
break
case"confirm-change":this.changeState("open",!0)
break
case"notConfirm-change":this.changeState("open",!0)
break
case"movable_changer":fabric.lockMovable=!fabric.lockMovable,t(i).parent().toggleClass("active")
break
case"resize_changer":fabric.lockResizable=!fabric.lockResizable,t(i).parent().toggleClass("active")
break
case"rotate_changer":fabric.lockRotation=!fabric.lockRotation,t(i).parent().toggleClass("active")
break
case"snap_changer":this.runHooks("onOffSnap"),t(i).parent().toggleClass("active")}}})},initTopBarActions:function(){this._on(this.element.find(".clickActionTopBar"),{click:function(e){var i=t(e.currentTarget),a=i.data("action"),n=i.data("state")||!1
switch(a){case"changeState":n&&this.changeState(n)
break
case"add_text":this.runHooks("addTextBoxInCanvas")
break
case"add_image":var o=this.getElement("uploadTrigger")
o.trigger("click")
break
case"add_to_cart":this.runHooks("addToCart",!0)
break
case"changeText":this.changeState("text",!0)
var s=t(".fabric_edit_text").text()
canvas.getActiveObject().setText(s),canvas.renderAll(),fabric.IText.prototype.exitEditingOnOthers(canvas),t(".fabric_edit_text").remove(),canvas.fire("text:editing:exited")
break
case"notChangeText":this.changeState("text",!0),fabric.IText.prototype.exitEditingOnOthers(canvas),t(".fabric_edit_text").remove(),canvas.fire("text:editing:exited"),canvas.renderAll()}}})},initSideBarActions:function(){this._on(this.element.find(".clickActionSideBar"),{click:function(e){var i=t(e.currentTarget),a=i.data("action"),n=i.data("state")||!1
switch(a){case"changeState":if(n){var o=this.getElement("currentActionInfo"),s=canvas.getActiveObject()||canvas.getActiveGroup()
o.html(translateStrings[n]),this.beforeChangeStateObserver({state:n,object:s}),this.changeState(n)}break
case"back_sidebar":var n=this.previousState.pop()
this.changeState(n,!0)
break
case"back_page":this.runHooks("goBack")
break
case"save_project_action":var r=this.getElement("saveProjectFrameMobile")
this.runHooks("saveProject",r)
break
case"delete_project":customConfirm(translateStrings.confirmDeleteProjectText,function(t,e){return function(){var i=parseInt(e.parent().find('input[name="projectId"]').val())
t.runHooks("deleteProject",i)}}(this,i),function(t){return function(){t.preventDefault()}}(e))
break
case"load_project":var c=t(i),l=parseInt(c.parent().find('input[name="projectId"]').val())
this.runHooks("loadProject",l,{callback:function(t){return function(){var e=t.previousState.pop()
t.changeState(e,!0)}}(this)})
break
case"add_page":this.runHooks("addPage"),setTimeout(function(e){return function(){var i=e.runHooks("getCurrentPageIndex")
e.runHooks("resetPagination",i+1),t.editorCustomPagination.init({page:i+1}),e.changeState("open",!0)}}(this),100)
break
case"delete_page":this.runHooks("deletePageDesigner"),this.changeState("open",!0)}}})},initGeneralActions:function(){this._on(this.element.find(".clickActionGeneral"),{click:function(e){var i=t(e.currentTarget),a=i.data("action"),n=i.data("state")||!1
switch(a){case"changeState":if(n){var o=this.getElement("currentActionInfo")
o.html(translateStrings[n]),this.changeState(n)}break
case"change-layout":var s=this.getElement("layoutsMobileItem")
s.removeClass("active"),i.addClass("active")
var r=i.data("id")
this.clearConfirmPanelButtons()
var c=this.getElement("confirmPanelButtons")
c.data("actionsEditorOptions",{actionType:"layout",ID:r})
break
case"change-background":var l=this.getElement("backgroundsMobileItem")
l.removeClass("active"),i.addClass("active")
var h=i.data("id")
this.clearConfirmPanelButtons()
var c=this.getElement("confirmPanelButtons")
c.data("actionsEditorOptions",{actionType:"background",ID:h})
break
case"change-shape":var d=this.getElement("shapesMobileItem")
d.removeClass("active"),i.addClass("active")
var u=i.data("id")
this.clearConfirmPanelButtons()
var c=this.getElement("confirmPanelButtons")
c.data("actionsEditorOptions",{actionType:"shape",ID:u})}}})},clearConfirmPanelButtons:function(){var t=this.getElement("confirmPanelButtons")
t.removeData()},initFineUploader:function(){var e=this.getElement("fineuploader"),i=this.getElement("mask"),a=t.printqUniqueId({prefix:"loading_",sufix:"uploadMobileImage",length:6}),n=e.fineUploader({request:{endpoint:uploadUserPhotoUrl,params:{id:"randomid",createThumbnail:1,sid:uploadPhotoDirName,width:"auto",height:150,other_infos:{type:"editorUpload"},createWorkingImage:1,quality:90}},autoUpload:!0,debug:!1,multiple:!1,text:{uploadButton:"mobile",dragZone:"mobile"},validation:{allowedExtensions:e.attr("data-validate")?[e.attr("data-validate")]:["jpeg","jpg","png","gif"]},template:"pqd_qq_uploader",fileTemplate:"pqd_qq_uploader",showMessage:function(t){alert(t,"warning")}}).on("upload",function(e,i,a){return function(){t.q(a).prinqLoading("start",i)}}(this,a,i)).on("complete",function(e,i,a){return function(n,o,s,r){if(r.hasOwnProperty("success")&&r.success){var c,l
c=r.working_image?r.working_image:r.src,l=r.thumbnail?r.thumbnail:r.src,fabric.Image.fromURL(c,function(e,i,a,n,o){return function(s){var r=canvas.getCenter()
s.set({originX:"center",originY:"center",designerOptions:{type:"image",workingImage:c,originalWidth:e.other_infos.size.width,originalHeight:e.other_infos.size.height,actualWidth:s.width,actualHeight:s.height,imageName:e.path},thumbnail:i}),s.set({left:r.left,top:r.top}),s=a.resizeImage(s),canvas.insertAt(s,canvas.getObjects().length-canvas.helpersInCanvas,!1),a.runHooks("pushUndoData",[{objectID:s.objectID,added:s,type:"image"}]),a.runHooks("updateIframe"),t.q(o).prinqLoading("stop",n)}}(r,l,e,i,a))}else t.q(a).prinqLoading("stop",i),alert(errorMsgTxt,"error")}}(this,a,i)).on("fail",function(e,i){return function(){t.q(i).prinqLoading("stop",e)}}(a,i))
this.getElement("uploadTrigger").on("change",function(e){return function(){t(e).fineUploader("addFiles",this.files)}}(n))},resizeImage:function(t){var e=400,i=400,a=0,n=t.width,o=t.height
return n>e&&(a=e/n,t.width=e,t.height=o*a,o*=a,n*=a),o>i&&(a=i/o,t.height=i,t.width=n*a,n*=a),t},initCanvasObserver:function(){canvas.on("object:selected",function(e){return function(i){var a=i.target
if(a)switch(t("body").addClass("showActionsPanel"),a.type){case"image":e.changeState("images")
break
case"text":e.changeState("text")
break
case"textbox":e.changeState("text")
break
case"i-text":e.changeState("text")
break
default:if(["text","i-text","textbox"].indexOf(a.type)<0){var n=e.getElement("color_group")
"function"==typeof a.isSameColor&&a.isSameColor()?n.show():n.hide()}e.changeState("shape_edit")}}}(this)),canvas.on("selection:cleared",function(e){return function(i){t("body").removeClass("showActionsPanel"),"pagination"!==e.state&&e.changeState("open",!0)}}(this))},confirmChangers:function(){var e=this.getElement("confirmPanelButtons"),i=e.data("editEditorOptions"),a=e.data("actionsEditorOptions")
if(newStage={},i&&i.objectOptions&&(t.each(i.objectOptions,function(t,e){newStage[t]=i.object[t]}),this.runHooks("pushUndoData",[{objectID:i.object.objectID,oldStage:i.objectOptions,newStage:newStage}])),a)switch(a.actionType){case"background":var n=a.ID
this.runHooks("setBackgroundImage",n)
break
case"layout":a.ID&&a.ID!=themePageContent[0].theme_id&&this.runHooks("loadLayout",a.ID)
break
case"shape":var o=a.url
this.runHooks("loadShapeMobile",o)}this.clearConfirmPanelButtons()},notConfirmChangers:function(){var e,i,a=this.getElement("confirmPanelButtons"),n=a.data("editEditorOptions"),o=a.data("actionsEditorOptions")
if(n&&(i=n.object.objectID,e=canvas.getObjectByID(i)[0],e&&n.objectOptions&&(t.each(n.objectOptions,function(t,i){e.set(t,i),"filters"===t&&e.applyFilters(function(){canvas.renderAll()})}),canvas.renderAll())),o)switch(o.actionType){case"layout":this.runHooks("makeActualLayoutSelected",parseInt(themePageContent[0].theme_id))
break
case"background":this.runHooks("makeBackgroundImageSelected")
break
case"shape":var s=this.getElement("shapesMobileItem")
s.removeClass("active")}this.clearConfirmPanelButtons()},setDefaultTransparency:function(){var t=canvas.getActiveObject()||canvas.getActiveGroup()
opacity=t.getOpacity(),this.checkSliderOpacity()&&this.sliderOpacity.slider("value",100*opacity)},checkSliderOpacity:function(){return this.sliderOpacity.length?"undefined"!=typeof this.slider.data("uiSlider")||"undefined"!=typeof this.slider.data("ui-slider")||(this.createSliderOpacity(),!0):(this.createSliderOpacity(),!0)},createSliderOpacity:function(){this.slider=this.getElement("sliderOpacity",!0),this.slider.slider({slide:function(e){return function(e,i){t(this).data("ui-slider"),canvas.getActiveGroup()&&canvas.getActiveGroup().setOpacity(i.value/100),canvas.getActiveObject()&&canvas.getActiveObject().setOpacity(i.value/100),canvas.renderAll()}}(this)})},populateEffects:function(){var e,i=canvas.getActiveObject(),a=new Image,n=document.createElement("canvas"),o=n.getContext("2d"),s=this.getElement("effectToolBarMobile")
i&&"image"==i.type&&(s.find("ul").html(""),a.onload=function(s){return function(){n.width=.5*a.naturalWidth,n.height=.5*a.naturalHeight,t.each(s._O("effectsList"),function(s){return function(r,c){o.clearRect(0,0,n.width,n.height),o.drawImage(a,0,0,n.width,n.height)
var l=o.getImageData(0,0,n.width,n.height)
"Emboss"==c||"Sharpen"==c||"Blur"==c?(l.filterName=c,e=t.printqFiltersFunctions.Convolute(l)):e="function"==typeof t.printqFiltersFunctions[c]?t.printqFiltersFunctions[c](l):l,o.putImageData(e,0,0),s.createEffectElement({effectName:c,image:n.toDataURL(),block:i})}}(s))}}(this),a.src=i._originalElement.src)},createEffectElement:function(e){var i=this.getElement("effectToolBarMobile"),a=this.effectItemTemplate
a=a.replace("{effectName}",e.effectName),a=t(a),t(a).find(".imageholder_effect").css({"background-image":'url("'+e.image+'")'}),"Original"===e.filterName?t(a).off("click.Add").on("click.Add",function(t,e){return function(){t.runHooks("setOriginalFilter",{block:e.block,filterName:e.effectName})}}(this,e)):t(a).off("click.Add").on("click.Add",function(t,e){return function(){t.runHooks("setFilterToImage",{block:e.block,filterName:e.effectName})}}(this,e)),i.find("ul").append(t(a)),i.printqPositioning()},init:function(){this.initGeneralActions(),this.initTextActions(),this.initImagesActions(),this.initDefaultActions(),this.initFooterActions(),this.initTopBarActions(),this.initSideBarActions(),this.initCanvasObserver(),this.initFineUploader()}})}(window.jQuery),!function(t){var e=t.editorCustomPagination={id:"contentManagerPagination",pagesContainer:"#subcontent #edit_tab div.pages",version:"1.0",defaults:{target:"#customPagination",format:"< (q -) nnncn (- p) >",totalElements:0,page:1,perpage:1,onSelect:function(){},onClickCallback:function(i){var a=e.runHooks("getCurrentPageIndex"),n=parseInt(t(i).data("page"))-1
a!=n&&(t("body").removeClass("loading_canvas"),e.runHooks("getCanvasPageForPreview",a),e.runHooks("setCurrentPageIndex",n),e.runHooks("loadCanvas",themePageContent[n]))},onFormat:function(t){var e=this.active?"":"disabled",i=this.value!=this.page?"":"current active"
switch(t){case"block":return'<li class="'+e+i+'"><a href="#'+this.value+'">'+this.value+"</a></li>"
case"left":return this.page-this.value<=3||5==this.page&&5==this.pages?"":'<li class="'+i+'"><a href="#'+this.value+'">'+this.value+"</a></li>"
case"right":return this.value-this.page<=1||this.value<=5?"":'<li class="'+i+'"><a href="#'+this.value+'">'+this.value+"</a></li>"
case"next":return'<li class=" '+e+'"><a href="#'+this.value+'">></a></li>'
case"prev":return'<li class=" '+e+'"><a href="#'+this.value+'"><</a></li>'
case"leap":return""
case"fill":return this.active?'<li class="fill"><a>...</a></li>':""}}}}
t.extend(e,{_O:function(i){var a=t.extend(!0,{},e.defaults)
return t.extend(!0,a,i)},connectHooks:function(){},init:function(t){e.connectHooks(),e.create(t)},create:function(i){var a=e._O(i),n=t.q(a.target)
if(n.length){var o=themePageContent.length
n.paging(o||a.totalElements,{format:a.format,perpage:a.perpage,lapping:0,page:a.page,onClickCallback:a.onClickCallback,onSelect:a.onSelect,onFormat:a.onFormat})}},addHook:function(t,i){printqPluggable.PluginHooks.add(t,i,e)},addHookOnce:function(t,i){printqPluggable.PluginHooks.once(t,i,e)},removeHook:function(t,i){printqPluggable.PluginHooks.remove(t,i,e)},runHooks:function(t,i,a,n,o,s,r){return printqPluggable.PluginHooks.run(e,t,i,a,n,o,s,r)}})}(window.jQuery),!function(t){var e=t.editorPreviewCustomPagination={version:"1.0",defaults:{target:"#customPreviewPagination",format:"< (q -) nnncn (- p) >",totalElements:0,page:1,perpage:1,onSelect:function(){},onClickCallback:function(i){var a=parseInt(t(i).data("page"))-1
e.runHooks("changePagePreview",a)},onFormat:function(t){var e=this.active?"":"disabled",i=this.value!=this.page?"":"current active"
switch(t){case"block":return'<li class="'+e+i+'"><a href="#'+this.value+'">'+this.value+"</a></li>"
case"left":return this.page-this.value<=3||5==this.page&&5==this.pages?"":'<li class="'+i+'"><a href="#'+this.value+'">'+this.value+"</a></li>"
case"right":return this.value-this.page<=1||this.value<=5?"":'<li class="'+i+'"><a href="#'+this.value+'">'+this.value+"</a></li>"
case"next":return'<li class=" '+e+'"><a href="#'+this.value+'">></a></li>'
case"prev":return'<li class=" '+e+'"><a href="#'+this.value+'"><</a></li>'
case"leap":return""
case"fill":return this.active?'<li class="fill"><a>...</a></li>':""}}}}
t.extend(e,{_O:function(i){var a=t.extend(!0,{},e.defaults)
return t.extend(!0,a,i)},connectHooks:function(){},init:function(t){e.connectHooks(),e.create(t)},create:function(i){var a=e._O(i),n=t.q(a.target)
if(n.length){var o=themePageContent.length
n.paging(o||a.totalElements,{format:a.format,perpage:a.perpage,lapping:0,page:a.page,onClickCallback:a.onClickCallback,onSelect:a.onSelect,onFormat:a.onFormat})}},addHook:function(t,i){printqPluggable.PluginHooks.add(t,i,e)},addHookOnce:function(t,i){printqPluggable.PluginHooks.once(t,i,e)},removeHook:function(t,i){printqPluggable.PluginHooks.remove(t,i,e)},runHooks:function(t,i,a,n,o,s,r){return printqPluggable.PluginHooks.run(e,t,i,a,n,o,s,r)}})}(window.jQuery),!function(t){var e=t.printqFabricHandlers={}
t.extend(e,{defaults:{},getDefaults:function(i){return t.extend(e.defaults,i)},addHook:function(t,i,a){printqPluggable.PluginHooks.add(t,i,e,a)},addHookOnce:function(t,i,a){printqPluggable.PluginHooks.once(t,i,e,a)},removeHook:function(t,i,a){printqPluggable.PluginHooks.remove(t,i,e,a)},addGlobalHook:function(t,e,i){printqPluggable.PluginHooks.add(t,e,!1,i)},runHooks:function(t,i,a,n,o,s,r){return printqPluggable.PluginHooks.run(e,t,i,a,n,o,s,r)},connectHooks:function(){},init:function(){fabric.imageRotateSource=fabricRotateUrl,fabric.rotateImage=new Image,fabric.rotateImage.src=fabric.imageRotateSource,window.innerWidth>900?(fabric.util.object.extend(fabric.Object.prototype,extendObjectPrototypePC),fabric.util.object.extend(fabric.IText.prototype,extendITextPrototypePC)):(fabric.util.object.extend(fabric.Object.prototype,extendObjectPrototypeMobile),fabric.util.object.extend(fabric.IText.prototype,extendITextPrototypeMobile)),t(window).on("resize",function(){clearTimeout(resizeWindowFabricID),resizeWindowFabricID=setTimeout(function(){window.innerWidth<900?(fabric.util.object.extend(fabric.Object.prototype,extendObjectPrototypeMobile),fabric.util.object.extend(fabric.IText.prototype,extendITextPrototypeMobile),e.runHooks("closeOthers"),"tdpreview"==previewType&&(t("#tdIframe").css({display:"none"}),t("#edit_tab, #preview_tab").css({width:"100%"})),canvas.renderAll()):(fabric.util.object.extend(fabric.Object.prototype,extendObjectPrototypePC),fabric.util.object.extend(fabric.IText.prototype,extendITextPrototypePC),"tdpreview"==previewType&&(t("#tdIframe").css({display:"inline-block"}),t("#edit_tab, #preview_tab").css({width:"60%"})),canvas.renderAll())},100)})}})}(window.jQuery),window.jQuery(document).ready(function(t){t("body").persMobileToolbar(),t.printqFabricHandlers.init()
var e=t("body").persMobileToolbar("instance")
e.changeState("open",!0)})
