"use strict"
function magicResize(e,t){var a,n,o,i,r=canvas.getWidth(),s=canvas.getHeight(),c=r/s,l=e*t/c/(r*s),d=canvas.getObjects()
canvas.setWidth(e),canvas.setHeight(t),d.forEach(function(e,t){a=e.getWidth()*l/c,n=e.getHeight()*l/c,o=e.getLeft()*l/c,i=e.getTop()*l/c,e.set("width",a),e.set("height",n),e.set("left",o),e.set("top",i),e.setCoords()}),canvas.renderAll()}var themePageContent=[],canvas,canvasOffsetHeight=0,canvasOffsetWidth=0,canvasScale=1,tempCanvas,resizeWindowID,resizeWindowFabricID,drawTextBox=!1,propertiesToIncludeCanvas=["objectID","width","height","lockMovementX","lockMovementY","lockRotation","hasControls","selectable","lockScalingX","lockScalingY","lockUniScaling","setHelper","setBlocker","designerOptions","cropObjectData","thumbnail"]
!function(e){var t=e.printqDetectDevice=function(){}
e.extend(t,{defaults:{},_O:function(t){return e.extend({},ODD.defaults,t)},init:function(){t.connectHooks()
var e=setInterval(function(){"undefined"!=typeof WhichBrowser&&clearInterval(e)},100)},connectHooks:function(){},addHook:function(e,t,a){printqPluggable.PluginHooks.add(e,t,ODSE,a)},addHookOnce:function(e,t,a){printqPluggable.PluginHooks.once(e,t,ODSE,a)},removeHook:function(e,t,a){printqPluggable.PluginHooks.remove(e,t,ODSE,a)},addGlobalHook:function(e,t,a){printqPluggable.PluginHooks.add(e,t,!1,a)},runHooks:function(e,t,a,n,o,i,r){return printqPluggable.PluginHooks.run(ODSE,e,t,a,n,o,i,r)},onAfterWhichBrowserDetectHookCallback:function(){}})}(window.jQuery),!function(e){var t=e.designerStartEditor={}
e.extend(t,{defaults:{droppable:"#edit_tab #canvasAreaDesigner .droppable",tempCanvas:".tempCanvas",containerCanvas:"#edit_tab div#canvasAreaDesigner",designerMaxWidth:1200,designerMaxHeight:800,loadProjectFrame:"#loadProjectFrame",zoomTextContainer:".zoom_text_group",goBackEditor:"#close",backgroundImageColorContainer:".backgroundImageColors",saveProjectAdminButton:".savePersonalization",optionsFreeDrawing:{},textBox:null,adjustDimensionsCanvas:40},getDefaults:function(a){return e.extend(t.defaults,a)},addHook:function(e,a,n){printqPluggable.PluginHooks.add(e,a,t,n)},addHookOnce:function(e,a,n){printqPluggable.PluginHooks.once(e,a,t,n)},removeHook:function(e,a,n){printqPluggable.PluginHooks.remove(e,a,t,n)},addGlobalHook:function(e,t,a){printqPluggable.PluginHooks.add(e,t,!1,a)},runHooks:function(e,a,n,o,i,r,s){return printqPluggable.PluginHooks.run(t,e,a,n,o,i,r,s)},connectHooks:function(){t.addGlobalHook("loadCanvas",t.loadCanvas),t.addGlobalHook("getCanvasPageForPreview",t.getCanvasPageForPreview),t.addGlobalHook("updateSizeAndPositionBackground",t.updateSizeAndPositionBackground),t.addGlobalHook("deleteObject",t.deleteObject),t.addGlobalHook("cloneObject",t.cloneObject),t.addGlobalHook("groupObjects",t.groupObjects),t.addGlobalHook("unGroupObjects",t.unGroupObjects),t.addGlobalHook("addPage",t.addPage),t.addGlobalHook("deletePage",t.deletePage),t.addGlobalHook("addCurvedText",t.addCurvedText),t.addGlobalHook("addTextBox",t.addTextBox),t.addGlobalHook("disableAddTextBox",t.disableAddTextBox),t.addGlobalHook("disableCurvedText",t.disableCurvedText),t.addGlobalHook("saveProject",t.saveProject),t.addGlobalHook("deleteProject",t.deleteProject),t.addGlobalHook("loadProject",t.loadProject),t.addGlobalHook("zoomIn",t.zoomIn),t.addGlobalHook("zoomOut",t.zoomOut),t.addGlobalHook("calculateInitialZoom",t.calculateInitialZoom),t.addGlobalHook("mouseZoomInit",t.mouseZoomInit),t.addGlobalHook("clearSelection",t.clearSelection),t.addGlobalHook("confirmTextEditMobile",t.confirmTextEditMobile),t.addGlobalHook("notConfirmTextEditMobile",t.notConfirmTextEditMobile),t.addGlobalHook("addTextBoxInCanvas",t.addTextBoxInCanvas),t.addGlobalHook("goBack",t.goBack),t.addGlobalHook("resetLoadProjectFrameButtons",t.resetLoadProjectFrameButtons)},confirmTextEditMobile:function(e){var a=canvas.getActiveObject()
if(a&&["text","i-text","textbox"].indexOf(a.type)>-1){var n=a.text
a.text=e.text(),canvas.renderAll(),fabric.IText.prototype.exitEditingOnOthers(canvas),e.remove(),canvas.fire("text:editing:exited"),t.runHooks("pushUndoData"[{objectID:a.objectID,oldStage:{text:n},newStage:{text:a.text}}])}},notConfirmTextEditMobile:function(e){fabric.IText.prototype.exitEditingOnOthers(canvas),e.remove(),canvas.fire("text:editing:exited"),canvas.renderAll()},disableAddTextBox:function(){var a=t.getDefaults()
canvas.defaultCursor="default",canvas.selection=!0,e(a.droppable).off("mouseup.addTextBox")},disableCurvedText:function(){var a=t.getDefaults()
canvas.defaultCursor="default",canvas.selection=!0,e(a.droppable).off("mouseup.addCurvedText")},addCurvedText:function(a){var n=t.getDefaults()
t.disableAddTextBox(),canvas.defaultCursor="crosshair",canvas.selection=!1,e(n.droppable).off("mouseup.addCurvedText").on("mouseup.addCurvedText",function(a){return function(n){var o,i=canvas.getPointer(n)
o=new fabric.IText("Double click to change text",{fontSize:21,curvedText:!0,radius:100,spacing:3,reverse:!1,textAlign:"left",vAlign:"top",fill:"#000000",width:200,height:100,originX:"center",originY:"center",fontFamily:"Roboto",left:i.x,top:i.y,opacity:1}),t.runHooks("pushUndoData",[{added:o,objectID:o.objectID}]),canvas.insertAt(o,canvas.getObjects().length-canvas.helpersInCanvas,!1),canvas.setActiveObject(o),t.runHooks("updateIframe"),e(this).off("mouseup.addCurvedText"),canvas.defaultCursor="default",canvas.selection=!0,"function"==typeof a&&a()}}(a))},addTextBox:function(a){var n=t.getDefaults()
t.disableCurvedText(),canvas.defaultCursor="crosshair",canvas.selection=!1,e(n.droppable).off("mouseup.addTextBox").on("mouseup.addTextBox",function(a){return function(n){var o,i=canvas.getPointer(n)
o=new fabric.Textbox("Double click to change text",{fontSize:24,textAlign:"left",vAlign:"top",fill:"#000000",width:200,height:200,originX:"center",originY:"center",fontFamily:"Roboto",left:i.x,top:i.y,opacity:1}),t.runHooks("pushUndoData",[{added:o,objectID:o.objectID}]),canvas.insertAt(o,canvas.getObjects().length-canvas.helpersInCanvas,!1),canvas.setActiveObject(o),t.runHooks("updateIframe"),e(this).off("mouseup.addTextBox"),canvas.defaultCursor="default",canvas.selection=!0,"function"==typeof a&&a()}}(a))},observeDrawTextBox:function(){canvas.on("mouse:down",function(){return function(e){if(drawTextBox){var a=canvas.getPointer(e.e),n=t.getDefaults()
n.optionsFreeDrawing.origX=a.x,n.optionsFreeDrawing.origY=a.y,n.textBox=new fabric.Rect({left:a.x,top:a.y,originX:"center",originY:"center",width:0,height:0,angle:0,fill:"transparent",strokeWidth:2,stroke:"rgb(153, 209, 34)"}),canvas.insertAt(n.textBox,canvas.getObjects().length-canvas.helpersInCanvas,!1)}}}()),canvas.on("mouse:move",function(){return function(e){var a=t.getDefaults()
if(drawTextBox&&a.textBox){var n=canvas.getPointer(e.e),a=t.getDefaults()
a.optionsFreeDrawing.origX>n.x&&a.textBox.set({left:Math.abs(n.x)}),a.optionsFreeDrawing.origY>n.y&&a.textBox.set({top:Math.abs(n.y)}),a.textBox.set({width:Math.abs(a.optionsFreeDrawing.origX-n.x)}),a.textBox.set({height:Math.abs(a.optionsFreeDrawing.origY-n.y)}),canvas.renderAll()}}}()),canvas.on("mouse:up",function(){return function(e){var a=t.getDefaults()
drawTextBox&&a.textBox&&(a.textBox.setCoords(),canvas.renderAll())}}())},addTextBoxInCanvas:function(){var e=new fabric.IText("Double click to change text",{fontSize:30,textAlign:"left",vAlign:"top",fill:"#000000",width:200,height:140,originX:"center",originY:"center",fontFamily:"Roboto",left:parseInt(canvas.getWidth()/2),top:parseInt(canvas.getHeight()/2),opacity:1})
t.runHooks("pushUndoData",[{added:e,objectID:e.objectID}]),canvas.insertAt(e,canvas.getObjects().length-canvas.helpersInCanvas,!1),canvas.setActiveObject(e)},addPage:function(){var a=themePageContent.length,n=e(".droppable").data("page"),o={content:JSON.stringify({objects:[],background:"rgba(255,255,255,1.0)",helpersInCanvas:0,totalFilteredImages:0}),width:themePageContent[0].width,height:themePageContent[0].height,page_number:n+2,visited:!0,content_type:"json",theme_id:themePageContent[a-1].theme_id,made_by:"customer"},i=n+1
e("body").toggleClass("loading_canvas"),setTimeout(function(e,a,n){return function(){t.getCanvasPageForPreview(a),n.splice(i,0,e),n.forEach(function(e,t){t>i&&(e.page_number=parseInt(e.page_number)+1)}),t.loadCanvas(n[i])}}(o,n,themePageContent),100)},deletePage:function(a){if(themePageContent.length>1){var n=themePageContent.indexOf(themePageContent[a.currentPage])
themePageContent.splice(n,1),themePageContent.forEach(function(e,t){e.page_number=t+1}),e("body").toggleClass("loading_canvas"),setTimeout(function(){t.loadCanvas(themePageContent[a.newPageNumber])},100)}},bindEvents:function(a){var n=t.getDefaults()
e(n.droppable+">.canvas-container").bind("contextmenu",function(e){return!1}),t.runHooks("bindEventsDefaultToolbar"),t.runHooks("bindEventsImageToolbar"),t.runHooks("bindEventsTextToolbar")},unbindEvents:function(e){t.runHooks("unbindEventsDefaultToolbar"),t.runHooks("unbindEventsImageToolbar"),t.runHooks("unbindEventsTextToolbar")},calculateInitialZoom:function(){var a,n,o=t.getDefaults(),i=e(o.containerCanvas).width()-o.adjustDimensionsCanvas,r=e(o.containerCanvas).height()-o.adjustDimensionsCanvas,s=canvas.getWidth()-2*canvasOffsetWidth,c=canvas.getHeight()-2*canvasOffsetHeight
a=i<o.designerMaxWidth?1-i/s:1-o.designerMaxWidth/s,n=r<o.designerMaxHeight?1-r/c:1-o.designerMaxHeight/c,t.setInitialZoom(a>n?a:n),canvas.renderAll()},setInitialZoom:function(e){t.getDefaults(),canvas.getWidth()*(canvasScale-e)
if(canvasScale-=e,t.updateCanvasSize(Math.round(canvas.getWidth()*canvasScale),Math.round(canvas.getHeight()*canvasScale)),canvas.backgroundImage){var a=canvas.backgroundImage.scaleX*(canvasScale/(canvasScale+e)),n=canvas.backgroundImage.scaleY*(canvasScale/(canvasScale+e)),o=canvas.backgroundImage.left*(canvasScale/(canvasScale+e))
o-=canvasOffsetWidth/(canvasScale+e)*e
var i=canvas.backgroundImage.top*(canvasScale/(canvasScale+e))
i-=canvasOffsetHeight/(canvasScale+e)*e,canvas.backgroundImage.set("scaleX",a),canvas.backgroundImage.set("scaleY",n),canvas.backgroundImage.set("left",o),canvas.backgroundImage.set("top",i),canvas.backgroundImage.setCoords()}var r=canvas.getObjects()
for(var s in r)if(r[s])if("undefined"==typeof r[s].objectID||1e5!=r[s].objectID&&100001!=r[s].objectID&&100002!=r[s].objectID&&100003!=r[s].objectID){var c=r[s].get("scaleX"),l=r[s].get("scaleY"),d=r[s].get("left"),u=r[s].get("top"),a=c*(canvasScale/(canvasScale+e)),n=l*(canvasScale/(canvasScale+e)),o=d*(canvasScale/(canvasScale+e))
o+=canvasOffsetWidth/(canvasScale+e)*e
var i=u*(canvasScale/(canvasScale+e))
i+=canvasOffsetHeight/(canvasScale+e)*e,r[s].set("scaleX",a),r[s].set("scaleY",n),r[s].set("left",o),r[s].set("top",i),r[s].setCoords()}else 100002==r[s].objectID&&(r[s].top=canvas.getHeight()-canvasOffsetHeight),100001==r[s].objectID&&(r[s].left=canvas.getWidth()-canvasOffsetWidth)},updateCanvasSize:function(e,t){canvas.setWidth(e+2*canvasOffsetWidth),canvas.setHeight(t+2*canvasOffsetHeight)},updateSizeAndPositionBackground:function(){canvas.backgroundImage&&canvas.backgroundImage.set({left:canvasOffsetWidth,top:canvasOffsetHeight,width:canvas.getWidth()-2*canvasOffsetWidth,height:canvas.getHeight()-2*canvasOffsetHeight,originX:"left",originY:"top"})},loadBackground:function(e,t){var a,n=e.pageNumber
"undefined"!=typeof e.defaultBackgroundName&&(a="undefined"==typeof canvas.backgroundImage||null==canvas.backgroundImage||"undefined"==typeof canvas.backgroundImage.getSrc()||pdfDesignerInfo.use_pdf?pdfDesignerInfo.use_pdf&&"undefined"!=typeof pdfDesignerInfo.data.pages[n-1]?pdfDesignerInfo.data.pages[n-1].image_normal:null:canvas.backgroundImage.getSrc(),canvas.setBackgroundImage(a,function(){"function"==typeof t&&t()}))},getBackgroundImage:function(e){var t=JSON.parse(e)
return t&&"undefined"!=typeof t.backgroundImage&&"undefined"!=typeof t.backgroundImage.src&&t.backgroundImage.src.length?t.backgroundImage.src:defaultBackgroundName},loadCanvas:function(e){t.getDefaults()
if(t.unbindEvents(),canvas.clear(),canvas.setWidth(parseInt(e.width)),canvas.setHeight(parseInt(e.height)),canvasScale=1,e)switch(canvas.setViewportTransform([1,0,0,1,0,0]),canvas.viewportTransformOld=[1,0,0,1,0,0],t.resetZoomText(),e.content_type){case"json":canvas.loadFromJSON(e.content,function(){if(t.calculateInitialZoom(),t.runHooks("updateScrollerDimensions"),t.bindEvents(),e.content){var a=t.getBackgroundImage(e.content),n={pageNumber:e.page_number,defaultBackgroundName:a}
t.loadBackground(n,function(){t.updateSizeAndPositionBackground(),t.runHooks("fitPage"),canvas.renderAll(),t.runHooks("updateIframe"),t.runHooks("makeBackgroundImageSelected"),t.changeBodyState()})}else t.runHooks("fitPage"),canvas.renderAll(),setTimeout(function(){t.runHooks("updateIframe")},300),t.changeBodyState()
t.runHooks("runClearUndoRedo")})
break
case"svg":fabric.loadSVGFromString(e.content,function(a,n){n.helpersInCanvas&&(canvas.helpersInCanvas=n.helpersInCanvas),a.forEach(function(e,t){e.left+=canvasOffsetWidth,e.top+=canvasOffsetHeight,e.setCoords(),"undefined"!=typeof isFrontEndUser&&isFrontEndUser&&"undefined"!==e.setHelper&&1==e.setHelper&&(e.selectable=!1,e.hasControls=!1),"undefined"!=typeof e.setBlocker&&1==e.setBlocker&&isFrontEndUser&&(e.lockRotation=e.lockUniScaling=e.lockMovementX=e.lockMovementY=e.lockScalingX=e.lockScalingY=!0)}),canvas.add.apply(canvas,a),t.calculateInitialZoom(),t.runHooks("updateScrollerDimensions"),t.bindEvents()
var o={pageNumber:e.page_number,defaultBackgroundName:defaultBackgroundName}
t.loadBackground(o,function(){t.updateSizeAndPositionBackground(),t.runHooks("fitPage"),canvas.renderAll(),t.runHooks("updateIframe"),t.runHooks("makeBackgroundImageSelected"),t.changeBodyState()}),t.runHooks("runClearUndoRedo")})}},getCanvasPageForPreview:function(e,a){if(1!=canvasScale){var n=1-canvasScale
canvasScale=1
var o=parseInt(themePageContent[e].width),i=parseInt(themePageContent[e].height)
if(t.updateCanvasSize(o,i),canvas.backgroundImage){var r=canvas.backgroundImage.scaleX*(canvasScale/(canvasScale-n)),s=canvas.backgroundImage.scaleY*(canvasScale/(canvasScale-n)),c=canvas.backgroundImage.left*(canvasScale/(canvasScale-n))
c-=canvasOffsetWidth/(canvasScale-n)*n
var l=canvas.backgroundImage.top*(canvasScale/(canvasScale-n))
l-=canvasOffsetHeight/(canvasScale-n)*n,canvas.backgroundImage.set("scaleX",r),canvas.backgroundImage.set("scaleY",s),canvas.backgroundImage.set("left",c),canvas.backgroundImage.set("top",l),canvas.backgroundImage.setCoords()}var d=canvas.getObjects()
for(var u in d){var g=d[u].get("scaleX"),f=d[u].get("scaleY"),h=d[u].get("left"),p=d[u].get("top"),r=g*(canvasScale/(canvasScale-n)),s=f*(canvasScale/(canvasScale-n)),c=h*(canvasScale/(canvasScale-n))
c-=canvasOffsetWidth/(canvasScale-n)*n
var l=p*(canvasScale/(canvasScale-n))
l-=canvasOffsetHeight/(canvasScale-n)*n,d[u].set("scaleX",r),d[u].set("scaleY",s),d[u].set("left",c),d[u].set("top",l),d[u].setCoords()}}canvas.setViewportTransform([1,0,0,1,0,0]),themePageContent[e].content_type="json",themePageContent[e].content=JSON.stringify(canvas.toJSON(propertiesToIncludeCanvas)),themePageContent[e].content_preview=canvas.toSVG({viewBox:{x:canvasOffsetWidth,y:canvasOffsetHeight,width:canvas.getWidth()-2*canvasOffsetWidth,height:canvas.getHeight()-2*canvasOffsetWidth}}),canvas.deactivateAllWithDispatch(),canvas.renderAll(),themePageContent[e].preview_image=canvas.toDataURL({format:"jpeg"}),themePageContent[e].visited=!0,"function"==typeof a&&a()},changeBodyState:function(){e("body").toggleClass("loading_canvas")},deleteObject:function(){if(canvas.getActiveGroup()){var e=canvas.getActiveGroup().getObjects()
canvas.discardActiveGroup(),e.forEach(function(e){canvas.remove(e),1==e.setHelper&&canvas.helpersInCanvas--},this)
var a=[]
for(var n in e)1!=e[n].lockRotation&&a.push({objectId:e[n].objectID,removed:e[n]}),e.length-1==n&&t.runHooks("pushUndoData",a)
canvas.renderAll(),t.runHooks("updateIframe")}else if(canvas.getActiveObject()){var o=canvas.getActiveObject()
canvas.remove(o),1==o.setHelper&&canvas.helpersInCanvas--,t.runHooks("pushUndoData"[{objectId:o.objectID,removed:o}]),t.runHooks("updateIframe")}},cloneObject:function(){if(canvas.getActiveGroup()){var e=canvas.getActiveGroup().getObjects(),a=canvas.getActiveGroup(),n=[]
setTimeout(function(e,a,n){return function(){e.forEach(function(o,i){if(["text","i-text","textbox","polygon","line","rect","circle","ellipse"].indexOf(o.type)>=0){var r=o.clone()
r.objectID=Math.floor(1e4*Math.random()),r.setCoords(),r.left=o.left+a.left+100,r.top=o.top+a.top,canvas.insertAt(r,canvas.getObjects().length-canvas.helpersInCanvas,!1),r.setHelper&&canvas.helpersInCanvas++,n.push({objectId:r.objectID,added:r})}else o.clone(function(e){return function(t){var n=t
if(n.left=o.left+("image"==o.type?0:a.left)+100,n.top=o.top+("image"==o.type?0:a.top),n.setCoords(),n.objectID=Math.floor(1e4*Math.random()),e.push({objectID:n.objectID,added:n}),"image"==n.type&&n.filters.length){var i=n.opacity
n.opacity=0
var r=!0}else var r=!1
canvas.insertAt(n,canvas.getObjects().length-canvas.helpersInCanvas,!1),n.setHelper&&canvas.helpersInCanvas++,setTimeout(function(e,t,a,n){return function(){"image"==a&&canvas.getObjectByID(t)&&n&&("undefined"!=typeof canvas.getObjectByID(t)[0]?canvas.getObjectByID(t)[0].opacity=e:null,canvas.renderAll(),OBF.runHooks("updateIframe"))}}(i,t.objectID,n.type,r),100)}}(n))
i==e.length-1&&(t.runHooks("pushUndoData",n),t.runHooks("updateIframe"))},this),canvas.renderAll(),a.setObjectsCoords(),canvas.discardActiveGroup()}}(e,a,n),10)}else if(canvas.getActiveObject()){var o=canvas.getActiveObject()
if(fabric.util.getKlass(o.type).async)o.clone(function(e){if(e.set({left:e.left+100}),e.objectID=Math.floor(1e4*Math.random()),t.runHooks("pushUndoData",[{objectID:e.objectID,added:e}]),"image"==e.type&&e.filters.length){var a=o.opacity,n=!0
e.opacity=0}else var n=!1
"image"==o.type&&"undefined"!=typeof o.designerOptions&&(e.designerOptions=o.designerOptions),"image"==o.type&&"undefined"!=typeof o.thumbnail&&(e.thumbnail=o.thumbnail),"image"==o.type&&"undefined"!=typeof o.cropObjectData&&(e.cropObjectData=o.cropObjectData),canvas.insertAt(e,canvas.getObjects().length-canvas.helpersInCanvas,!1),e.setHelper&&canvas.helpersInCanvas++,setTimeout(function(e,a,n,o){return function(){canvas.getObjectByID(n)&&o&&("undefined"!=typeof canvas.getObjectByID(n)[0]?canvas.getObjectByID(n)[0].opacity=a:null,canvas.renderAll(),t.runHooks("updateIframe"))}}(e,a,e.objectID,n),100)})
else{var i=o.clone()
if(i.set({left:i.left+100}),i.objectID=Math.floor(1e4*Math.random()),t.runHooks("pushUndoData",[{objectID:i.objectID,added:i}]),"image"==i.type&&i.filters.length){var r=i.opacity
i.opacity=0
var s=!0}else var s=!1
canvas.insertAt(i,canvas.getObjects().length-canvas.helpersInCanvas,!1),i.setHelper&&canvas.helpersInCanvas++,setTimeout(function(e,t,a,n){return function(){canvas.getObjectByID(a)&&n&&("undefined"!=typeof canvas.getObjectByID(a)[0]?canvas.getObjectByID(a)[0].opacity=t:null,canvas.renderAll())}}(i,r,i.objectID,s),100)}t.runHooks("updateIframe")}},groupObjects:function(){if(canvas.getActiveGroup()){var e=canvas.getActiveGroup().getObjects(),a=[],n=[],o=function(e,t,n,o){e.objectID=t,"undefined"!=typeof n&&(e.setHelper=n),a.push(e),o()},i=canvas.getActiveGroup().left,r=canvas.getActiveGroup().top,s=canvas.getActiveGroup().width,c=canvas.getActiveGroup().height,l=function(e,d){if(e<d.length){var u=d[e];["text","textbox","polygon","rect","circle","ellipse","line","Arrow","ConnectionLine","Curve","Elbow"].indexOf(u.type)>=0?o(u.clone(),u.objectID,u.setHelper,function(){l(e+1,d)}):u.clone(function(t){t.objectID=u.objectID,t.setHelper=u.setHelper,a.push(t),l(e+1,d)})}else canvas.getActiveGroup().getObjects().forEach(function(e,o){if(n.push({objectID:e.objectID,removed:e}),canvas.remove(e),null!=canvas.getActiveGroup()&&o==canvas.getActiveGroup().getObjects().length-1){var l=new fabric.Group(a,{left:i,top:r,width:s,height:c,originX:"center",originY:"center"})
l.objectID=Math.floor(1e4*Math.random()),n.push({objectID:l.objectID,added:l}),canvas.insertAt(l,canvas.getObjects().length-canvas.helpersInCanvas,!1),t.runHooks("pushUndoData",n),canvas.discardActiveGroup(),setTimeout(function(e){return function(){canvas.getObjectByID(e).length&&(canvas.renderAll(),t.runHooks("updateIframe"))}}(l.objectID),10)}})}
l(0,e)}},unGroupObjects:function(){if(canvas.getActiveObject()&&"group"==canvas.getActiveObject().type){var e=[],a=function(t,a,n){t.objectID=a,"undefined"!=typeof n&&(t.setHelper=n),t.set({left:t.left+canvas.getActiveObject().left,top:t.top+canvas.getActiveObject().top}),canvas.insertAt(t,canvas.getObjects().length-canvas.helpersInCanvas,!1),e.push({objectID:t.objectID,added:t})},n=canvas.getActiveObject().getObjects(),o=canvas.getActiveObject().left,i=canvas.getActiveObject().top
for(var r in n){var s=n[r];["text","i-text","textbox","line","polygon","rect","circle","ellipse"].indexOf(s.type)>=0?a(s.clone(),s.objectID,s.setHelper):s.clone(function(a){var n=s.opacity
a.objectID=Math.floor(1e4*Math.random()),a.setHelper=s.setHelper,a.set({left:a.left+o,top:a.top+i}),e.push({objectID:a.objectID,added:a}),a.opacity=0,canvas.insertAt(a,canvas.getObjects().length-canvas.helpersInCanvas,!1),setTimeout(function(e,a){return function(){canvas.getObjectByID(e).length&&(canvas.getObjectByID(e)[0].opacity=a,canvas.renderAll(),t.runHooks("updateIframe"))}}(a.objectID,n),10)}),r==n.length-1&&(e.push({objectID:canvas.getActiveObject().objectID,removed:canvas.getActiveObject()}),t.runHooks("pushUndoData",e),canvas.remove(canvas.getActiveObject()))}canvas.renderAll(),canvas.discardActiveObject()}},loadProject:function(a,n){var o=t.getDefaults(n)
e.printqAjaxRequest.postRequest({url:loadProjectUrl,data:{project_id:a},onComplete:function(a){return function(n){n&&!n.success?respone.message?alert(n.message):alert(translateStrings.error):(themePageContent=n.items,window.addToCartData=n.add_to_cart_data,e("body").removeClass("loading_canvas"),e("#projectId").val(n.project_id),t.runHooks("resetPagination"),e.editorCustomPagination.init({page:1}),t.loadCanvas(themePageContent[0]),t.runHooks("populateLoadProjects",n),e.isFunction(a.callback)&&a.callback(),alert(translateStrings.projectLoaded,"success"))}}(o),onFail:function(e){return function(e){alert(translateStrings.error)}}(o)})},deleteProject:function(a,n){var o=t.getDefaults(n)
e.printqAjaxRequest.postRequest({url:deleteProjectUrl,data:{project_id:a},onComplete:function(e){return function(e){e&&e.error?void 0!==e.message?alert(e.message):alert(translateStrings.error):(alert(translateStrings.delete_complete,"success"),t.runHooks("deleteProjectFromList",a))}}(o),onFail:function(e){return function(e){alert(translateStrings.error)}}(o)})},saveProject:function(a,n){var o=a.find("input.customer_save_project").val(),i=a.find("textarea").val(),r=t.getDefaults(),s=e(r.droppable).data("page")
return o.length?(e("body").removeClass("loading_canvas"),void t.getCanvasPageForPreview(s,function(o,i,r){return function(){var s=e.extend(!0,{},themePageContent)
e.each(s,function(e,t){delete s[e].preview_image,delete s[e].content_preview})
var c={project_name:r,project_description:i,product_id:addToCartData.product_id,content:s,addToCartData:addToCartData},l=e("#projectId",a).val()
void 0!==n&&n||!l||(c.project_id=l),e.printqAjaxRequest.postRequest({url:saveProjectUrl,data:c,onComplete:function(n){return function(n){n&&(n.error&&(t.calculateInitialZoom(),t.updateSizeAndPositionBackground(),canvas.renderAll(),e("body").addClass("loading_canvas"),alert(translateStrings.alert_save)),n.success&&(t.calculateInitialZoom(),t.updateSizeAndPositionBackground(),e("#projectId",a).val(n.id),canvas.renderAll(),t.runHooks("populateLoadProjects",n),t.resetLoadProjectFrameButtons(),e("body").addClass("loading_canvas"),alert(translateStrings.save_complete,"success")))}}(o),onFail:function(a){return function(a){t.calculateInitialZoom(),e("body").addClass("loading_canvas"),alert(translateStrings.alert_save)}}(o)})}}(r,i,o))):void alert(translateStrings.alert_save)},resetLoadProjectFrameButtons:function(a){var n=t.getDefaults(a),o=e(n.loadProjectFrame),i=o.find("button#load"),r=o.find("button#delete")
i.length>0&&e.each(i,function(){var a=e(this),o=parseInt(a.parent().find('input[name="projectId"]').val())
a.off("click"),o>0&&a.on("click",function(e,a){return function(){t.loadProject(e,a)}}(o,n))}),r.length>0&&e.each(r,function(){var a=e(this),o=parseInt(a.parent().find('input[name="projectId"]').val())
a.off("click"),o>0&&a.on("click",function(e,a){return function(n){customConfirm(translateStrings.confirmDeleteProjectText,function(){t.deleteProject(e,a)},function(){})}}(o,n))})},zoomIn:function(e){var a=(t.getDefaults(),canvas.getZoom()+.04)
canvas.zoomToPoint({x:canvas.getCenter().left,y:canvas.getCenter().top},a),e.length&&e.find("span").html(parseInt(100*a)+"%")},zoomOut:function(e){var a=(t.getDefaults(),canvas.getZoom()+-.04)
a<.1||(canvas.zoomToPoint({x:canvas.getCenter().left,y:canvas.getCenter().top},a),e.length&&e.find("span").html(parseInt(100*a)+"%"))},mouseZoomInit:function(a){var n=t.getDefaults(),o=/Firefox/i.test(navigator.userAgent)?"DOMMouseScroll":"mousewheel",i=e(canvas.getElement().parentNode)
i.length&&(i=i[0],i.addEventListener(o,function(e,a,n){return function(e){if(parseInt(allowMouseZoomHandler)){t.runHooks("stopImageToolbar"),t.runHooks("stopDefaultToolbar"),t.runHooks("stopTextToolbar")
var o,i,r=navigator.userAgent.toLowerCase(),s=!!navigator.userAgent.match(/Trident.*/)||r.indexOf("safari/")!==-1&&r.indexOf("windows")!==-1
if("mousewheel"==n?s?(o=-e.wheelDelta,i=canvas.getZoom()+o/3e3):(o=e.deltaY,i=canvas.getZoom()+o/2500):(o=e.detail,i=canvas.getZoom()+o/150),i<.1)return
canvas.zoomToPoint({x:canvas.getCenter().left,y:canvas.getCenter().top},i),a.length&&a.find("span").html(parseInt(100*i)+"%"),e.preventDefault()}}}(n,a,o)))},resetZoomText:function(){var a=t.getDefaults()
e(a.zoomTextContainer).find("span").html("100%")},verifytd:function(){t.getDefaults()
"tdpreview"===previewType&&window.innerWidth>900&&(e("#tdIframe").css({display:"inline-block"}),e("#edit_tab").css({width:"60% "}),e("#preview_tab").css({width:"60% "}))},clearSelection:function(){canvas.discardActiveObject(),canvas.discardActiveGroup()},checkEvents:function(){e(window).on("resize",function(){clearTimeout(resizeWindowID),resizeWindowID=setTimeout(function(){window.innerWidth<900?(t.runHooks("unbindEventsDefaultToolbar"),t.runHooks("unbindEventsTextToolbar"),t.runHooks("unbindEventsImageToolbar")):(t.runHooks("bindEventsDefaultToolbar"),t.runHooks("bindEventsTextToolbar"),t.runHooks("bindEventsImageToolbar"))},500)})},goBack:function(){admin?window.parent.jQuery.fancybox.close():window.history.back()},adminSaveProject:function(){var a=t.getDefaults(),n=e(a.droppable).data("page")
e("body").removeClass("loading_canvas"),t.getCanvasPageForPreview(n,function(t){return function(t){var a=[]
e.each(themePageContent,function(e,t){a.push({content:t.content,page_number:e+1,width:t.width,height:t.height,content_type:"json"})}),window.parent.jQuery("#content").val(JSON.stringify(a)),e("body").addClass("loading_canvas"),window.parent.jQuery.fancybox.close()}}(a))},init:function(){var a=t.getDefaults()
t.connectHooks()
var n=e(document.createElement("canvas"))
n.attr({id:"c"}),e(a.droppable).append(n),canvas=new fabric.Canvas("c",{allowTouchScrolling:!0,controlsAboveOverlay:!0,preserveObjectStacking:!0,backgroundColor:"rgba(255,255,255,1.0)",width:900,height:500})
var o=e(document.createElement("canvas"))
o.attr({id:"c1"}),e(a.tempCanvas).append(o),tempCanvas=new fabric.Canvas("c1",{width:900,height:500}),themePageContent=defaultThemeProduct,canvas.on("mouse:up",function(e){t.runHooks("updateIframe")}),canvas.allowTouchScrolling=!1,t.bindEvents(a),t.verifytd(),e.editorCustomPagination.init({page:1}),setTimeout(function(){t.loadCanvas(themePageContent[0]),setTimeout(function(){canvas.renderAll()},500)},0),t.resetLoadProjectFrameButtons(),t.checkEvents(),t.observeDrawTextBox(),e(a.goBackEditor).click(function(e){return function(){t.goBack()}}(a)),e(a.saveProjectAdminButton).click(function(e){return function(){t.adminSaveProject()}}(a))}})}(window.jQuery),!function(e){var t=e.printqSnaptoObject={}
e.extend(t,{defaults:{isSnaptoObject:!1,wasSnapped:!1,edgeDetection:4,canvasSnapLeft:".canvas_snap_left",canvasSnapRight:".canvas_snap_right",canvasSnapTop:".canvas_snap_top",canvasSnapBottom:".canvas_snap_bottom",canvasSnapMarginH:".canvas_snap_h",canvasSnapMarginV:".canvas_snap_v",snapToObjectButton:".block_option_snap"},getDefaults:function(a){return e.extend(t.defaults,a)},updateSnapLine:function(t,a){e(t).css({display:"block",left:a.left+"px",top:a.top+"px",width:a.width,height:a.height})},observe:function(){var a=t.getDefaults(),n=(canvas.getCenter(),'<div class="canvas_snap_handlers_vertical '+a.canvasSnapLeft.replace(".","")+'"></div><div class="canvas_snap_handlers_vertical '+a.canvasSnapRight.replace(".","")+'"></div><div class="canvas_snap_handlers_vertical '+a.canvasSnapMarginV.replace(".","")+'"></div><div class="canvas_snap_handlers_horizontal '+a.canvasSnapTop.replace(".","")+'"></div><div class="canvas_snap_handlers_horizontal '+a.canvasSnapBottom.replace(".","")+'"></div><div class="canvas_snap_handlers_horizontal '+a.canvasSnapMarginH.replace(".","")+'"></div>')
e(".droppable > .canvas-container").append(n)},bindEventsSnap:function(a){var a=t.getDefaults(),n=canvas.getCenter()
canvas.on("object:moving",function(a,n){return function(n){if(a.isSnaptoObject){var o=n.target
o.getCenterPoint()
o.setCoords()
var i=canvas._searchAllPossibleSnapTargets(o)
if("undefined"==typeof o.angle||0==parseInt(o.angle)){var r=fabric.util.transformPoint(o.translateToCenterPoint(o.getCenterPoint(),"center","center"),canvas.viewportTransform,!1)
fabric.util.transformPoint(o.translateToCenterPoint(o.getCenterPoint(),"left","top"),canvas.viewportTransform,!1)
Math.abs(r.x-canvas.getWidth()/2)<a.edgeDetection?(o.centerH().setCoords(),t.updateSnapLine(a.canvasSnapMarginV,{left:canvas.getWidth()/2,top:canvas.viewportTransform[5]>0?canvas.viewportTransform[5]:0,height:canvas.viewportTransform[5]>0?canvas.getHeight()-2*canvas.viewportTransform[5]:"100%",width:"0px"}),a.wasSnapped=!0):e(a.canvasSnapMarginV).hide(),Math.abs(r.y-canvas.getHeight()/2)<a.edgeDetection?(o.centerV().setCoords(),t.updateSnapLine(a.canvasSnapMarginH,{left:canvas.viewportTransform[4]>0?canvas.viewportTransform[4]:0,top:canvas.getHeight()/2,width:canvas.viewportTransform[4]>0?canvas.getWidth()-2*canvas.viewportTransform[4]:"100%",height:"100%"}),a.wasSnapped=!0):e(a.canvasSnapMarginH).hide(),i.length?i.forEach(function(n){"undefined"!=typeof n.ignoreSnap&&n.ignoreSnap||"undefined"!=typeof n.angle&&0!=parseInt(n.angle)||n!=o&&100003!=n.objectID&&100002!=n.objectID&&100001!=n.objectID&&1e5!=n.objectID&&(Math.abs(o.oCoords.tr.x-n.oCoords.tl.x)<a.edgeDetection?(o.setLeft(n.getLeft()-o.getWidth()/2-n.getWidth()/2),t.updateSnapLine(a.canvasSnapRight,{left:fabric.util.transformPoint(o.translateToCenterPoint(o.getCenterPoint(),"left","top"),canvas.viewportTransform,!1).x,top:canvas.viewportTransform[5]>0?canvas.viewportTransform[5]:0,width:"0px",height:canvas.viewportTransform[5]>0?canvas.getHeight()-2*canvas.viewportTransform[5]:"100%"}),a.wasSnapped=!0):Math.abs(o.oCoords.tr.x-n.oCoords.tr.x)<a.edgeDetection?(o.setLeft(n.getLeft()+n.getWidth()/2-o.getWidth()/2),t.updateSnapLine(a.canvasSnapRight,{left:fabric.util.transformPoint(o.translateToCenterPoint(o.getCenterPoint(),"left","top"),canvas.viewportTransform,!1).x,top:canvas.viewportTransform[5]>0?canvas.viewportTransform[5]:0,width:"0px",height:canvas.viewportTransform[5]>0?canvas.getHeight()-2*canvas.viewportTransform[5]:"100%"}),a.wasSnapped=!0):e(a.canvasSnapRight).hide(),Math.abs(o.oCoords.tl.x-n.oCoords.tr.x)<a.edgeDetection?(o.setLeft(n.getLeft()+n.getWidth()/2+o.getWidth()/2),t.updateSnapLine(a.canvasSnapLeft,{left:fabric.util.transformPoint(o.translateToCenterPoint(o.getCenterPoint(),"right","top"),canvas.viewportTransform,!1).x,top:canvas.viewportTransform[5]>0?canvas.viewportTransform[5]:0,width:"0px",height:canvas.viewportTransform[5]>0?canvas.getHeight()-2*canvas.viewportTransform[5]:"100%"}),a.wasSnapped=!0):Math.abs(o.oCoords.tl.x-n.oCoords.tl.x)<a.edgeDetection?(o.setLeft(n.getLeft()+o.getWidth()/2-n.getWidth()/2),t.updateSnapLine(a.canvasSnapLeft,{left:fabric.util.transformPoint(o.translateToCenterPoint(o.getCenterPoint(),"right","top"),canvas.viewportTransform,!1).x,top:canvas.viewportTransform[5]>0?canvas.viewportTransform[5]:0,width:"0px",height:canvas.viewportTransform[5]>0?canvas.getHeight()-2*canvas.viewportTransform[5]:"100%"}),a.wasSnapped=!0):e(a.canvasSnapLeft).hide(),Math.abs(o.oCoords.br.y-n.oCoords.tr.y)<a.edgeDetection?(o.setTop(n.getTop()-n.getHeight()/2-o.getHeight()/2),t.updateSnapLine(a.canvasSnapTop,{left:canvas.viewportTransform[4]>0?canvas.viewportTransform[4]:0,top:fabric.util.transformPoint(o.translateToCenterPoint(o.getCenterPoint(),"right","top"),canvas.viewportTransform,!1).y,width:canvas.viewportTransform[4]>0?canvas.getWidth()-2*canvas.viewportTransform[4]:"100%",height:"100%"}),a.wasSnapped=!0):Math.abs(o.oCoords.tr.y-n.oCoords.tr.y)<a.edgeDetection?(o.setTop(n.getTop()-n.getHeight()/2+o.getHeight()/2),t.updateSnapLine(a.canvasSnapTop,{left:canvas.viewportTransform[4]>0?canvas.viewportTransform[4]:0,top:fabric.util.transformPoint(o.translateToCenterPoint(o.getCenterPoint(),"right","bottom"),canvas.viewportTransform,!1).y,height:"100%",width:canvas.viewportTransform[4]>0?canvas.getWidth()-2*canvas.viewportTransform[4]:"100%"}),a.wasSnapped=!0):e(a.canvasSnapTop).hide(),Math.abs(n.oCoords.br.y-o.oCoords.tr.y)<a.edgeDetection?(o.setTop(n.getTop()+n.getHeight()/2+o.getHeight()/2),t.updateSnapLine(a.canvasSnapBottom,{left:canvas.viewportTransform[4]>0?canvas.viewportTransform[4]:0,top:fabric.util.transformPoint(o.translateToCenterPoint(o.getCenterPoint(),"right","bottom"),canvas.viewportTransform,!1).y,height:"100%",width:canvas.viewportTransform[4]>0?canvas.getWidth()-2*canvas.viewportTransform[4]:"100%"}),a.wasSnapped=!0):Math.abs(n.oCoords.br.y-o.oCoords.br.y)<a.edgeDetection?(o.setTop(n.getTop()+n.getHeight()/2-o.getHeight()/2),t.updateSnapLine(a.canvasSnapBottom,{left:canvas.viewportTransform[4]>0?canvas.viewportTransform[4]:0,top:fabric.util.transformPoint(o.translateToCenterPoint(o.getCenterPoint(),"right","top"),canvas.viewportTransform,!1).y,height:"100%",width:canvas.viewportTransform[4]>0?canvas.getWidth()-2*canvas.viewportTransform[4]:"100%"}),a.wasSnapped=!0):e(a.canvasSnapBottom).hide())}):(e(a.canvasSnapRight).hide(),e(a.canvasSnapLeft).hide(),e(a.canvasSnapTop).hide(),e(a.canvasSnapBottom).hide())}}}}(a,n)),canvas.on("mouse:up",function(t){return function(){t.isSnaptoObject&&t.wasSnapped&&(e(t.canvasSnapLeft).hide(),e(t.canvasSnapRight).hide(),e(t.canvasSnapTop).hide(),e(t.canvasSnapBottom).hide(),e(t.canvasSnapMarginV).hide(),e(t.canvasSnapMarginH).hide())}}(a))},unbindEventsSnap:function(){canvas.off("object:moving"),canvas.off("mouse:up")},addHook:function(e,a,n){printqPluggable.PluginHooks.add(e,a,t,n)},addHookOnce:function(e,a,n){printqPluggable.PluginHooks.once(e,a,t,n)},removeHook:function(e,a,n){printqPluggable.PluginHooks.remove(e,a,t,n)},addGlobalHook:function(e,t,a){printqPluggable.PluginHooks.add(e,t,!1,a)},runHooks:function(e,a,n,o,i,r,s){return printqPluggable.PluginHooks.run(t,e,a,n,o,i,r,s)},connectHooks:function(){t.addGlobalHook("bindEventsSnap",t.bindEventsSnap),t.addGlobalHook("onOffSnap",t.onOffSnap)},onOffSnap:function(){var e=t.getDefaults()
e.isSnaptoObject=!e.isSnaptoObject},init:function(a){var n=t.getDefaults()
n.isSnaptoObject=!!e(n.snapToObjectButton).hasClass("active"),t.connectHooks(),t.observe(),t.bindEventsSnap(n)}})}(window.jQuery),!function(e){var t=e.prinqLoading={}
e.extend(t,{defaults:{mask:null,dataNs:"queue",cancelLoading:!1},_O:function(a){var n=e.extend(!0,{},t.defaults)
return e.extend(!0,n,a)},attr:function(a,n){return"string"==typeof a?("undefined"!=typeof n&&(t.defaults[a]=n),t.defaults[a]):void("object"==typeof a&&e.each(a,function(e,a){t.defaults[e]=a}))},start:function(a,n){if(!n.cancelLoading){"undefined"==typeof a&&(a="default")
var n=t._O(n),o=e.q(n.mask),i=o.data(n.dataNs),r=!0
return"undefined"==typeof i&&(i={}),i[a]=r,o.data(n.dataNs,i),t.check(n),o.data(n.dataNs)}},stop:function(a,n){if(!n.cancelLoading){"undefined"==typeof a&&(a="default")
var n=t._O(n),o=e.q(n.mask),i=o.data(n.dataNs),r=!1
return"undefined"==typeof i&&(i={}),i[a]=r,delete i[a],o.data(n.dataNs,i),t.check(n),o.data(n.dataNs)}},stopAll:function(a){var a=t._O(a),n=e.q(a.mask),o={}
return n.data(a.dataNs,o),t.check(a),n.data(a.dataNs)},check:function(a){this.hide=!0
var a=t._O(a),n=e.q(a.mask),o=n.data(a.dataNs),i=this
"undefined"!=typeof o&&e.each(o,function(e,t){t&&(i.hide=!1)}),this.hide?t._hide(a):t._show(a)},_show:function(a){var a=t._O(a),n=e.q(a.mask)
n.length&&n.show()},_hide:function(a){var a=t._O(a),n=e.q(a.mask)
n.length&&n.hide()}}),e.fn.prinqLoading=function(a,n,o){var o=t._O(o)
return o.mask=this,"string"!=typeof a?this.each(function(){t.start(a,o)}):void this.each(function(){if(!e.isFunction(t[a])||"_"===a.charAt(0))return e.error('No such method "'+a+'"')
var i=t[a](n,o)
return i})}}(window.jQuery),!function(e){var t=e.printqImageQuality={}
e.extend(t,{defaults:{icons:"printqicon-badsmiley printqicon-normalsmiley printqicon-goodsmiley",levels:[{background_icon:"printqicon-badsmiley",low:0,high:120},{background_icon:"printqicon-normalsmiley",low:121,high:250},{background_icon:"printqicon-goodsmiley",low:250,high:99999}],currentLevel:300},getDefaults:function(a){return e.extend(t.defaults,a)},connectHooks:function(){t.addGlobalHook("afterOpenToolbar",t.onAfterResizeSliderHookCallback)},onAfterResizeSliderHookCallback:function(e){if("close"!=e.status){var a=t.checkImageQuality()
t.showQualityImage({target:e.options.qualityIcon,currentLevel:a.currentLevel})}},addHook:function(e,a,n){printqPluggable.PluginHooks.add(e,a,t,n)},addHookOnce:function(e,a,n){printqPluggable.PluginHooks.once(e,a,t,n)},addGlobalHook:function(e,t,a){printqPluggable.PluginHooks.add(e,t,!1,a)},addGlobalHookOnce:function(e,t,a){printqPluggable.PluginHooks.once(e,t,!1,a)},removeGlobalHook:function(e,t){printqPluggable.PluginHooks.remove(e,t,!1)},removeHook:function(e,a){printqPluggable.PluginHooks.remove(e,a,t)},runHooks:function(e,a,n,o,i,r,s){return printqPluggable.PluginHooks.run(t,e,a,n,o,i,r,s)},checkImageQuality:function(){var e,t,a,n,o,i=canvas.getActiveObject(),r=0,s=0,c=0
return i&&"image"==i.type&&(r=i.originalWidth,s=i.originalHeight,e=1-canvasScale,t=i.scaleX*(1/(1-e))*i.getWidth()*.01041666666667,a=i.scaleY*(1/(1-e))*i.getHeight()*.01041666666667,n=Math.sqrt(Math.pow(r,2)+Math.pow(s,2)),o=Math.sqrt(Math.pow(t,2)+Math.pow(a,2)),c=n/o),{currentLevel:c}},showQualityImage:function(a){var n=e.extend({},t.defaults)
n.levels.length>0&&e.each(n.levels,function(t){return function(n,o){a.currentLevel>=o.low&&a.currentLevel<=o.high&&o.background_icon&&(e(a.target).removeClass(t.icons),e(a.target).addClass(o.background_icon))}}(n))},init:function(e){t.connectHooks()}})}(window.jQuery),!function(e){e.printqUniqueId=function(e){var t="",a="",n=10,o=0,i=Math.random().toString(36).substr(2,10)
"undefined"!=typeof e&&("undefined"!=typeof e.prefix&&(t=e.prefix),"undefined"!=typeof e.sufix&&(a=e.sufix),"undefined"!=typeof e.length&&(n=e.length),"undefined"!=typeof e.start&&(o=e.start))
for(var r=0;r<n/10+1;r++)i+=Math.random().toString(36).substr(2,10)
return t+i.substr(o,n)+a}}(window.jQuery),!function(e){var t=e.printqAjaxRequest={},a={}
e.extend(t,{defaults:{url:null,data:a,dataType:"JSON",onComplete:function(e){},onFail:function(e){},mask:"#loading-mask"},_O:function(a){var n=e.extend(!0,{},t.defaults)
return e.extend(!0,n,a)},postRequest:function(a){var n=t._O(a),o=e.printqUniqueId({prefix:"loading_",sufix:"_postRequest",length:6}),i=!1
n.url==getUserPhotosUrl&&(i=!0),"undefined"==typeof n.data.nonce&&(n.data.pqd_nonce=pqd_nonce),"undefined"==typeof n.data.isAjax&&(n.data.isAjax=!0),e(n.mask).prinqLoading("start",o,{cancelLoading:i}),e.ajax({type:"POST",url:n.url,dataType:n.dataType,headers:{"X-CSRF-TOKEN":e('meta[name="csrf-token"]').attr("content")},data:n.data}).done(function(t,a){return function(n){a.onComplete(n),e(a.mask).prinqLoading("stop",t)}}(o,n)).fail(function(t,a){return function(n){a.onFail(n),e(a.mask).prinqLoading("stop",t)}}(o,n))},getRequest:function(a){var n=t._O(a)
"undefined"==typeof n.data.nonce&&(n.data.pqd_nonce=pqd_nonce),e.ajax({type:"GET",url:n.url,dataType:"JSON",data:n.data,cache:!1}).done(function(e){n.onComplete(e)}).fail(function(e){n.onFail(e)})}})}(window.jQuery),!function(e){function t(e,t,a){var n=new RegExp("([?&])"+t+"=.*?(&|$)","i"),o=e.indexOf("?")!==-1?"&":"?"
return e.match(n)?e.replace(n,"$1"+t+"="+a+"$2"):e+o+t+"="+a}var a=e.printqFileUploader={}
e.extend(a,{defaults:{context:"body",url:null,filesUpload:".files-upload-input",dropArea:"#printqFileUploaderArea .drop-area",onAppendParams:function(e){},maxConnections:2,onDrop:function(){},onUpload:function(){},onFileToQueue:function(e){},onFileUploadStart:function(e){},onProgress:function(e,t){},onComplete:function(e,t){},onCompleteAll:function(e){},onApiComplete:function(e){},onApiError:function(e){},onDragEnter:function(){},allowed_types:["image/jpg","image/jpeg","image/png","image/gif"],maxFileSize:1e5},getDefaults:function(t){var n=e.extend(!0,n,a.defaults)
return e.extend(!0,n,t)},checkCompleteAll:function(t){var a=!0
return"undefined"!=typeof t&&t?e.each(t,function(e,t){"undefined"!=typeof t.loaded&&t.loaded||(a=!1)}):a=!1,a},dequeue:function(e,t,n,o,i){var r,s=a.getDefaults(i),c=o.indexOf(e),l=s.maxConnections
c>=0&&(o.splice(c,1),o.length>=l&&c<l&&(r=o[l-1],a.uploadFile(r,t,n,o,s)))},uploadFile:function(n,o,i,r,s){var c=a.getDefaults(s),l=o[n],d=null,u=new XMLHttpRequest,g=new FormData
return l.size/1e3>c.maxFileSize?(i[n].loaded=!0,a.dequeue(n,o,i,r,c),c.onApiError(i[n]),void(a.checkCompleteAll(i)&&c.onCompleteAll(i))):jQuery.inArray(l.type,c.allowed_types)==-1?(i[n].loaded=!0,a.dequeue(n,o,i,r,c),c.onApiError(i[n]),void(a.checkCompleteAll(i)&&c.onCompleteAll(i))):("undefined"!=typeof FileReader&&/image/i.test(l.type)&&(d=new FileReader,d.onload=function(e,t){return function(a){e[t].apiloaded=!0}}(i,n),d.readAsDataURL(l)),u.upload.addEventListener("progress",function(e,t){return function(a){if(a.lengthComputable){var n=a.loaded/a.total*100
c.onProgress(n,e[t])}}}(i,n),!1),u.addEventListener("load",function(){},!1),c.url.indexOf("pqd_nonce")==-1&&(c.url=t(c.url,"pqd_nonce",pqd_nonce)),u.open("POST",c.url,!0),u.setRequestHeader("X-CSRF-TOKEN",e('meta[name="csrf-token"]').attr("content")),g.append("qqfile",l),g.append("custom_filename",i[n].custom_filename),c.onAppendParams(g,i[n]),u.onreadystatechange=function(e,t,n,o,i){return function(){4===this.readyState&&(e[o].loaded=!0,a.dequeue(o,n,e,t,i),i.onComplete(this,e[o]),a.checkCompleteAll(e)&&i.onCompleteAll(e))}}(i,r,o,n,c),c.onFileUploadStart(i[n]),void u.send(g,c))},traverseFiles:function(t,n){var o=a.getDefaults(n),i={},r=[]
if("undefined"!=typeof t){for(var s=0,c=t.length;s<c;s++)i[s]={id:s,loaded:!1,apiloaded:!1,data:null,other_infos:{type:"imageBarUpload"},uniqueId:e.printqUniqueId({prefix:"preload_",sufix:"_image",length:12}),custom_filename:e.printqUniqueId({length:32})}
for(var s=0,c=t.length;s<c;s++){var l=r.push(s)
o.onFileToQueue(i[s]),l<=o.maxConnections&&a.uploadFile(s,t,i,r,o)}}else alert("No support for the File API in this web browser","warning")},init:function(t){e.event.props.push("dataTransfer")
var n=a.getDefaults(t),o=e(n.context).find(n.filesUpload),i=e(n.context).find(n.dropArea),r=e()
o.on("change",function(){n.onUpload(),a.traverseFiles(this.files,n)}),i.on("dragleave",function(t){var a=t.target
a&&a===i&&e(this).removeClass("over"),t.preventDefault(),t.stopPropagation()}),i.on("dragenter",function(t){e(this).addClass("over"),e(this).removeClass("isdrag"),t.preventDefault(),t.stopPropagation()}),i.on("dragover",function(e){e.preventDefault(),e.stopPropagation()}),i.on("drop",function(t){a.traverseFiles(t.dataTransfer.files,n),e(this).removeClass("over"),e(this).removeClass("isdrag"),n.onDrop(),t.preventDefault()}),e(window).on("dragleave.PFU",function(e){setTimeout(function(){r=r.not(e.target),0===r.size()&&i.removeClass("isdrag")},1),e.preventDefault(),e.stopPropagation()}),e(window).on("drop.PFU",function(e){i.removeClass("isdrag"),i.removeClass("over"),setTimeout(function(){r=r.not(e.target),0===r.size()&&i.removeClass("isdrag")},1),e.preventDefault(),e.stopPropagation()}),e(window).on("dragenter.PFU",function(e){0===r.size()&&(i.addClass("isdrag"),i.removeClass("over")),r=r.add(e.target),"function"==typeof n.onDragEnter&&n.onDragEnter(),e.preventDefault(),e.stopPropagation()})}})}(window.jQuery),!function(e){var t=e.printqDroppable={}
e.extend(t,{defaults:{droppable:".canvas-container #c"},_O:function(a){return e.extend({},t.defaults,a)},addHook:function(e,a,n){printqPluggable.PluginHooks.add(e,a,t,n)},addHookOnce:function(e,a,n){printqPluggable.PluginHooks.once(e,a,t,n)},removeHook:function(e,a,n){printqPluggable.PluginHooks.remove(e,a,t,n)},addGlobalHook:function(e,t,a){printqPluggable.PluginHooks.add(e,t,!1,a)},runHooks:function(e,a,n,o,i,r,s){return printqPluggable.PluginHooks.run(t,e,a,n,o,i,r,s)},connectHooks:function(){},init:function(a){t.connectHooks()
var a=t._O(a),n=e.q(a.droppable)
n.droppable({destroy:!0,drop:function(e,a){var n=a.draggable.data("type")
switch(n){case"shape":t.runHooks("loadShape",{event:e,ui:a})
break
case"image":t.runHooks("loadImage",{event:e,ui:a})}}})}})}(window.jQuery),!function(e){var t=e.printqFiltersFunctions={}
e.extend(t,{defaults:{t:4},addHook:function(e,a,n){openeditorPluggable.PluginHooks.add(e,a,t,n)},addHookOnce:function(e,a,n){openeditorPluggable.PluginHooks.once(e,a,t,n)},addGlobalHook:function(e,t,a){openeditorPluggable.PluginHooks.add(e,t,!1,a)},addGlobalHookOnce:function(e,t,a){openeditorPluggable.PluginHooks.once(e,t,!1,a)},removeGlobalHook:function(e,t){openeditorPluggable.PluginHooks.remove(e,t,!1)},removeHook:function(e,a){openeditorPluggable.PluginHooks.remove(e,a,t)},runHooks:function(e,a,n,o,i,r,s){return openeditorPluggable.PluginHooks.run(t,e,a,n,o,i,r,s)},connectHooks:function(){t.addGlobalHook("applyFilterOnImageGallery",applyFilterOnImageGalleryCallback)},applyFilterOnImageGalleryCallback:function(){},Grayscale:function(e){for(var t=e.data,a=0;a<t.length;a+=4){var n=(t[a]+t[a+1]+t[a+2])/3
t[a]=n,t[a+1]=n,t[a+2]=n}return e},Sepia:function(e){for(var t=e.data,a=0;a<t.length;a+=4){var n=.3*t[a]+.59*t[a+1]+.11*t[a+2]
t[a]=n+100,t[a+1]=n+50,t[a+2]=n+255}return e},Sepia2:function(e){for(var t,a,n,o=e.data.length,i=0;i<o;i+=4)t=e.data[i],a=e.data[i+1],n=e.data[i+2],e.data[i]=(.393*t+.769*a+.189*n)/1.351,e.data[i+1]=(.349*t+.686*a+.168*n)/1.203,e.data[i+2]=(.272*t+.534*a+.131*n)/2.14
return e},Invert:function(e){for(var t=e.data.length,a=0;a<t;a+=4)e.data[a]=255-e.data[a],e.data[a+1]=255-e.data[a+1],e.data[a+2]=255-e.data[a+2]
return e},Convolute:function(e){var t
switch(e.filterName){case"Emboss":t=[1,1,1,1,.7,-1,-1,-1,-1]
break
case"Sharpen":t=[0,-1,0,-1,5,-1,0,-1,0]
break
case"Blur":t=[1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9]
break
default:t=[0,0,0,0,1,0,0,0,0]}for(var a=Math.round(Math.sqrt(t.length)),n=Math.floor(a/2),o=e.data,i=e.width,r=e.height,s=i,c=r,l=new ImageData(e.width,e.height),d=l.data,u=1,g=0;g<c;g++)for(var f=0;f<s;f++){for(var h=g,p=f,v=4*(g*s+f),m=0,b=0,k=0,C=0,w=0;w<a;w++)for(var I=0;I<a;I++){var y=h+w-n,_=p+I-n
if(y>=0&&y<r&&_>=0&&_<i){var S=4*(y*i+_),H=t[w*a+I]
m+=o[S]*H,b+=o[S+1]*H,k+=o[S+2]*H,C+=o[S+3]*H}}d[v]=m,d[v+1]=b,d[v+2]=k,d[v+3]=C+u*(255-C)}return l},slicerRGBA:function(e,a,n){for(var o=t.getDefaults(),i=(e.height,e.width),r=i*a*o.t,s=e.data.length,c=0,l=r,d=[];s>l-r>0;){var u=e.data.subarray(c,l)
if(u.constructor===Float32Array)var g=new Float32Array(u.length)
else if(u.constructor===Uint8ClampedArray)var g=new Uint8ClampedArray(u.length)
g.set(u),d.push({data:g,width:i,height:u.length/i/4,filterName:n}),c+=r,l+=r}return d},getDefaults:function(a){return e.extend(t.defaults,a)},init:function(e){var e=t.getDefaults(e)
t.connectHooks()}})}(window.jQuery),!function(e){var t=e.printqImageFilters={}
e.extend(t,{defaults:{filters:{Grayscale:new fabric.Image.filters.Grayscale,Sepia2:new fabric.Image.filters.Sepia2,Sepia:new fabric.Image.filters.Sepia,Invert:new fabric.Image.filters.Invert,Emboss:new fabric.Image.filters.Convolute({matrix:[1,1,1,1,.7,-1,-1,-1,-1],name:"Emboss"}),Sharpen:new fabric.Image.filters.Convolute({matrix:[0,-1,0,-1,5,-1,0,-1,0],name:"Sharpen"}),Blur:new fabric.Image.filters.Convolute({matrix:[1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9],name:"Blur"})},activeClass:"filter_active",activeClassDesign:"fa-check-square-o",notActiveClassDesign:"fa-square-o",filterClass:".filters_options",filtersContainterId:"#imageFilters",maskId:"#loading-mask"},getDefaults:function(a){return e.extend(t.defaults,a)},addHook:function(e,a,n){printqPluggable.PluginHooks.add(e,a,t,n)},addHookOnce:function(e,a,n){printqPluggable.PluginHooks.once(e,a,t,n)},addGlobalHook:function(e,t,a){printqPluggable.PluginHooks.add(e,t,!1,a)},addGlobalHookOnce:function(e,t,a){printqPluggable.PluginHooks.once(e,t,!1,a)},removeGlobalHook:function(e,t){printqPluggable.PluginHooks.remove(e,t,!1)},removeHook:function(e,a){printqPluggable.PluginHooks.remove(e,a,t)},runHooks:function(e,a,n,o,i,r,s){return printqPluggable.PluginHooks.run(t,e,a,n,o,i,r,s)},connectHooks:function(){t.addGlobalHook("setOriginalFilter",t.removeFilter),t.addGlobalHook("setFilterToImage",t.applyFilter)},applyFilter:function(a){var n=t.getDefaults(),o=a.block,i=a.filterName,r=o.hasFilters,s=o.filters
o.filters=[n.filters[i]],o.applyFilters(function(a,o,r){return function(s){!s&&a?canvas.totalFilteredImages--:s&&!a&&canvas.totalFilteredImages++,canvas.renderAll(),e(n.maskId).hide(),t.runHooks("pushUndoData",[{objectID:r.objectID,filterId:i,filter:n.filters[i],oldFilter:o,newFilter:r.filters,type:"added"}]),t.runHooks("updateIframe")}}(r,s,o))},removeFilter:function(a){var n=t.getDefaults(),o=a.block,i=a.filterName,r=o.hasFilters,s=o.filters,c=s
o.filters=[],o.applyFilters(function(a,o,r){return function(c){!c&&a?canvas.totalFilteredImages--:c&&!a&&canvas.totalFilteredImages++,canvas.renderAll(),e(n.maskId).hide(),t.runHooks("pushUndoData",[{objectID:r.objectID,filterId:i,filter:s,oldFilter:o,newFilter:r.filters,type:"removed"}]),t.runHooks("updateIframe")}}(r,c,o))},init:function(){t.connectHooks()
t.getDefaults()}})}(window.jQuery),!function(e){var t=e.printqPositionBlock={}
e.extend(t,{defaults:{containerClass:".content_format_text",activeClass:"active",positionContainer:".openeditor_position_container"},getDefaults:function(a){return e.extend(t.defaults,a)},arrayObjectIndexOf:function(e,t,a){for(var n=0,o=e.length;n<o;n++)if(e[n][a]===t)return n
return-1},bringHelpersToTop:function(){var e=canvas.getHelpers(!0)
e.forEach(function(e,t){"undefined"!=typeof e.setHelper&&1==e.setHelper&&e.bringToFront()})},positionChange:function(e){switch(e){case"bringtofront":t.bringToFront()
break
case"bringforward":t.bringForward()
break
case"sendbackward":t.sendBackward()
break
case"sendtoback":t.sendToBack()}},bringForward:function(){var e,a=(t.getDefaults(),[])
if(canvas.getActiveObject()&&(e=canvas.getActiveObject(),a.push({position:!0,objects:[{objectID:e.objectID,oldObjectIndex:canvas.getObjects().indexOf(e)}]}),canvas.bringForward(e),a[0].objects[0].newObjectIndex=canvas.getObjects().indexOf(e),t.runHooks("pushUndoData",a)),canvas.getActiveGroup()){for(var n=canvas.getActiveGroup().getObjects(),o=[],i=n.length-1;i>=0;i--)o.push({objectID:n[i].objectID,oldObjectIndex:canvas.getObjects().indexOf(n[i])})
for(var i=n.length-1;i>=0;i--)canvas.bringForward(n[i]),o[i].newObjectIndex=n.indexOf(n[i])
t.runHooks("pushUndoData",[{position:!0,objects:o}])}canvas.renderAll(),t.runHooks("updateIframe")},sendBackward:function(){var e,a=(t.getDefaults(),[])
if(canvas.getActiveObject()&&(e=canvas.getActiveObject(),a.push({position:!0,objects:[{objectID:e.objectID,oldObjectIndex:canvas.getObjects().indexOf(e)}]}),canvas.sendBackwards(e),a[0].objects[0].newObjectIndex=canvas.getObjects().indexOf(e),t.runHooks("pushUndoData",a)),canvas.getActiveGroup()){for(var n=canvas.getActiveGroup().getObjects(),o=[],i=0;i<=n.length-1;i++)o.push({objectID:n[i].objectID,oldObjectIndex:canvas.getObjects().indexOf(n[i])})
for(var i=0;i<=n.length-1;i++)canvas.sendBackwards(n[i])
for(var i=0;i<=n.length-1;i++)o[i].newObjectIndex=canvas.getObjects().indexOf(n[i])
t.runHooks("pushUndoData",[{position:!0,objects:o}])}canvas.renderAll(),t.runHooks("updateIframe")},sendToBack:function(){var e,a=(t.getDefaults(),[])
if(canvas.getActiveObject()&&(e=canvas.getActiveObject(),a.push({position:!0,objects:[{objectID:canvas.getActiveObject().objectID,oldObjectIndex:canvas.getObjects().indexOf(e)}]}),canvas.sendToBack(e),a[0].objects[0].newObjectIndex=canvas.getObjects().indexOf(e),t.runHooks("pushUndoData",a)),canvas.getActiveGroup()){for(var n=canvas.getActiveGroup().getObjects(),o=[],i=n.length-1;i>=0;i--)o.push({objectID:n[i].objectID,oldObjectIndex:canvas.getObjects().indexOf(n[i])})
for(var i=n.length-1;i>=0;i--)canvas.sendToBack(n[i])
for(var i=0;i<=n.length-1;i++)o[n.length-1-i].newObjectIndex=canvas.getObjects().indexOf(n[i])
t.runHooks("pushUndoData",[{position:!0,objects:o}])}t.runHooks("updateIframe")},bringToFront:function(){var e,a=(t.getDefaults(),[])
if(canvas.getActiveObject()&&(e=canvas.getActiveObject(),a.push({position:!0,objects:[{objectID:e.objectID,oldObjectIndex:canvas.getObjects().indexOf(e)}]}),canvas.bringToFront(e),a[0].objects[0].newObjectIndex=canvas.getObjects().indexOf(e),t.runHooks("pushUndoData",a)),canvas.getActiveGroup()){var n=canvas.getActiveGroup().getObjects(),o=[]
n.forEach(function(e,t){o.push({objectID:e.objectID,oldObjectIndex:canvas.getObjects().indexOf(e)})})
for(var i=0;i<=n.length-1;i++)canvas.bringToFront(n[i])
for(var i=0;i<=n.length-1;i++)o[i].newObjectIndex=canvas.getObjects().indexOf(n[i])
t.runHooks("pushUndoData"[{position:!0,objects:o}])}t.runHooks("updateIframe")},addHook:function(e,a,n){printqPluggable.PluginHooks.add(e,a,t,n)},addHookOnce:function(e,a,n){printqPluggable.PluginHooks.once(e,a,t,n)},removeHook:function(e,a,n){printqPluggable.PluginHooks.remove(e,a,t,n)},addGlobalHook:function(e,t,a){printqPluggable.PluginHooks.add(e,t,!1,a)},runHooks:function(e,a,n,o,i,r,s){return printqPluggable.PluginHooks.run(t,e,a,n,o,i,r,s)},connectHooks:function(){t.addGlobalHook("positionChange",t.positionChange)},init:function(e){t.getDefaults()
t.connectHooks()}})}(window.jQuery),!function(e){e.widget("printq.persBaseWidget",{version:"1.0.0",mask:[],options:{},_O:function(t){return"string"==typeof t?this.options[t]:"object"==typeof t?e.extend(!0,{},this.options,options):this.options},_create:function(){this.connectHooks()},connectHooks:function(){},getElement:function(t,a){return this[t].length||("undefined"!=typeof a&&a?this[t]=this.element.find(this._O(t)):this[t]=e(this._O(t))),this[t]},addHook:function(e,t,a){printqPluggable.PluginHooks.add(e,t,this,a)},addHookOnce:function(e,t,a){printqPluggable.PluginHooks.once(e,t,this,a)},addGlobalHook:function(e,t,a){printqPluggable.PluginHooks.add(e,t,!1,a)},addGlobalHookOnce:function(e,t,a){printqPluggable.PluginHooks.once(e,t,!1,a)},removeGlobalHook:function(e,t){printqPluggable.PluginHooks.remove(e,t,!1)},removeHook:function(e,t){printqPluggable.PluginHooks.remove(e,t,this)},runHooks:function(e,t,a,n,o,i,r){return printqPluggable.PluginHooks.run(this,e,t,a,n,o,i,r)}})}(window.jQuery),!function(e){e.widget("printq.responsiveWidget",e.printq.persBaseWidget,{version:"1.0.0",mask:[],contentArea:[],options:{contentArea:".area_content",droppableContainer:".droppable",diffAdjustments:.005},_create:function(){this.connectHooks(),e(window).on("resize",function(e){return function(){e.fitPage()}}(this))},connectHooks:function(){this.addGlobalHook("fitPage",this.fitPage,this)},fitPage:function(){var e=this.getElement("contentArea",!0),t=e.find(this._O("droppableContainer"))
t.css({transform:"","transform-origin":"",left:"",top:"","margin-left":"","margin-top":""})
var a=e.get(0).getBoundingClientRect(),n=t.get(0).getBoundingClientRect(),o=a.width/n.width,i=a.height/n.height,r=0,s="",c="",l="",d=""
o<1&&i<1?r=Math.min(o,i)-this._O("diffAdjustments"):(o<1&&(r=o-this._O("diffAdjustments")),i<1&&(r=i-this._O("diffAdjustments"))),r?(s="0",c="0",l=parseInt((a.width-n.width*r)/2),d=parseInt((a.height-n.height*r)/2),t.css({transform:"scale("+r+")","transform-origin":"left top 0px","margin-left":l,"margin-top":d,left:s,top:c})):t.css({transform:"scale(1)","transform-origin":"initial",left:"50%",top:"50%","margin-left":-t.width()/2,"margin-top":-t.height()/2})}})}(window.jQuery),!function(e){e.widget("printq.threedWidget",e.printq.persBaseWidget,{version:"1.0.0",tdIframe:[],mask:[],options:{tdIframe:"#tdIframe"},_create:function(){this.connectHooks()},connectHooks:function(){this.addGlobalHook("updateIframe",this.updateIframe,this)},setTempCanvasDimensions:function(){var e=canvas.getWidth(),t=canvas.getHeight()
tempCanvas.setHeight(t),tempCanvas.setWidth(e)},updateIframe:function(){if("tdpreview"==previewType&&"0"!=iframe_update){var t=JSON.stringify(canvas.toDatalessObject(["objectID","opacity","name"]))
this.setTempCanvasDimensions(),tempCanvas.loadFromDatalessJSON(t,function(){var t=tempCanvas.toDataURL({format:"jpeg",quality:1,left:canvasOffsetWidth,top:canvasOffsetHeight,width:tempCanvas.width-2*canvasOffsetWidth,height:tempCanvas.getHeight()-2*canvasOffsetHeight})
e("iframe#frame_3d").get(0).contentWindow.postMessage(JSON.stringify({image:[t],texture:[[rd_texture,"1"]]}),"*")})}}})}(window.jQuery),!function(e){e.widget("printq.PagePickerWidget",e.printq.persBaseWidget,{version:"1.0.0",pageTemplate:'<li class="page" data-page="{page}" id="item_page_{page}"  data-pagetitle="{text}"  data-pagetitle="{text}" ><a class="clickAction" data-page="{page}" href="javascript:void(0);">{text}<span class="icon printqicon-ok"></span><span class="border_pagination"></span></a></li>',item:"li.page",pageList:[],paginationContainer:".paginationContainer",blurSelectors:".paginationContainer, .paginationContainer .pages, .paginationContainer .pages li.page, #paginationContainer_Edit_Preview",paginationTrigger:[],pagination_icon:[],page2show:0,page_picker:[],canvasContainer:[],current_page_name:[],options:{pageList:".pages",page_picker:"#page_picker_editor",paginationTrigger:"#paginationContainer_Edit_Preview",pagination_icon:"#paginationContainer_Edit_Preview .load span.icon",canvasContainer:".droppable",current_page_name:"#current_page_name"},_create:function(){this.page_picker=[],this.pageList=[]
var e=(this.getElement("page_picker"),this.getElement("pageList",!0))
this.getElement("paginationTrigger")
this.bindEditTriggerPagination()
var t=this.getCurrentPageIndex()
this.resetPagination(t),this.changePage(t),this.bindEventClickPage(),e.mCustomScrollbar({scrollButtons:{enable:!1},theme:"dark-thin",axis:"y",scrollInertia:0}),this.blurThis(),this.connectHooks()},bindEditTriggerPagination:function(){var t=this.getElement("paginationTrigger")
t.off("click.Edit").on("click.Edit",function(t){return function(){var a=e(t.paginationContainer),n=t.getElement("pagination_icon")
n.toggleClass("flip"),a.hasClass("show_pagination")?a.removeClass("show_pagination"):a.addClass("show_pagination")}}(this))},unbindEditTriggerPagination:function(){var e=this.getElement("paginationTrigger")
e.off("click.Edit")},connectHooks:function(){this.addGlobalHook("resetPagination",this.resetPagination,this),this.addGlobalHook("unbindEditTriggerPagination",this.unbindEditTriggerPagination,this),this.addGlobalHook("bindEditTriggerPagination",this.bindEditTriggerPagination,this),this.addGlobalHook("getCurrentPageIndex",this.getCurrentPageIndex,this),this.addGlobalHook("deletePageDesigner",this.deletePageDesigner,this),this.addGlobalHook("setCurrentPageIndex",this.setCurrentPageIndex,this)},blurThis:function(){e(document).off("click.Pagination").on("click.Pagination",function(t){return function(a){var n=!0
e(t.blurSelectors).each(function(){var o=e(this),i=e(a.target)
o[0]==i[0]&&(n=!1)
var r=e(t.blurSelectors).find(a.target)
r.length>0&&(n=!1)}),n&&t.closePagination()}}(this)),this._on(this.element.find(".clickAction"),{mouseup:function(t){var a=(this.element,canvas.getActiveObject()||canvas.getActiveGroup),n=e(t.currentTarget),o=a?n.data("action"):"default"
switch(o){case"add_page":this.runHooks("addPage"),setTimeout(function(e){return function(){var t=e.getCurrentPageIndex()
e.resetPagination(t+1)}}(this),100)
break
case"delete_page":this.deletePageDesigner()}t.stopPropagation()}})},deletePageDesigner:function(){customConfirm(translateStrings.confirmDeletePageText,function(t){return function(){var a,n=t.getCurrentPageIndex()
"undefined"!=typeof themePageContent[n+1]?a=n:"undefined"!=typeof themePageContent[n-1]&&(a=n-1),t.runHooks("deletePage",{currentPage:n,newPageNumber:a}),setTimeout(function(t,a,n){return function(){t.resetPagination(a),e.editorCustomPagination.init({page:a+1})}}(t,a,n),150)}}(this),function(){})},getCurrentPageIndex:function(){var e=this.getElement("canvasContainer")
return parseInt(e.data("page"))},setCurrentPageIndex:function(e){var t=this.getElement("canvasContainer")
t.data("page",e)},changePage:function(e){this.page_picker=[]
var t=this.getElement("page_picker"),a=this.getElement("current_page_name")
this.setCurrentPageIndex(e),t.find(this.item).removeClass("current_page")
var n=t.find("#item_page_"+e)
n.addClass("current_page")
var o=n.data("pagetitle")
a.text(o)},closePagination:function(){var t=e(this.paginationContainer),a=this.getElement("pagination_icon")
t.hasClass("show_pagination")&&(a.toggleClass("flip"),t.removeClass("show_pagination"))},openPagination:function(){var t=e(this.paginationContainer),a=this.getElement("pagination_icon")
a.toggleClass("flip"),t.addClass("show_pagination")},clearPagination:function(){var e=this.getElement("pageList",!0)
e.mCustomScrollbar("destroy"),e.html("")},addPage:function(t){var a=this.getElement("pageList",!0),n=this.pageTemplate
n=n.replace(/{page}/g,t),n=n.replace(/{text}/g,translateStrings.page+" "+(t+1)),n=e(n),a.append(n)},bindEventClickPage:function(){var t=this.getElement("pageList",!0)
t.find(this.item).off("click").on("click",function(t){return function(){var a=e(this).data("page"),n=t.getCurrentPageIndex()
parseInt(a)!=parseInt(n)&&themePageContent[a]&&(e("body").toggleClass("loading_canvas"),t.changePage(a),setTimeout(function(){t.runHooks("getCanvasPageForPreview",n),t.runHooks("loadCanvas",themePageContent[a])},100))}}(this))},resetPagination:function(t){var t=t?parseInt(t):0,a=this.getElement("pageList")
this.clearPagination()
this.getElement("canvasContainer")
this.setCurrentPageIndex(t),e.each(themePageContent,function(e){return function(t,a){e.addPage(t)}}(this)),a.mCustomScrollbar({scrollButtons:{enable:!1},theme:"dark-thin",axis:"y",scrollInertia:0}),this.bindEventClickPage(),this.changePage(t)}})}(window.jQuery),!function(e){e.widget("printq.PagePickerWidgetPreview",e.printq.persBaseWidget,{version:"1.0.0",pageTemplate:'<li class="page" data-page="{page}" id="item_page_{page}"  data-pagetitle="{text}"  data-pagetitle="{text}" ><a class="clickAction" data-page="{page}" href="javascript:void(0);">{text}<span class="icon printqicon-ok"></span><span class="border_pagination"></span></a></li>',item:"li.page",pageList:[],current_page:[],paginationContainer:".paginationPreviewContainer",blurSelectors:".paginationPreviewContainer, .paginationPreviewContainer .pages, .paginationPreviewContainer .pages li.page, #paginationContainer_Edit_Preview",paginationTrigger:[],pagination_icon:[],page2show:0,page_picker:[],canvasContainer:[],current_page_name:[],options:{pageList:".pages",page_picker:"#page_picker_preview",current_page:".current_page",paginationTrigger:"#paginationContainer_Edit_Preview",pagination_icon:"#paginationContainer_Edit_Preview .load span.icon",canvasContainer:".droppable",current_page_name:"#current_page_name"},_create:function(){this.pageList=[]
var e=this.getElement("pageList",!0)
e.mCustomScrollbar({scrollButtons:{enable:!1},theme:"dark-thin",axis:"y",scrollInertia:0}),this.blurThis(),this.connectHooks()},createPaginationPreview:function(){this.page_picker=[],this.pageList=[]
this.getElement("page_picker"),this.getElement("pageList",!0),this.getElement("paginationTrigger")
this.clearPagination(),e.each(themePageContent,function(e){return function(t,a){e.addPage(t)}}(this)),this.runHooks("unbindEditTriggerPagination"),this.bindPreviewTriggerPagination(),this.bindEventClickPage(),this.changePage(0)},bindPreviewTriggerPagination:function(){var t=this.getElement("paginationTrigger")
t.off("click.Preview").on("click.Preview",function(t){return function(){var a=e(t.paginationContainer),n=t.getElement("pagination_icon")
n.toggleClass("flip"),a.hasClass("show_pagination")?a.removeClass("show_pagination"):a.addClass("show_pagination")}}(this))},unbindPreviewTriggerPagination:function(){var e=this.getElement("paginationTrigger")
e.off("click.Preview")},connectHooks:function(){this.addGlobalHook("bindPreviewTriggerPagination",this.bindPreviewTriggerPagination,this),this.addGlobalHook("unbindPreviewTriggerPagination",this.unbindPreviewTriggerPagination,this),this.addGlobalHook("createPaginationPreview",this.createPaginationPreview,this)},blurThis:function(){e(document).off("click.PaginationPreview").on("click.PaginationPreview",function(t){return function(a){var n=!0
e(t.blurSelectors).each(function(){var o=e(this),i=e(a.target)
o[0]==i[0]&&(n=!1)
var r=e(t.blurSelectors).find(a.target)
r.length>0&&(n=!1)}),n&&t.closePagination()}}(this))},getCurrentPageIndex:function(){this.current_page=[]
var e=this.getElement("current_page",!0)
return parseInt(e.data("page"))},changePage:function(e){this.page_picker=[]
var t=this.getElement("page_picker"),a=this.getElement("current_page_name")
t.find(this.item).removeClass("current_page")
var n=t.find("#item_page_"+e)
n.addClass("current_page")
var o=n.data("pagetitle")
a.text(o)},closePagination:function(){var t=e(this.paginationContainer),a=this.getElement("pagination_icon")
t.hasClass("show_pagination")&&(a.toggleClass("flip"),t.removeClass("show_pagination"))},openPagination:function(){var t=e(this.paginationContainer),a=this.getElement("pagination_icon")
a.toggleClass("flip"),t.addClass("show_pagination")},clearPagination:function(){var e=this.getElement("pageList",!0)
e.html("")},addPage:function(t){var a=this.getElement("pageList",!0),n=this.pageTemplate
n=n.replace(/{page}/g,t),n=n.replace(/{text}/g,translateStrings.page+" "+(t+1)),n=e(n),a.append(n)},bindEventClickPage:function(){var t=this.getElement("pageList",!0)
t.find(this.item).off("click").on("click",function(t){return function(){var a=e(this).data("page"),n=t.getCurrentPageIndex()
parseInt(a)!=parseInt(n)&&t.changePage(a)}}(this))}})}(window.jQuery),!function(e){e.widget("printq.objectListSelect",e.printq.persBaseWidget,{version:"1.0.0",listObjectTemplate:"<li data-id='{objectId}'><a class='clickAction' href='javascript:void(0);'>{shapeName} <span class='icon printqicon-ok'></a> <span class ='border_pagination'></span></li>",notransition:"notransition",activeObjectList:"current_object",canvasContainer:[],listContainer:[],status:"close",options:{hide:{top:"-1500px",left:"-1500px"},canvasContainer:".droppable >.canvas-container",listContainer:"#contextMenuCanvasRightClick ul"},_create:function(){this.connectHooks(),this.bindEvents(),this.element.on("contextmenu",function(){return!1})},bindEvents:function(){this.getElement("canvasContainer")
canvas.on("mouse:up:rightClick",function(t){return function(a){if(!canvas.isDrawingMode&&!canvas.enableBackgroundMove){t.element.addClass(t.notransition),t.close()
var n,o=canvas.findAllTarget(a),i=(canvas.getPointer(a,!0),t.getElement("listContainer")),r=-1
canvas.getActiveObject()&&(r=canvas.getActiveObject().objectID),canvas.getActiveGroup()&&(r=canvas.getActiveGroup().objectID),o.length&&(t.clearContainer(),e.each(o,function(t,a,n){return function(o,r){a=t.listObjectTemplate.replace(/{objectId}/g,r.objectID),a=a.replace(/{shapeName}/g,"Shape "+(o+1)),a=e(a),n===r.objectID&&e(a).addClass(t.activeObjectList),a.on("click",function(t){return function(a){fabric.selectedRightClickObjectPosition!=-1&&canvas.getActiveObject()&&(canvas.moveTo(canvas.getActiveObject(),fabric.selectedRightClickObjectPosition),fabric.selectedRightClickObjectPosition=-1)
var n=e(this).data("id"),o=canvas.getObjectByID(n)
o.length&&(canvas.setActiveObject(o[0]),canvas.fire("mouse:up",{e:a,target:o[0]}),fabric.selectedRightClickObjectPosition=canvas.getObjects().indexOf(canvas.getActiveObject()),canvas.moveTo(o[0],canvas.getObjects().length-canvas.helpersInCanvas-1),t.close()),a.stopPropagation()}}(t)),i.append(a)}}(t,n,r)),t.setPosition(a),t.status="open")}}}(this)),canvas.on("mouse:down",function(e){return function(){e.close()}}(this))},unbindEvents:function(){e(canvasElement).off("mouse:up:rightClick")},clearContainer:function(){var e=this.getElement("listContainer")
e.html("")},setPosition:function(e){e&&(this.element.removeClass(this.notransition),this.element.css({left:e.x,top:e.y,"max-height":"290px"}))},open:function(){},close:function(){if("close"!==this.status){var e=this._O("hide")
this.element.css({left:e.left,top:e.top,"max-height":0})}},connectHooks:function(){this.addGlobalHook("bindEventsObjectListSelect",this.bindEvents,this),this.addGlobalHook("unbindEventsObjectListSelect",this.unbindEvents,this),this.addGlobalHook("closeObjectListSelect",this.close,this)}})}(window.jQuery),!function(e){e.widget("printq.sidebarWidget",e.printq.persBaseWidget,{version:"1.0.0",sidebarContainer:[],layoutsGallery:[],shapesGallery:[],backgroundsGallery:[],mainTrigger:[],mainItem:[],subTrigger:[],layoutItem:[],backgroundItem:[],shapesGalleryList:[],pagesContainer:[],maximizeContainer:[],draggable_group:[],snap_group:[],resizable_group:[],rotatable_group:[],cancelLoading:!0,loadProjectFrame:[],loadProjectFrameMobile:[],saveProject:[],saveProjectFrame:[],zoom_text_group:[],layoutsContainerMobile:[],backgroundsContainerMobile:[],shapesContainerMobile:[],shapeItemTemplate:[],shapesCategoryItem:[],shapesGalleryContainer:[],shapesCategoryContainer:[],subTriggerDrawing:[],mask:"#loading-mask",templateLoadProject:'<li id="project_{project_id}" class="body"><div class="projectName"><span>{project_name}</span></div><div class="projectDescription"><span>{project_description}</span></div><div><input type="hidden" name="projectId" value="{project_id}"/><button id="load" class="button" title="{load}" type="button"><span><span>{load}</span></span></button><button id="delete" class="button btn-cart" title="{delete}" type="button"><span><span>{delete}</span></span></button></div><span class="span_border"></span></li>',lockGetShapes:!1,currentShapeCategory:"",shapesFrames:"categories categories_expand",blurSelectors:".mainMenu",blurSelectorsDrawing:"#loadProjectFrame, #saveProjectFrame, #saveProject,#loadProject,.subTriggerDrawing, .droppable, .freeDrawingOptions, .canvas-container, .upper-canvas",movableButton:[],rotatableButton:[],resizableButton:[],options:{sidebarContainer:".aside.sidebar",layoutsGallery:"ul.mainMenu li.mainItem .layoutsGallery",shapesGallery:"ul.mainMenu li.mainItem .shapesGallery",backgroundsGallery:"ul.mainMenu li.mainItem .backgroundsGallery",mainTrigger:"ul.mainMenu li.mainItem a.mainTrigger",mainItem:"ul.mainMenu li.mainItem",subTrigger:"div.submenu li.subItem a.subTrigger",subTriggerDrawing:"div.submenu li.subItem a.subTriggerDrawing",layoutItem:"ul.mainMenu li.mainItem .layoutsGallery .container",backgroundItem:"ul.mainMenu li.mainItem .backgroundsGallery .container",shapesGalleryList:"ul.mainMenu li.mainItem .shapesGallery .shapesGalleryList",shapesGalleryContainer:"ul.mainMenu li.mainItem .shapesGallery .shapesGalleryContainer",maximizeContainer:".maximizeContainer",pagesContainer:"#subcontent #edit_tab .pages",draggable_group:"draggable_group",snap_group:"snap_group",resizable_group:"resizable_group",rotatable_group:"rotatable_group",saveProjectFrame:"#saveProjectFrame",loadProjectFrame:"#loadProjectFrame",loadProjectFrameMobile:"#loadProjectFrameMobile",zoom_text_group:".zoom_text_group",layoutsContainerMobile:".layoutsContainerMobile",backgroundsContainerMobile:".backgroundsContainerMobile",shapesContainerMobile:".shapesContainerMobile",shapeItemTemplate:"#shapePlaceholderSidebar",shapesCategoryItem:"ul.shapesCategoryList li.listItem",shapesCategoryContainer:".shapesCategoryContainer",movableButton:".block_option_move",rotatableButton:".block_option_rotate",resizableButton:".block_option_resize"},drawCircle:!1,drawSquare:!1,drawFree:!1,shape:null,optionsFreeDrawing:{},_create:function(){this._super()
var t=this.getElement("layoutsGallery",!0),a=this.getElement("shapesGalleryContainer",!0),n=this.getElement("shapesCategoryContainer",!0),o=this.getElement("mainTrigger",!0),i=this.getElement("subTrigger",!0),r=this.getElement("maximizeContainer"),s=this.getElement("layoutItem",!0),c=this.getElement("subTriggerDrawing",!0),l=this.getElement("shapesCategoryItem",!0),d=this.getElement("loadProjectFrame",!0)
d.mCustomScrollbar({scrollButtons:{enable:!1},theme:"white",axis:"y"}),t.mCustomScrollbar({scrollButtons:{enable:!1},theme:"white",axis:"y"}),n.mCustomScrollbar({scrollButtons:{enable:!1},theme:"white",axis:"y"}),a.mCustomScrollbar({scrollButtons:{enable:!1},theme:"white",axis:"y",callbacks:{whileScrolling:function(e){return function(){var t=this.mcs.topPct
t>94&&!e.lockGetShapes&&(e.lockGetShapes=!0,e.getShapes({category:e.currentShapeCategory,ignoreEmpty:!0}))}}(this)}}),this.changeShapeFrame("categories"),this.initShapes(),c.off("click").on("click",function(e){return function(){var t=e.getElement("mainItem",!0)
t.removeClass("active")}}(this)),o.off("click").on("click",function(t){return function(){var a=e(this).parent(),n=t.getElement("mainItem",!0),o=a.data("type")
e("body").removeClass("side-gallery-open"),e("body").removeClass("save_project_frame_expanded"),e("body").removeClass("load_project_frame_expanded"),a.hasClass("active")?n.removeClass("active"):(n.removeClass("active"),a.addClass("active"),"layouts"!=o&&"backgrounds"!=o&&"shapes"!=o||e("body").addClass("side-gallery-open"),"textBox"!=o&&"curvedText"!=o&&(t.runHooks("disableAddTextBox"),t.runHooks("disableCurvedText")))}}(this)),i.off("click").on("click",function(){var t=e(this).parent()
t.toggleClass("active")}),s.off("click").on("click",function(t){return function(){var a=e(this),n=a.parent(),o=n.data("id"),i=t.getElement("layoutItem",!0)
a.hasClass("selected")||(i.removeClass("selected"),a.addClass("selected"),t.loadLayout(o))}}(this)),r.off("click").on("click",function(){e("body").toggleClass("expand")}),l.off("click").on("click",function(t){return function(){var a=e(this).data("target")
t.currentShapeCategory=a,t.changeShapeFrame("categories_expand"),t.getShapes({category:a,ignoreEmpty:!1})}}(this)),fabric.lockMovable=!this.getElement("movableButton").hasClass("active"),fabric.lockResizable=!this.getElement("resizableButton").hasClass("active"),fabric.lockRotation=!this.getElement("rotatableButton").hasClass("active"),this._on(this.element.find(".clickActionSidebar"),{click:function(t){var a=e(t.currentTarget),n=a.data("action")
a.data("state")||!1
switch(n){case"movable_changer":fabric.lockMovable=!fabric.lockMovable
break
case"resize_changer":fabric.lockResizable=!fabric.lockResizable
break
case"rotate_changer":fabric.lockRotation=!fabric.lockRotation
break
case"draw_circle":this.drawCircle=!0,this.drawSquare=!1,canvas.isDrawingMode=!1,canvas.defaultCursor="crosshair",canvas.disableObjectSelect=!0,a.parent().parent().find("li").removeClass("active"),canvas.deactivateAllWithDispatch(),canvas.renderAll()
break
case"draw_square":this.drawSquare=!0,this.drawCircle=!1,canvas.disableObjectSelect=!0,canvas.isDrawingMode=!1,canvas.defaultCursor="crosshair",a.parent().parent().find("li").removeClass("active"),canvas.deactivateAllWithDispatch(),canvas.renderAll()
break
case"draw_free":this.drawFree=!0,this.drawSquare=!1,this.drawCircle=!1,canvas.isDrawingMode=!0,a.parent().hasClass("active")?canvas.isDrawingMode=!1:canvas.isDrawingMode=!0,canvas.deactivateAllWithDispatch(),a.parent().toggleClass("active"),canvas.renderAll()
break
case"snap_changer":this.runHooks("onOffSnap")
break
case"snapAction":break
case"addCurvedText":this.runHooks("addCurvedText",function(e,t){return function(){t.parent().parent().removeClass("active")}}(this,a))
break
case"addTextBox":this.runHooks("addTextBox",function(e,t){return function(){t.parent().parent().removeClass("active")}}(this,a))
break
case"disableAddTextBox":this.runHooks("disableAddTextBox")
break
case"disableCurvedText":this.runHooks("disableCurvedText")
break
case"save-project":var o=this.getElement("saveProjectFrame",!0)
this.runHooks("saveProject",o)
break
case"save-new-project":var o=this.getElement("saveProjectFrame",!0)
this.runHooks("saveProject",o,!0)
break
case"zoomIn":var i=this.getElement("zoom_text_group")
this.runHooks("zoomIn",i)
break
case"zoomOut":var i=this.getElement("zoom_text_group")
this.runHooks("zoomOut",i)
break
case"back-shapes-category":this.changeShapeFrame("categories")}}})
var u=this.getElement("zoom_text_group")
this.runHooks("mouseZoomInit",u),this.selectDefaultLayout(),this.init()},populateLoadProjects:function(t){var a=this.templateLoadProject,n=this.getElement("loadProjectFrame",!0)
n.find("#noProjects").length&&n.find("#noProjects").remove(),a=a.replace(/{project_id}/g,t.id),a=a.replace(/{project_name}/g,t.project_name),a=a.replace(/{project_description}/g,t.project_description),a=a.replace(/{delete}/g,translateStrings.delete),a=a.replace(/{load}/g,translateStrings.load)
var o=e("#project_"+t.id,n)
o.length?o.replaceWith(e(a)):n.find("ul").append(e(a)),this.runHooks("resetLoadProjectFrameButtons")
var i=this.getElement("saveProjectFrame")
e("#projectName",i).val(t.project_name),e("#projectDescription",i).val(t.project_description),e("#projectId",i).val(t.id)},deleteProjectFromList:function(t){var a=this.getElement("loadProjectFrame",!0),n=this.getElement("loadProjectFrameMobile"),o=a.find("li#project_"+t),i=n.find("li#project_"+t)
o.length&&o.remove(),i.length&&i.remove(),t==e("#projectId").val()&&e("#projectId").val("")},changeShapeFrame:function(e){this.element.data("offset",0)
var t=this.getElement("shapesGallery")
t&&(t.removeClass(this.shapesFrames),t.addClass(e))},connectHooks:function(){this.addGlobalHook("makeBackgroundImageSelected",this.makeBackgroundImageSelected,this),this.addGlobalHook("loadShape",this.loadShape,this),this.addGlobalHook("populateLoadProjects",this.populateLoadProjects,this),this.addGlobalHook("deleteProjectFromList",this.deleteProjectFromList,this),this.addGlobalHook("loadLayout",this.loadLayout,this),this.addGlobalHook("makeActualLayoutSelected",this.makeActualLayoutSelected,this),this.addGlobalHook("loadShapeMobile",this.loadShapeMobile,this)},init:function(){this.initLoadProject(),this.initSaveProject(),this.blurThis(),this.observe()},initLoadProject:function(){var t=this.element
t.find("#loadProject").off("click").on("click",function(){e(this).hasClass("disabled")||e("body").addClass("load_project_frame_expanded")})},initSaveProject:function(){var t=this.element
t.find("#saveProject").off("click").on("click",function(){e(this).hasClass("disabled")||e("body").addClass("save_project_frame_expanded")})},observe:function(){canvas.on("before:mouse:down",function(e){return function(t){(e.drawSquare||e.drawCircle)&&(canvas.selection=!1)}}(this)),canvas.on("mouse:down",function(e){return function(t){if(e.drawSquare){var a=canvas.getPointer(t.e)
e.optionsFreeDrawing.origX=a.x,e.optionsFreeDrawing.origY=a.y,e.shape=new fabric.Rect({left:a.x,top:a.y,originX:"center",originY:"center",width:0,height:0,angle:0,fill:"#000000",strokeWidth:0,stroke:"#000000"}),canvas.insertAt(e.shape,canvas.getObjects().length-canvas.helpersInCanvas,!1)}if(e.drawCircle){var a=canvas.getPointer(t.e)
e.optionsFreeDrawing.origX=a.x,e.optionsFreeDrawing.origY=a.y,e.shape=new fabric.Circle({left:a.x,top:a.y,originX:"center",originY:"center",radius:0,fill:"#000000",strokeWidth:0,stroke:"#000000"}),canvas.insertAt(e.shape,canvas.getObjects().length-canvas.helpersInCanvas,!1)}}}(this)),canvas.on("mouse:move",function(e){return function(t){if(e.drawSquare&&e.shape){var a=canvas.getPointer(t.e)
e.optionsFreeDrawing.origX>a.x&&e.shape.set({left:Math.abs(a.x)}),e.optionsFreeDrawing.origY>a.y&&e.shape.set({top:Math.abs(a.y)}),e.shape.set({width:Math.abs(e.optionsFreeDrawing.origX-a.x)}),e.shape.set({height:Math.abs(e.optionsFreeDrawing.origY-a.y)}),canvas.renderAll()}if(e.drawCircle&&e.shape){var a=canvas.getPointer(t.e)
e.shape.set({radius:Math.abs(e.optionsFreeDrawing.origX-a.x)}),canvas.renderAll()}}}(this)),canvas.on("mouse:up",function(e){return function(t){(e.drawSquare||e.drawCircle)&&e.shape&&(e.shape.setCoords(),canvas.renderAll(),e.runHooks("pushUndoData",[{objectID:e.shape.objectID,added:e.shape}]),e.resetFreeDrawing())}}(this))},resetFreeDrawing:function(){this.shape=null,this.drawSquare=!1,this.drawCircle=!1,canvas.isDrawingMode=!1,canvas.selection=!0,canvas.disableObjectSelect=!1,canvas.defaultCursor="default",this.optionsFreeDrawing={}},initShapes:function(){var t=this.getElement("shapesGalleryList")
t.find("li").draggable({containment:"body",appendTo:"body",revert:"invalid",revertDuration:500,helper:"clone",start:function(){},stack:"LI"}),t.find("li").data({type:"shape"}).off("click").on("click",function(t){return function(){t.loadShape({item:e(this).find("a")})}}(this))},initShape:function(t){t.draggable({containment:"body",appendTo:"body",revert:"invalid",revertDuration:500,helper:"clone",start:function(){},stack:"LI"}),t.data({type:"shape"}).off("click").on("click",function(t){return function(){t.loadShape({item:e(this).find("a")})}}(this))},loadLayout:function(t){t&&(e("body").toggleClass("loading_canvas"),this.runHooks("closeObjectListSelect"),e.printqAjaxRequest.postRequest({url:baseUrl+"openeditor/theme/theme",data:{theme_id:t},onComplete:function(t){return function(a){a&&(fabric.selectedRightClickObjectPosition=-1,themePageContent=a.items.items,t.runHooks("resetPagination"),e.editorCustomPagination.init({page:1}),t.runHooks("loadCanvas",themePageContent[0]))}}(this),onFail:function(t){return function(t){e("body").toggleClass("loading_canvas")}}(this)}))},makeBackgroundImageSelected:function(){var e=null,t=null,a=this.getElement("backgroundsGallery",!0),n=this.getElement("backgroundsContainerMobile")
if("undefined"!=typeof canvas.backgroundImage&&null!=canvas.backgroundImage&&""!=canvas.backgroundImage){e=canvas.backgroundImage.getSrc(),t=e.split("/")[e.split("/").length-1]
var o=a.find("li[data-name ='"+t+"']"),i=n.find("li a[data-name ='"+t+"']")
o.length&&i.length?(a.find("li a").removeClass("selected"),o.find("a").addClass("selected"),n.find("li a").removeClass("active"),i.addClass("active")):(a.find("li a").removeClass("selected"),n.find("li a").removeClass("active"))}else a.find("li a").removeClass("selected"),n.find("li a").removeClass("active")},getShapes:function(t){var a=this.element.data("offset"),n="undefined"!=typeof t.ignoreEmpty&&t.ignoreEmpty,o="undefined"!=typeof t.category&&t.category
n||this.getElement("shapesGalleryList").html(""),e.printqAjaxRequest.postRequest({url:getShapesUrl,mask:"",data:{offset:a,category:o},onComplete:function(t){return function(a){if(a.success&&"undefined"!=typeof a.shapes&&a.shapes.length){var n=t.getElement("shapeItemTemplate").html(),o=t.getElement("shapesGalleryList"),i=parseInt(t.element.data("offset"))
t.element.data("offset",i+a.shapes.length),e.each(a.shapes,function(t,n,o){return function(i,r){var s="shape_"+Math.random().toString(36).substring(5),c=e(n)
c.addClass(s),o.append(c),e("<img/>").attr("src",shapeUrlLocation+a.category+r).load(function(e,t,n){return function(){var o=t.find("li."+e)
o.removeClass("empty"),o.find(".animation-container").remove(),o.find("a").css({"background-image":"url("+shapeUrlLocation+a.category+r+")"}),o.removeClass(e),n.initShape(o)}}(s,o,t))}}(t,n,o)),t.lockGetShapes=!1}}}(this),onFail:function(e){return function(){alert(translateStrings.error),e.lockGetShapes=!1}}(this)})},loadShape:function(e){if(e){var t={},a=e.ui?e.ui.draggable.find("a"):e.item,n=null,o=null,i=canvas.getWidth(),r=canvas.getHeight()
if(t=e.event?{x:canvas.getPointer(e.event).x,y:canvas.getPointer(e.event).y}:{x:canvas.getCenter().left,y:canvas.getCenter().top},a.length){var s=a.css("background-image")
n=s.replace("url(","").replace(")","").replace(/"/g,"").replace(/'/g,""),fabric.loadSVGFromURL(n,function(e,t,a,n){return function(i,r){if(i.length){o=new fabric.PathGroup(i,r)
var s=o.paths
for(var c in s)s[c].set({originX:"center",originY:"center"}),"line"==s[c].type&&s[c].set({left:s[c].left+s[c].width/2,top:s[c].top+s[c].height/2})}else o=i[0]
if(o.set({left:n.x,top:n.y,angle:0,originX:"center",originY:"center",opacity:1,hasRotatingPoint:!0}),o.width>=t||o.height>=a){var l=t/o.width,d=a/o.height
l>=d?o.set({scaleX:d,scaleY:d}):o.set({scaleX:l,scaleY:l})}o.width<200&&o.height<200&&o.set({scaleX:200/o.getWidth(),scaleY:200/o.getHeight()}),canvas.insertAt(o,canvas.getObjects().length-canvas.helpersInCanvas,!1),canvas.calcOffset(),canvas.renderAll(),e.runHooks("pushUndoData",[{objectID:o.objectID,added:o}]),e.runHooks("updateIframe"),canvas.setActiveObject(o)}}(this,i,r,t))}}},loadShapeMobile:function(e){var t={x:canvas.getCenter().left,y:canvas.getCenter().top},a=canvas.getWidth(),n=canvas.getHeight()
e&&fabric.loadSVGFromURL(e,function(e,t,a,n){return function(o,i){if(o.length){var r=new fabric.PathGroup(o,i),s=r.paths
for(var c in s)s[c].set({originX:"center",originY:"center"}),"line"==s[c].type&&s[c].set({left:s[c].left+s[c].width/2,top:s[c].top+s[c].height/2})}else var r=o[0]
if(r.set({left:n.x,top:n.y,angle:0,originX:"center",originY:"center",opacity:1,hasRotatingPoint:!0}),r.width>=t||r.height>=a){var l=t/r.width,d=a/r.height
l>=d?r.set({scaleX:d,scaleY:d}):r.set({scaleX:l,scaleY:l})}r.width<350&&r.height<350&&r.set({scaleX:5,scaleY:5}),canvas.insertAt(r,canvas.getObjects().length-canvas.helpersInCanvas,!1),canvas.calcOffset(),canvas.renderAll(),canvas.setActiveObject(r),e.runHooks("pushUndoData",[{objectID:r.objectID,added:r}])}}(this,a,n,t))},selectDefaultLayout:function(){var e=this.getElement("layoutsGallery",!0),t=e.find("li[data-id='"+defaultThemeID+"']")
t.length?(e.find("li a").removeClass("selected"),t.find("a").addClass("selected")):(e.find("li a").removeClass("selected"),t.find("a").addClass("selected"))
var a=this.getElement("layoutsContainerMobile"),n=a.find("a[data-id='"+defaultThemeID+"']")
n.length&&(a.find("li a").removeClass("active"),n.addClass("active"))},makeActualLayoutSelected:function(e){var t=this.getElement("layoutsGallery",!0),a=t.find("li[data-id='"+e+"']")
a.length?(t.find("li a").removeClass("selected"),a.find("a").addClass("selected")):(t.find("li a").removeClass("selected"),a.find("a").addClass("selected"))
var n=this.getElement("layoutsContainerMobile"),o=n.find("a[data-id='"+e+"']")
o.length&&(n.find("li a").removeClass("active"),o.addClass("active"))},blurThis:function(){e(document).off("click.PSW").on("click.PSW",function(t){return function(a){var n=!0
e(t.blurSelectors).each(function(){var o=e(this),i=e(a.target)
o[0]==i[0]&&(n=!1)
var r=e(t.blurSelectors).find(a.target)
r.length>0&&(n=!1)}),n&&((e("body").hasClass("load_project_frame_expanded")||e("body").hasClass("save_project_frame_expanded"))&&e(".save_load_group").removeClass("active"),e("li.mainItem").removeClass("active"),e("body").toggleClass("load_project_frame_expanded save_project_frame_expanded",!1),e("body").removeClass("side-gallery-open"))}}(this)),e(document).off("click.DFD").on("click.DFD",function(t){return function(a){var n=!0
e(t.blurSelectorsDrawing).each(function(){var o=e(this),i=e(a.target)
o[0]==i[0]&&(n=!1)
var r=e(t.blurSelectorsDrawing).find(a.target)
r.length>0&&(n=!1)}),n&&(t.drawSquare=!1,t.drawCircle=!1,t.drawFree=!1,canvas.isDrawingMode=!1,canvas.disableObjectSelect=!1,e(".subTriggerDrawing").parent().removeClass("active"))}}(this))}})}(window.jQuery),!function(e){e.widget("printq.persBaseToolbar",e.printq.persBaseWidget,{version:"1.0.0",defaultElement:null,currentBlock:null,options:{open:function(e,t){console.log("open callback",t)}},defaults:{},_create:function(){this.connectHooks()},startToolbar:function(e){},connectHooks:function(){},open:function(){this.setPosition()},setPosition:function(){var t,a,n=canvas.getActiveObject()||canvas.getActiveGroup(),o=n.translateToOriginPoint(n.getCenterPoint(),"center","top"),i=fabric.util.transformPoint(o,canvas.viewportTransform,!1),r=this.element,s=e(".droppable > .canvas-container").offset(),c=r.width(),l=/matrix\((-?\d*\.?\d+),\s*0,\s*0,\s*(-?\d*\.?\d+),\s*0,\s*0\)/,d=e(".droppable"),u=d.css("-webkit-transform")||d.css("-moz-transform")||d.css("-ms-transform")||d.css("-o-transform")||d.css("transform")||!1,g=u?u.match(l):[]
g.length&&parseFloat(g[1])<1&&(i.x*=parseFloat(g[1]),i.y*=parseFloat(g[1]))
var f=n.angle%360
if(45<=f&&f<=135?(t=s.left+i.x+n.rotatingPointOffset+20,a=s.top+i.y-r.height()/2):135<f&&f<=225?(t=s.left+i.x-c/2,a=s.top+i.y+n.rotatingPointOffset+20):225<f&&f<=315?(t=s.left+i.x-n.rotatingPointOffset-20-c,a=s.top+i.y-r.height()/2):(t=s.left+i.x-c/2,a=s.top+i.y-r.height()-n.rotatingPointOffset-20),a<0){var h=n.translateToOriginPoint(n.getCenterPoint(),"center","bottom"),p=fabric.util.transformPoint(h,canvas.viewportTransform,!1)
a=s.top+p.y+10}t<4&&(t=4),r.css("left",t),r.css("top",a),r.data("currentLeftPos",t),r.removeClass("right")},baseHook:function(){console.log("base hook")}})}(window.jQuery),!function(e){e.widget("printq.persTransparencyToolbar",e.printq.persBaseWidget,{version:"1.0.0",defaultElement:null,slider:[],options:{slider:"#transparencySlider",hide:{top:"-1500px",left:"-1500px"}},_create:function(){this.connectHooks()},checkSlider:function(){return this.slider.length?"undefined"!=typeof this.slider.data("uiSlider")||"undefined"!=typeof this.slider.data("ui-slider")||(this.createSlider(),!0):(this.createSlider(),!0)},createSlider:function(){var t=this.getElement("slider",!0),a=0
return t.slider({start:function(e){return function(e,t){a=t.value}}(this),slide:function(t){return function(t,a){e(this).data("ui-slider")
canvas.getActiveGroup()&&canvas.getActiveGroup().setOpacity(a.value/100),canvas.getActiveObject()&&canvas.getActiveObject().setOpacity(a.value/100),canvas.renderAll()}}(this),stop:function(e){return function(t,n){if(canvas.getActiveGroup()){var o=[]
for(var i in canvas.getActiveGroup().getObjects()){var r=canvas.getActiveGroup().getObjects()[i]
o.push({objectID:r.objectID,oldStage:{opacity:a/100},newStage:{opacity:n.value/100}})}e.runHooks("pushUndoData",o)}if(canvas.getActiveObject()){var o=[{objectID:canvas.getActiveObject().objectID,oldStage:{opacity:a/100},newStage:{opacity:n.value/100}}]
e.runHooks("pushUndoData",o)}e.runHooks("updateIframe")}}(this)}),!0},connectHooks:function(){this.addGlobalHook("doOtherToolbarTransparency",this.onTransparencyHookCallback,this),this.addGlobalHook("doTextToolbarTransparency",this.onTransparencyHookCallback,this),this.addGlobalHook("doImageToolbarTransparency",this.onTransparencyHookCallback,this),this.addGlobalHook("afterCloseChangers",this.onAfterCloseChangersHookCallback,this),this.addGlobalHook("afterCloseToolbar",this.onAfterCloseToolbarHookCallback,this)},onAfterCloseToolbarHookCallback:function(){this.close()},onAfterCloseChangersHookCallback:function(e){"transparency"!=e&&this.close()},onTransparencyHookCallback:function(){this.element.hasClass("edit")?this.close():this.open()},open:function(){this.element.addClass("edit"),this.setPosition(),this.setDefault()},close:function(){var e=this._O("hide")
this.element.removeClass("edit").css({top:e.top,left:e.left})},setPosition:function(){var t=canvas.getActiveObject()||canvas.getActiveGroup(),a=e(".droppable > .canvas-container").offset(),n=t.translateToOriginPoint(t.getCenterPoint(),"center","top"),o=fabric.util.transformPoint(n,canvas.viewportTransform,!1),i=(e(window).width(),this.element),r=(i.width(),e(window).width(),/matrix\((-?\d*\.?\d+),\s*0,\s*0,\s*(-?\d*\.?\d+),\s*0,\s*0\)/),s=e(".droppable"),c=s.css("-webkit-transform")||s.css("-moz-transform")||s.css("-ms-transform")||s.css("-o-transform")||s.css("transform")||!1,l=c?c.match(r):[]
l.length&&parseFloat(l[1])<1&&(o.y*=parseFloat(l[1]),o.x*=parseFloat(l[1])),i.hasClass("edit")&&(i.css("top",o.y+a.top-i.height()/2),i.css("left",o.x+a.left-i.width()/2))},setDefault:function(){var e=(this.element,canvas.getActiveObject()||canvas.getActiveGroup())
if(this.checkSlider()){var t=e.getOpacity()
this.slider.slider("value",100*t)}}})}(window.jQuery),!function(e){e.widget("printq.persSpacingToolbar",e.printq.persBaseWidget,{version:"1.0.0",defaultElement:null,slider:[],options:{slider:"#editor_curvedspacing_slider",hide:{top:"-1500px",left:"-1500px"}},_create:function(){this.connectHooks()},checkSlider:function(){return this.slider.length?"undefined"!=typeof this.slider.data("uiSlider")||"undefined"!=typeof this.slider.data("ui-slider")||(this.createSlider(),!0):(this.createSlider(),!0)},createSlider:function(){var t=this.getElement("slider",!0),a=0
return t.slider({min:1,max:20,start:function(e){return function(e,t){a=t.value}}(this),slide:function(t){return function(t,a){e(this).data("ui-slider")
canvas.getActiveObject()&&(canvas.getActiveObject().spacing=a.value),canvas.renderAll()}}(this),stop:function(e){return function(t,n){if(canvas.getActiveObject()&&canvas.getActiveObject().curvedText){var o=[{objectID:canvas.getActiveObject().objectID,oldStage:{spacing:a},newStage:{spacing:n.value}}]
e.runHooks("pushUndoData",o)}e.runHooks("updateIframe")}}(this)}),!0},connectHooks:function(){this.addGlobalHook("doTextToolbarSpacingCurved",this.onSpacingCurvedHookCallback,this),this.addGlobalHook("afterCloseChangers",this.onAfterCloseChangersHookCallback,this),this.addGlobalHook("afterCloseToolbar",this.onAfterCloseToolbarHookCallback,this)},onAfterCloseToolbarHookCallback:function(){this.close()},onSpacingCurvedHookCallback:function(){this.element.hasClass("edit")?this.close():this.open()},onAfterCloseChangersHookCallback:function(e){"spacing"!=e&&this.close()},open:function(){this.element.addClass("edit"),this.setPosition(),this.setDefault()},close:function(){var e=this._O("hide")
this.element.removeClass("edit").css({top:e.top,left:e.left})},setPosition:function(){var t=canvas.getActiveObject()||canvas.getActiveGroup(),a=e(".droppable > .canvas-container").offset(),n=t.translateToOriginPoint(t.getCenterPoint(),"center","top"),o=fabric.util.transformPoint(n,canvas.viewportTransform,!1),i=(e(window).width(),this.element),r=(i.width(),e(window).width(),/matrix\((-?\d*\.?\d+),\s*0,\s*0,\s*(-?\d*\.?\d+),\s*0,\s*0\)/),s=e(".droppable"),c=s.css("-webkit-transform")||s.css("-moz-transform")||s.css("-ms-transform")||s.css("-o-transform")||s.css("transform")||!1,l=c?c.match(r):[]
l.length&&parseFloat(l[1])<1&&(o.y*=parseFloat(l[1]),o.x*=parseFloat(l[1])),i.hasClass("edit")&&(i.css("top",o.y+a.top-i.height()/2),i.css("left",o.x+a.left-i.width()/2))},setDefault:function(){var e=(this.element,canvas.getActiveObject()||canvas.getActiveGroup())
if(this.checkSlider()){var t=e.spacing
this.slider.slider("value",t)}}})}(window.jQuery),!function(e){e.widget("printq.persLineHeightToolbar",e.printq.persBaseWidget,{version:"1.0.0",defaultElement:null,slider:[],options:{slider:"#lineHeightSlider",hide:{top:"-1500px",left:"-1500px"}},_create:function(){this.connectHooks()},checkSlider:function(){return this.slider.length?"undefined"!=typeof this.slider.data("uiSlider")||"undefined"!=typeof this.slider.data("ui-slider")||(this.createSlider(),!0):(this.createSlider(),!0)},createSlider:function(){var t=this.getElement("slider",!0),a=0
return t.slider({min:1,max:10,step:.1,start:function(e){return function(e,t){a=t.value}}(this),slide:function(t){return function(t,a){e(this).data("ui-slider")
canvas.getActiveObject()&&canvas.getActiveObject().setLineHeight(a.value),canvas.renderAll()}}(this),stop:function(e){return function(t,n){if(canvas.getActiveObject()){var o=[{objectID:canvas.getActiveObject().objectID,oldStage:{lineHeight:a},newStage:{lineHeight:n.value}}]
e.runHooks("pushUndoData",o)}e.runHooks("updateIframe")}}(this)}),!0},connectHooks:function(){this.addGlobalHook("doTextToolbarLineHeight",this.onLineHeightHookCallback,this),this.addGlobalHook("afterCloseChangers",this.onAfterCloseChangersHookCallback,this),this.addGlobalHook("afterCloseToolbar",this.onAfterCloseToolbarHookCallback,this)},onAfterCloseToolbarHookCallback:function(){this.close()},onLineHeightHookCallback:function(){this.element.hasClass("edit")?this.close():this.open()},onAfterCloseChangersHookCallback:function(e){"lineHeight"!=e&&this.close()},open:function(){this.element.addClass("edit"),this.setPosition(),this.setDefault()},close:function(){var e=this._O("hide")
this.element.removeClass("edit").css({top:e.top,left:e.left})},setPosition:function(){var t=canvas.getActiveObject()||canvas.getActiveGroup(),a=e(".droppable > .canvas-container").offset(),n=t.translateToOriginPoint(t.getCenterPoint(),"center","top"),o=fabric.util.transformPoint(n,canvas.viewportTransform,!1),i=(e(window).width(),this.element),r=(i.width(),e(window).width(),/matrix\((-?\d*\.?\d+),\s*0,\s*0,\s*(-?\d*\.?\d+),\s*0,\s*0\)/),s=e(".droppable"),c=s.css("-webkit-transform")||s.css("-moz-transform")||s.css("-ms-transform")||s.css("-o-transform")||s.css("transform")||!1,l=c?c.match(r):[]
l.length&&parseFloat(l[1])<1&&(o.y*=parseFloat(l[1]),o.x*=parseFloat(l[1])),i.hasClass("edit")&&(i.css("top",o.y+a.top-i.height()/2),i.css("left",o.x+a.left-i.width()/2))},setDefault:function(){var e=(this.element,canvas.getActiveObject()||canvas.getActiveGroup())
if(this.checkSlider()){var t=e.getLineHeight()
this.slider.slider("value",t)}}})}(window.jQuery),!function(e){e.widget("printq.persLetterSpacingToolbar",e.printq.persBaseWidget,{version:"1.0.0",defaultElement:null,slider:[],options:{slider:"#letterSpacingSlider",hide:{top:"-1500px",left:"-1500px"}},_create:function(){this.connectHooks()},checkSlider:function(){return this.slider.length?"undefined"!=typeof this.slider.data("uiSlider")||"undefined"!=typeof this.slider.data("ui-slider")||(this.createSlider(),!0):(this.createSlider(),!0)},createSlider:function(){var t=this.getElement("slider",!0),a=0
return t.slider({min:0,max:80,step:1,start:function(e){return function(e,t){a=t.value}}(this),slide:function(t){return function(t,a){e(this).data("ui-slider")
canvas.getActiveObject()&&(canvas.getActiveObject().clearCharWidthsCache(),canvas.getActiveObject().setLetterSpace(a.value)),canvas.renderAll()}}(this),stop:function(e){return function(t,n){if(canvas.getActiveObject()){var o=[{objectID:canvas.getActiveObject().objectID,oldStage:{letterSpace:a},newStage:{letterSpace:n.value}}]
e.runHooks("pushUndoData",o)}e.runHooks("updateIframe")}}(this)}),!0},connectHooks:function(){this.addGlobalHook("doTextToolbarLetterSpace",this.onLineHeightHookCallback,this),this.addGlobalHook("afterCloseChangers",this.onAfterCloseChangersHookCallback,this),this.addGlobalHook("afterCloseToolbar",this.onAfterCloseToolbarHookCallback,this)},onAfterCloseToolbarHookCallback:function(){this.close()},onLineHeightHookCallback:function(){this.element.hasClass("edit")?this.close():this.open()},onAfterCloseChangersHookCallback:function(e){"letterspacing"!=e&&this.close()},open:function(){this.element.addClass("edit"),this.setPosition(),this.setDefault()},close:function(){var e=this._O("hide")
this.element.removeClass("edit").css({top:e.top,left:e.left})},setPosition:function(){var t=canvas.getActiveObject()||canvas.getActiveGroup(),a=e(".droppable > .canvas-container").offset(),n=t.translateToOriginPoint(t.getCenterPoint(),"center","top"),o=fabric.util.transformPoint(n,canvas.viewportTransform,!1),i=(e(window).width(),this.element),r=(i.width(),e(window).width(),/matrix\((-?\d*\.?\d+),\s*0,\s*0,\s*(-?\d*\.?\d+),\s*0,\s*0\)/),s=e(".droppable"),c=s.css("-webkit-transform")||s.css("-moz-transform")||s.css("-ms-transform")||s.css("-o-transform")||s.css("transform")||!1,l=c?c.match(r):[]
l.length&&parseFloat(l[1])<1&&(o.y*=parseFloat(l[1]),o.x*=parseFloat(l[1])),i.hasClass("edit")&&(i.css("top",o.y+a.top-i.height()/2),i.css("left",o.x+a.left-i.width()/2))},setDefault:function(){var e=(this.element,canvas.getActiveObject()||canvas.getActiveGroup())
if(this.checkSlider()){var t=e.getLetterSpace()
this.slider.slider("value",t)}}})}(window.jQuery),!function(e){e.widget("printq.printqRadiusPicker",e.printq.persBaseWidget,{version:"1.0.0",defaultElement:null,slider:[],options:{slider:"#editor_spacing_slider",hide:{top:"-1500px",left:"-1500px"}},_create:function(){this.connectHooks()},checkSlider:function(){return this.slider.length?"undefined"!=typeof this.slider.data("uiSlider")||"undefined"!=typeof this.slider.data("ui-slider")||(this.createSlider(),!0):(this.createSlider(),!0)},createSlider:function(){var t=this.getElement("slider",!0),a=0
return t.slider({min:10,max:200,start:function(e){return function(e,t){a=t.value}}(this),slide:function(t){return function(t,a){e(this).data("ui-slider")
canvas.getActiveObject()&&(canvas.getActiveObject().radius=a.value),canvas.renderAll()}}(this),stop:function(e){return function(t,n){if(canvas.getActiveObject()&&canvas.getActiveObject().curvedText){var o=[{objectID:canvas.getActiveObject().objectID,oldStage:{radius:a},newStage:{radius:n.value}}]
e.runHooks("pushUndoData",o)}e.runHooks("updateIframe")}}(this)}),!0},connectHooks:function(){this.addGlobalHook("doTextToolbarRadiusCurved",this.onRadiusCurvedHookCallback,this),this.addGlobalHook("afterCloseChangers",this.onAfterCloseChangersHookCallback,this),this.addGlobalHook("afterCloseToolbar",this.onAfterCloseToolbarHookCallback,this)},onAfterCloseToolbarHookCallback:function(){this.close()},onRadiusCurvedHookCallback:function(){this.element.hasClass("edit")?this.close():this.open()},onAfterCloseChangersHookCallback:function(e){"radius"!=e&&this.close()},open:function(){this.element.addClass("edit"),this.setPosition(),this.setDefault()},close:function(){var e=this._O("hide")
this.element.removeClass("edit").css({top:e.top,left:e.left})},setPosition:function(){var t=canvas.getActiveObject()||canvas.getActiveGroup(),a=e(".droppable > .canvas-container").offset(),n=t.translateToOriginPoint(t.getCenterPoint(),"center","top"),o=fabric.util.transformPoint(n,canvas.viewportTransform,!1),i=(e(window).width(),this.element),r=(i.width(),e(window).width(),/matrix\((-?\d*\.?\d+),\s*0,\s*0,\s*(-?\d*\.?\d+),\s*0,\s*0\)/),s=e(".droppable"),c=s.css("-webkit-transform")||s.css("-moz-transform")||s.css("-ms-transform")||s.css("-o-transform")||s.css("transform")||!1,l=c?c.match(r):[]
l.length&&parseFloat(l[1])<1&&(o.y*=parseFloat(l[1]),o.x*=parseFloat(l[1])),i.hasClass("edit")&&(i.css("top",o.y+a.top-i.height()/2),i.css("left",o.x+a.left-i.width()/2))},setDefault:function(){var e=(this.element,canvas.getActiveObject()||canvas.getActiveGroup())
if(this.checkSlider()){var t=e.radius
this.slider.slider("value",t)}}})}(window.jQuery),!function(e){e.widget("printq.persColorToolbar",e.printq.persBaseWidget,{version:"1.0.0",defaultElement:null,colorPathIds:null,slider:[],status:"close",colorList:[],forecolor_tab:[],background_tab:[],stroke_tab:[],currentGroup:"",addColor:[],template:'<li class="clickAction colorItem color"><b class="icon printqicon-ok"></b></li>',options:{forecolor_tab:".tabsContainer .forecolor_tab",background_tab:".tabsContainer .background_tab",stroke_tab:".tabsContainer .stroke_tab",colorList:".mainTabsColorContainer .colorList",addColor:"li.colorItem.add_color",hide:{top:"-1500px",left:"-1500px"}},_create:function(){var e=this.getElement("colorList")
e.mCustomScrollbar({scrollButtons:{enable:!1},theme:"dark-thin",axis:"y",scrollInertia:0,advanced:{updateOnContentResize:!0}}),this.connectHooks(),this.bindToolbarAction()},connectHooks:function(){this.addGlobalHook("doTextToolbarColor",this.onColorHookCallback,this),this.addGlobalHook("doDefaultToolbarColor",this.onColorHookCallback,this),this.addGlobalHook("afterCloseToolbar",this.onAfterCloseToolbarHookCallback,this),this.addGlobalHook("afterCloseChangers",this.onAfterCloseChangersHookCallback,this),this.addGlobalHook("changeColorPathFromToolbar",this.changeColorPathFromToolbarHookCallback,this)},onAfterCloseToolbarHookCallback:function(){this.close()},onAfterCloseChangersHookCallback:function(){this.close()},onColorHookCallback:function(){this.element.hasClass("edit")?this.close():this.open()},changeColorPathFromToolbarHookCallback:function(e){e.length&&(this.colorPathIds=e,this.open())},open:function(){if("open"!==this.status){var e=canvas.getActiveObject(),t=this.getElement("forecolor_tab",!0),a=this.getElement("background_tab",!0),n=this.getElement("stroke_tab",!0)
this.status="open",this.element.addClass("edit"),this.setPosition(),this.setDefault(),this.currentGroup="forecolor",["text","i-text","textbox"].indexOf(e.type)>-1?(this.currentGroup="forecolor",t.show(),a.show(),n.show()):(["circle","rect"].indexOf(e.type)>-1?n.show():n.hide(),t.hide(),a.show(),this.currentGroup="bgcolor"),this.updateTabs()}},updateTabs:function(){var e=this.element,t=this.currentGroup
e.find("div").removeClass("current"),e.find(".group."+t+"_group").addClass("current"),e.find("ul li.color").data("action",t),this.setDefault()},close:function(){if("close"!==this.status){this.status="close"
var e=this._O("hide")
this.element.removeClass("edit").css({top:e.top,left:e.left}),this.destroyOthers(),this.colorPathIds=null,this.runHooks("afterCloseColorToolbar")}},setPosition:function(){var t=canvas.getActiveObject()||canvas.getActiveGroup(),a=e(".droppable > .canvas-container").offset(),n=t.translateToOriginPoint(t.getCenterPoint(),"center","top"),o=fabric.util.transformPoint(n,canvas.viewportTransform,!1),i=(e(window).width(),this.element),r=(i.width(),e(window).width(),/matrix\((-?\d*\.?\d+),\s*0,\s*0,\s*(-?\d*\.?\d+),\s*0,\s*0\)/),s=e(".droppable"),c=s.css("-webkit-transform")||s.css("-moz-transform")||s.css("-ms-transform")||s.css("-o-transform")||s.css("transform")||!1,l=c?c.match(r):[]
l.length&&parseFloat(l[1])<1&&(o.y*=parseFloat(l[1]),o.x*=parseFloat(l[1])),i.hasClass("edit")&&(i.css("top",o.y+a.top-i.height()/2),i.css("left",o.x+a.left-i.width()/2))},bindToolbarAction:function(){this._on(this.element.find(".clickAction"),{mouseup:function(t){var a,n=this.element,o=canvas.getActiveObject()||canvas.getActiveGroup,i=e(t.currentTarget),r=o?i.data("action"):"default"
switch(r){case"tab_forecolor":this.currentGroup="forecolor",this.updateTabs(),this.destroyOthers()
break
case"tab_bgcolor":this.currentGroup="bgcolor",this.updateTabs(),this.destroyOthers()
break
case"tab_strokecolor":this.currentGroup="strokecolor",this.updateTabs(),this.destroyOthers()
break
case"forecolor":var s,c=i.data("colorid")
s="transparent"===defaultEditorColors[c].htmlRGB?"transparent":"rgb("+defaultEditorColors[c].htmlRGB+")",a=[{objectID:o.objectID,oldStage:{fill:o.fill,fillColorId:o.fillColorId},newStage:{fill:s,fillColorId:c}}],o.setFill(s),o.fillColorId=c,n.find(".ul li").removeClass("active"),this.runHooks("changePreviewColorPlaceholder",s,c),i.addClass("active"),this.runHooks("pushUndoData",a),canvas.renderAll(),this.runHooks("updateIframe"),this.close()
break
case"bgcolor":var c=i.data("colorid")
s="transparent"===defaultEditorColors[c].htmlRGB?"transparent":"rgb("+defaultEditorColors[c].htmlRGB+")"
var l=o.type
this.colorPathIds?this.changePathsColor(s):(["text","i-text","textbox"].indexOf(l)>-1?(a=[{objectID:o.objectID,oldStage:{backgroundColor:o.backgroundColor,backgroundColorId:o.backgroundColorId},newStage:{backgroundColor:s,backgroundColorId:c}}],o.setBackgroundColor(s)):(a=[{objectID:o.objectID,oldStage:{fill:o.fill,fillColorId:o.fillColorId},newStage:{fill:s,fillColorId:c}}],o.setFill(s)),o.backgroundColorId=c,this.runHooks("pushUndoData",a)),n.find(".ul li").removeClass("active"),i.addClass("active"),canvas.renderAll(),this.runHooks("updateIframe"),this.close()
break
case"strokecolor":var c=i.data("colorid")
s="transparent"===defaultEditorColors[c].htmlRGB?"transparent":"rgb("+defaultEditorColors[c].htmlRGB+")",a=[{objectID:o.objectID,oldStage:{stroke:o.stroke,strokeColorId:o.strokeColorId},newStage:{stroke:s,strokeColorId:c}}],o.setStroke(s),o.strokeColorId=c,n.find(".ul li").removeClass("active"),i.addClass("active"),this.runHooks("pushUndoData",a),canvas.renderAll(),this.runHooks("updateIframe"),this.close()
break
case"add-color":this.openColorPicker()}t.stopPropagation()}})},changePathsColor:function(e){var t=canvas.getActiveObject()||canvas.getActiveGroup()
t.paths&&t.paths.forEach(function(t){return function(a,n){t.colorPathIds.indexOf(n)>-1&&a.set("fill",e)}}(this))},setBlockColor:function(t,a){var n,o=canvas.getActiveObject()||canvas.getActiveGroup(),i={},r={}
if(o&&"group"!==o.type){if(this.colorPathIds&&"undefined"!=typeof t.fill)return this.changePathsColor(t.fill),void canvas.renderAll()
e.each(t,function(e,t){i[e]=o[t],o.set(e,t),r[t]=o[e]}),n=[{objectID:o.objectID,oldStage:i,newStage:r}],a&&(this.runHooks("pushUndoData",n),this.runHooks("updateIframe")),canvas.renderAll()}},setColor:function(e){var t,a,n,o=e.data("colorid"),i=canvas.getActiveObject()||canvas.getActiveGroup(),r=this.getElement("colorList",!0)
if(n="transparent"===defaultEditorColors[o].htmlRGB?"transparent":"rgb("+defaultEditorColors[o].htmlRGB+")",this.colorPathIds)return this.changePathsColor(n),void canvas.renderAll()
"strokecolor"==this.currentGroup?(t="stroke",a="strokeColorId"):"bgcolor"==this.currentGroup&&["rect","circle"].indexOf(i.type)<0?(t="backgroundColor",a="backgroundColorId"):(t="fill",a="fillColorId")
var s=[{objectID:i.objectID,oldStage:{fill:i.fill,fillColorId:i.fillColorId},newStage:{fill:n,fillColorId:o}}]
i.set(t,n),i.set(a,o),r.find("li").removeClass("current_color"),e.addClass("current_color"),this.runHooks("pushUndoData",s),canvas.renderAll(),this.runHooks("updateIframe"),this.close()},destroyOthers:function(){var t=this.getElement("colorList",!0),a=t.find("li").filter(function(){return"undefined"!=typeof e(this).data("chromoselector")})
a.on("click",function(t){return function(){t.setColor(e(this))}}(this)),a.chromoselector("destroy")},openColorPicker:function(){var t=this.getElement("addColor",!0),a=e(this.template)
a.insertBefore(t),this.destroyOthers(),a.chromoselector({preview:!0,speed:0,resizable:!1,width:150,autoshow:!0,create:function(){var t=e(this).chromoselector("getColor"),a=Math.floor(1e3*Math.random()+1)
e(this).chromoselector("show"),e(this).css({"background-color":t.getHexString()}).data({colorid:a}),defaultEditorColors[a]={htmlRGB:t.getRgbString().replace("rgb(","").replace(")","")}},update:function(t){return function(){var a=e(this).chromoselector("getColor"),n=canvas.getActiveObject()||canvas.getActiveGroup(),o=a.getRgbString(),i=e(this).data("colorid")
switch(e(this).css({"background-color":o}),defaultEditorColors[i]={htmlRGB:a.getRgbString().replace("rgb(","").replace(")","")},t.currentGroup){case"strokecolor":t.setBlockColor({stroke:o,strokeColorId:i},!0)
break
case"bgcolor":["circle","rect"].indexOf(n.type)>-1?t.setBlockColor({fill:o,fillColorId:i},!0):t.setBlockColor({backgroundColor:o,backgroundColorId:i},!0)
break
default:t.setBlockColor({fill:o,fillColorId:i},!0),t.runHooks("changePreviewColorPlaceholder",o,i)}}}(this)})},setDefault:function(){var t=this.element,a=canvas.getActiveObject()||canvas.getActiveGroup(),n=this.currentGroup,o=this.getElement("colorList",!0)
switch(n){case"forecolor":t.find("ul li").removeClass("current_color")
var i=o.find("li").filter(function(){return e(this).data("colorid")===a.fillColorId})
i.addClass("current_color")
break
case"bgcolor":t.find("ul li").removeClass("current_color")
var i=o.find("li").filter(function(){return e(this).data("colorid")===a.backgroundColorId})
i.addClass("current_color")
break
case"strokecolor":t.find("ul li").removeClass("current_color")
var i=o.find("li").filter(function(){return e(this).data("colorid")===a.strokeColorId})
i.addClass("current_color")}},toggleToolbarGroup:function(e,t,a){var n=this.element,a=a||"block"
return 1==parseInt(t)?n.find(".group"+e).css("display",a):n.find(".group"+e).hide(),this}})}(window.jQuery),!function(e){e.widget("printq.persDefaultToolbar",e.printq.persBaseToolbar,{version:"1.0.0",status:"close",groupBtn:[],unGroupBtn:[],blockElement:[],helperElement:[],forecolorElement:[],pathColors_group:[],options:{hide:{top:"-1500px",left:"-1500px"},blockElement:".printqDefaultToolbar .block_group",helperElement:".printqDefaultToolbar .helper_group",forecolorElement:".forecolor_group",mask:"#loading-mask",groupBtn:".group_group",unGroupBtn:".ungroup_group",pathColors_group:".path_colors_group"},_create:function(){this._super(),this.bindEventsDefaultToolbar(),canvas.on("mouse:up",function(e){return function(t){if(!(1!=t.e.which&&"touchend"!=t.e.type&&window.innerWidth<900)){var a=canvas.getActiveObject()||canvas.getActiveGroup()
"undefined"!=typeof t.target&&a&&(t.target=a),e.startToolbar(t.target)}}}(this)),canvas.on("selection:cleared",function(e){return function(t){e.stopToolbar()}}(this)),canvas.on("object:scaling",function(e){return function(t){t.target&&["text","i-text","textbox","image"].indexOf(t.target.type)<0&&e.stopToolbar()}}(this)),canvas.on("object:moving",function(e){return function(t){t.target&&["text","i-text","textbox","image"].indexOf(t.target.type)<0&&e.stopToolbar()}}(this)),this.bindToolbarActions()},setDimensions:function(){var t=5,a=this.element.find(".toolbarSection > .group:visible"),n=0
e.each(a,function(){return function(){var t=e(this)
n+=t.outerWidth()}}()),this.element.css("width",n+t)},bindEventsDefaultToolbar:function(){e(window).on("click.Default",function(t){return function(a){var n=a.target,o=e("#printqTransparencyPicker").data("printq-persTransparencyToolbar"),i=e(".mainTabsColorContainer").data("printq-persColorToolbar")
e(".canvas-container").find(n).length||t.element.find(n).length||o.element.find(n).length||i.element.find(n).length||e(".ui-cs-chromoselector").find(n).length||t.stopToolbar()}}(this))},unbindEventsDefaultToolbar:function(){e(window).off("click.Default")},_destroy:function(){this._super()},startToolbar:function(e){window.innerWidth>900&&"undefined"!=typeof e&&e&&"image"!=e.type&&"text"!=e.type&&"i-text"!=e.type&&"textbox"!=e.type&&this.open()},stopToolbar:function(e){window.innerWidth>900&&this.close()},connectHooks:function(){this.addGlobalHook("closeOthers",this.onCloseOthersHookCallback,this),this.addGlobalHook("bindEventsDefaultToolbar",this.bindEventsDefaultToolbar,this),this.addGlobalHook("unbindEventsDefaultToolbar",this.unbindEventsDefaultToolbar,this),this.addGlobalHook("afterCloseColorToolbar",this.afterCloseColorToolbarHookCallback,this),this.addGlobalHook("stopDefaultToolbar",this.stopToolbar,this)},open:function(){this.runHooks("closeOthers"),this.status="open"
var e=canvas.getActiveObject()||canvas.getActiveGroup()
if(e){var t=this.element,a=this.getElement("groupBtn",!0),n=this.getElement("unGroupBtn",!0),o=this.getElement("forecolorElement",!0),i=this.getElement("pathColors_group",!0)
if(n.removeClass("show"),a.removeClass("show"),"group"===e.type&&canvas.getActiveObject()?(n.addClass("show"),a.removeClass("show")):"group"===e.type&&canvas.getActiveGroup()&&(n.removeClass("show"),a.addClass("show")),"path-group"===e.type)if("function"==typeof e.isSameColor&&e.isSameColor()){var r=e.getObjects()[0],s=r.getFill()
o.find(".current_color").css("background-color",s),o.show(),i.hide()}else i.show(),o.hide()
else i.hide(),["circle","rect"].indexOf(e.type.toLowerCase())>-1?(s=e.getFill(),o.find(".current_color").css("background-color",s),o.show()):o.hide()
t.addClass("edit"),this.setDefaults(),this.setDimensions(),this.setPosition()}},close:function(){if("close"!==this.status){this.status="close"
var e=this.element,t=this._O("hide")
this.closeAllChangers(),e.removeClass("edit").css({top:t.top,left:t.left}).off("dblclick"),this.runHooks("afterCloseToolbar")}},onCloseOthersHookCallback:function(){"open"==this.status&&this.close()},setDefaults:function(){var e=this.element,t=canvas.getActiveObject()||canvas.getActiveGroup()
if(t){var a=e.find(".helper_group div.helper")
a.removeClass("current"),t.setHelper&&a.addClass("current")
var n=e.find(".locked_group div.locker")
n.removeClass("current"),1==t.lockRotation&&1==t.lockUniScaling&&1==t.lockMovementX&&1==t.lockMovementY&&1==t.lockScalingX&&1==t.lockScalingY&&n.addClass("current")}},afterCloseColorToolbarHookCallback:function(){var e=canvas.getActiveObject()||canvas.getActiveGroup()
if(e){var t=this.element,a=e.fillColorId?defaultEditorColors[e.fillColorId].htmlRGB:e.fill
t.find(".current_color").css({"background-color":"rgb("+a+")"})}},closeAllChangers:function(e){this.element.find(".changer").removeClass("open").parent().removeClass("open"),this.runHooks("afterCloseChangers",e)},openChanger:function(e){e.toggleClass("open").parent().toggleClass("open")},bindToolbarActions:function(){this._on(this.element.find(".changer"),{mouseup:function(t){var a=(this.element,e(t.currentTarget)),n=a.data("action")
this.closeAllChangers(n||"default"),this.openChanger(a),t.stopPropagation()}}),this._on(this.element.find(".clickAction"),{mouseup:function(t){if(1==t.which){var a=(this.element,canvas.getActiveObject()||canvas.getActiveGroup()),n=e(t.currentTarget),o=a?n.data("action"):"default"
switch(this.closeAllChangers(o),o){case"position":var i=n.data("position")
this.runHooks("positionChange",i)
break
case"transparency":this.runHooks("doOtherToolbarTransparency")
break
case"delete":customConfirm(translateStrings.areYouSure,function(e){return function(){e.runHooks("deleteObject"),e.runHooks("updateIframe")}}(this),function(){})
break
case"clone":this.runHooks("cloneObject")
break
case"group":this.runHooks("groupObjects")
break
case"ungroup":this.runHooks("unGroupObjects")
break
case"locked":var r=(n.data("type"),n.hasClass("current")?0:1),s={objectID:a.objectID,oldStage:{lockRotation:a.lockRotation,lockUniScaling:a.lockUniScaling,lockMovementX:a.lockMovementX,lockMovementY:a.lockMovementY,lockScalingX:a.lockScalingX,lockScalingY:a.lockScalingY}}
n.hasClass("current")?(a.set({lockRotation:!1,lockUniScaling:!1,lockMovementX:!1,lockMovementY:!1,lockScalingX:!1,lockScalingY:!1}),s.newStage={lockRotation:!1,lockUniScaling:!1,lockMovementX:!1,lockMovementY:!1,lockScalingX:!1,lockScalingY:!1}):(a.set({lockRotation:!0,lockUniScaling:!0,lockMovementX:!0,lockMovementY:!0,lockScalingX:!0,lockScalingY:!0}),s.newStage={lockRotation:!0,lockUniScaling:!0,lockMovementX:!0,lockMovementY:!0,lockScalingX:!0,lockScalingY:!0}),this.runHooks("pushUndoData",[s]),n.toggleClass("current"),canvas.renderAll()
break
case"helper":var r=(n.data("type"),n.hasClass("current")?0:1),s={objectID:a.objectID,oldStage:{setHelper:"undefined"==typeof a.setHelper?null:a.setHelper}}
r?(a.setHelperDesign(!0),canvas.bringToFront(a),canvas.helpersInCanvas++,s.newStage={setHelper:!0}):(a.setHelperDesign(!1),canvas.helpersInCanvas--,s.newStage={setHelper:!1}),this.runHooks("pushUndoData",[s]),canvas.renderAll(),n.toggleClass("current"),this.runHooks("updateIframe")
break
case"color":this.runHooks("doDefaultToolbarColor")
break
case"color-paths":this.runHooks("colorPaths")}t.stopPropagation()}}})}})}(window.jQuery),!function(e){e.widget("printq.persTextToolbar",e.printq.persDefaultToolbar,{version:"1.0.0",status:"close",fontsContainer:[],fontsizeInput:[],moreOptionsText_group:[],blockElement:[],helperElement:[],curvedTextEdit:[],curvedTextOption:[],normalTextOption:[],lineHeightElement:[],stroke_option_group:[],blurSelectorsCurvedText:".containerCurved, .droppable",active:"active",inactive:"inactive",options:{fontsContainer:".fontsContainer ul",blockElement:".moreOptionsText_group #BlockChoeser",helperElement:".moreOptionsText_group #HelperChoeser",lineHeightElement:".moreText_group #lineHeightElement",fontsizeInput:"#fontsizeInput",fontSizeUnit:1,moreOptionsText_group:".moreOptionsText_group",stroke_option_group:".stroke_option_group",curvedTextEdit:".curvedTextEditMode",curvedTextOption:".curvedTextOption",normalTextOption:".normalTextOption",hide:{top:"-1500px",left:"-1500px"},mask:"#loading-mask"},_create:function(){canvas.on("mouse:up",function(e){return function(t){if(!(1!=t.e.which&&"touchend"!=t.e.type&&window.innerWidth<900)){var a=canvas.getActiveObject()||canvas.getActiveGroup()
"undefined"!=typeof t.target&&a&&(t.target=a)
var n=e.getElement("curvedTextOption",!0),o=e.getElement("normalTextOption",!0)
n.length&&t.target&&"undefined"!=typeof t.target.curvedText&&t.target.curvedText?(n.addClass(e.active),o.addClass(e.inactive)):(n.removeClass(e.active),o.removeClass(e.inactive)),e.startToolbar(t.target)}}}(this)),canvas.on("selection:cleared",function(e){return function(t){e.stopToolbar()}}(this)),canvas.on("object:scaling",function(e){return function(t){t.target&&["text","i-text","textbox"].indexOf(t.target.type)>-1&&e.stopToolbar()}}(this)),canvas.on("object:moving",function(e){return function(t){t.target&&["text","i-text","textbox"].indexOf(t.target.type)>-1&&e.stopToolbar()}}(this)),canvas.on("text:editing:entered",function(e){return function(t){var a=t.target
if("undefined"!=typeof a.curvedText&&a.curvedText){var n=e.getElement("curvedTextEdit")
n.find("textarea").val(a.text),n.addClass("show")}}}(this)),this.blurCurvedText(),this.bindEventsCurvedText()
var e=this.getElement("fontsContainer",!0)
e.mCustomScrollbar({scrollButtons:{enable:!1},theme:"dark-thin",axis:"y",scrollInertia:0}),this.bindEventsTextToolbar(),this.connectHooks(),this.bindToolbarActions()},closeCurvedTextEdit:function(){var e=this.getElement("curvedTextEdit")
e.removeClass("show")},bindEventsCurvedText:function(){var t=this.getElement("curvedTextEdit")
this._on(t.find(".clickActionCurvedText"),{mouseup:function(a){if(1==a.which){var n=(this.element,canvas.getActiveObject()),o=e(a.currentTarget),i=n?o.data("action"):"default"
switch(i){case"cancel_edit_text":this.closeCurvedTextEdit()
break
case"ok_edit_text":n&&n.curvedText&&(this.runHooks("pushUndoData",[{objectID:n.objectID,oldStage:{text:n.text},newStage:{text:t.find("textarea").val()}}]),n.text=t.find("textarea").val(),canvas.renderAll(),this.runHooks("updateIframe")),this.closeCurvedTextEdit()}a.stopPropagation()}}})},bindEventsTextToolbar:function(){e(window).on("click.Text",function(t){return function(a){var n=a.target,o=e("#printqTransparencyPicker").data("printq-persTransparencyToolbar"),i=e(".mainTabsColorContainer").data("printq-persColorToolbar"),r=e("#printqSpacingPicker").data("printq-persSpacingToolbar"),s=e("#printqRadiusPicker").data("printq-printqRadiusPicker"),c=e("#printqLineHeightPicker").data("printq-persLineHeightToolbar"),l=e("#printqLetterSpacingPicker").data("printq-persLetterSpacingToolbar")
e(".canvas-container").find(n).length||t.element.find(n).length||o.element.find(n).length||r.element.find(n).length||s.element.find(n).length||c.element.find(n).length||l.element.find(n).length||e(".ui-cs-chromoselector").find(n).length||i.element.find(n).length||t.stopToolbar()}}(this))},unbindEventsTextToolbar:function(){e(window).off("click.Text")},connectHooks:function(){this.addGlobalHook("blurEditor",this.onBlurEditorHookCallback,this),this.addGlobalHook("closeOthers",this.onCloseOthersHookCallback,this),this.addGlobalHook("afterCloseColorToolbar",this.afterCloseColorToolbarHookCallback,this),this.addGlobalHook("bindEventsTextToolbar",this.bindEventsTextToolbar,this),this.addGlobalHook("unbindEventsTextToolbar",this.unbindEventsTextToolbar,this),this.addGlobalHook("stopTextToolbar",this.stopToolbar,this),this.addGlobalHook("changePreviewColorPlaceholder",this.changePreviewColorPlaceholder,this)},afterCloseColorToolbarHookCallback:function(){var e=canvas.getActiveObject()||canvas.getActiveGroup()
if(e){var t=this.element,a=e.fillColorId?defaultEditorColors[e.fillColorId].htmlRGB:e.fill
t.find(".current_color").css({"background-color":"rgb("+a+")"})}},onBlurEditorHookCallback:function(){var e=canvas.getActiveObject()||canvas.getActiveGroup()
e&&["text","i-text","textbox"].indexOf(e.type)&&this.close()},_destroy:function(){this._super()},startToolbar:function(e){if(window.innerWidth>900&&"undefined"!=typeof e&&(e&&"text"==e.type||"i-text"==e.type||"textbox"==e.type)){var t=this.getElement("lineHeightElement",!0)
e.curvedText?t.hide():t.show(),this.open()}},stopToolbar:function(e){if(window.innerWidth>900){var t=this.getElement("curvedTextOption",!0)
t.length&&t.removeClass(this.active)
var a=this.getElement("normalTextOption",!0)
a.length&&a.removeClass(this.inactive),this.close()}},setDimensions:function(){var t=5,a=this.element.find(".printqToolbarTop > .group:visible"),n=this.element.find(".printqToolbarBottom > .group:visible"),o=0
e.each(a,function(){return function(){var t=e(this)
o+=t.outerWidth()}}())
var i=0
e.each(n,function(){return function(){var t=e(this)
i+=t.outerWidth()}}()),this.element.css("width",i>o?i+t:o+t)},open:function(){this.runHooks("closeOthers"),this.status="open"
var e=this.element
e.addClass("edit"),this.setDefaults(),this.setDimensions(),this.setPosition(),this.updateColorPickers()},close:function(){if("close"!==this.status){this.status="close"
var e=this.element,t=this._O("hide")
this.closeAllChangers(),e.removeClass("edit").css({top:t.top,left:t.left}).off("dblclick"),this.runHooks("afterCloseToolbar",this)}},onCloseOthersHookCallback:function(){"open"==this.status&&this.close()},setDefaults:function(){var e=this.element,t=canvas.getActiveObject()||canvas.getActiveGroup()
if(t){var a=e.find(".helper_group div.helper")
a.removeClass("current"),t.setHelper&&a.addClass("current")
var n=e.find(".locked_group div.locker")
if(n.removeClass("current"),1==t.lockRotation&&1==t.lockUniScaling&&1==t.lockMovementX&&1==t.lockMovementY&&1==t.lockScalingX&&1==t.lockScalingY&&n.addClass("current"),""!=t.getFontFamily()){var o=e.find(".current_font")
o.text(t.getFontFamily().split("'").join("")).css("font-family",t.getFontFamily())}if(""!=t.getFill()){var i=e.find(".current_color")
i.css("background-color",t.getFill())}if(""!=t.getTextAlign()){var r=e.find(".alignment_group .changer div")
r.removeClass("current"),e.find(".alignment_group .changer div."+t.getTextAlign()+"_align").addClass("current")}var s=e.find(".decorations_group div.bold")
s.removeClass("current"),"bold"==t.getFontWeight()&&s.addClass("current")
var c=e.find(".decorations_group div.italic")
c.removeClass("current"),"italic"==t.getFontStyle()&&c.addClass("current")
var l=e.find(".decorations_group div.underline")
l.removeClass("current"),"underline"==t.getTextDecoration()&&l.addClass("current"),this.fontsizeInput.length||(this.fontsizeInput=this.element.find(this._O("fontsizeInput"))),this.fontsizeInput.val(parseFloat(t.getFontSize()).toFixed(2))}},closeAllChangers:function(e){if("more"!=e){var t=this.getElement("moreOptionsText_group",!0)
t.toggleClass("edit",!1)}this.element.find(".changer").removeClass("open").parent().removeClass("open"),this.runHooks("afterCloseChangers",e)},openChanger:function(e){e.toggleClass("open").parent().toggleClass("open")},updateColorPickers:function(){var t=this.element,a=t.find(".colorList"),n=1
t.find(".changer:visible").each(function(){var t=e(this)
"none"!=t.parent().css("display")&&"none"!=t.css("display")&&(n+=t.hasClass("standard")||t.hasClass("pt")?t.outerWidth():t.innerWidth())}),a.each(function(t,a){return function(){var n=e(this),o=0
t.find("div.toolbarSettings > div.group:visible").each(function(t){return function(){var a=e(this),n=a.find(t)
return!n.length&&void a.find(".changer:visible").each(function(){var t=e(this)
o+=t.hasClass("standard")||t.hasClass("pt")?t.outerWidth():t.innerWidth()})}}(n)),n.css({width:a+3,left:-1*o-4})}}(t,n))},bindToolbarActions:function(){this._on(this.element.find(".changer"),{mouseup:function(t){var a=(this.element,e(t.currentTarget)),n=a.data("action")
this.closeAllChangers(n||"default"),this.openChanger(a),t.stopPropagation()}}),this._on(this.element.find(".clickAction"),{mouseup:function(t){if(1==t.which){var a=this.element,n=canvas.getActiveObject()||canvas.getActiveGroup(),o=e(t.currentTarget),i=n?o.data("action"):"default"
switch(this.closeAllChangers(i),i){case"position":var r=o.data("position")
this.runHooks("positionChange",r)
break
case"fontname":var s=o.data("fontname")
a.find(".current_font",a).text(s),a.find(".current_font",a).css("font-family",s)
var c=[{objectID:n.objectID,oldStage:{fontFamily:n.fontFamily},newStage:{fontFamily:s}}]
this.runHooks("pushUndoData",c),n.set("fontFamily","'"+s+"'"),canvas.renderAll(),this.runHooks("updateIframe")
break
case"fontsize":var l=o.data("type"),d=this._O("fontSizeUnit"),u="decrease"==l?-1*d:d,g=parseFloat(n.getFontSize())+u
this.element.find(this._O("fontsizeInput")).val(g.toFixed(2))
var c=[{objectID:canvas.getActiveObject().objectID,oldStage:{fontSize:canvas.getActiveObject().fontSize,textScales:canvas.getActiveObject().textScales},newStage:{fontSize:g,textScales:[1,1]}}]
this.runHooks("pushUndoData",c),n.set("fontSize",parseInt(g)),n.set("textScales",[1,1]),canvas.renderAll(),this.runHooks("updateIframe")
break
case"forecolor":var f,h=o.data("colorid"),c=[]
if(f="transparent"===defaultEditorColors[h].htmlRGB?"transparent":"rgb("+defaultEditorColors[h].htmlRGB+")",a.find(".forecolor_selector").data("colorid",h).find(".current_color").css("background-color",f),"group"==n.type)n.getObjects().forEach(function(e,t){c.push({objectId:e.objectID,oldStage:{stroke:e.stroke,fill:e.fill},newStage:{stroke:f,fill:f}})}),pushUndoData(c),n.getObjects().forEach(function(e,t){e.fill=f})
else{var c=[{objectId:n.objectID,oldStage:{stroke:n.stroke,fill:n.fill},newStage:{stroke:f,fill:f}}]
pushUndoData(c),n.setFill(f)}canvas.renderAll()
break
case"decoration":var l=o.data("type"),p=o.hasClass("current")?0:1
switch(o.toggleClass("current"),l){case"boldText":var v={objectID:n.objectID,oldStage:{fontWeight:n.getFontWeight()}}
p?(n.setFontWeight("bold"),v.newStage={fontWeight:"bold"}):(n.setFontWeight(""),v.newStage={fontWeight:""})
break
case"italicText":var v={objectID:n.objectID,oldStage:{fontStyle:n.getFontStyle()}}
p?(n.setFontStyle("italic"),v.newStage={fontStyle:"italic"}):(n.setFontStyle("normal"),v.newStage={fontStyle:"normal"})
break
case"underlineText":var v={objectID:n.objectID,oldStage:{textDecoration:n.getTextDecoration()}}
p?(n.setTextDecoration("underline"),v.newStage={textDecoration:"underline"}):(n.setTextDecoration("none"),v.newStage={textDecoration:"none"})}this.runHooks("pushUndoData",[v]),canvas.renderAll(),this.runHooks("updateIframe")
break
case"alignment":var m=(o.data("alignclass"),o.data("align")),b=[]
a.find(".alignment_group .changer div").removeClass("current"),o.addClass("current"),"group"==n.type?(n.getObjects().forEach(function(e,t){["text","i-text","textbox"].indexOf(e.type)>=0&&(b.push({objectID:e.objectID,oldStage:{textAlign:e.getTextAlign()},newStage:{textAlign:m}}),e.setTextAlign(m))}),this.runHooks("pushUndoData",b),canvas.renderAll()):(b.push({objectID:n.objectID,oldStage:{textAlign:n.getTextAlign()},newStage:{textAlign:m}}),n.setTextAlign(m),this.runHooks("pushUndoData",b),canvas.renderAll()),this.runHooks("updateIframe")
break
case"transparency":this.runHooks("doTextToolbarTransparency")
break
case"change-radius":this.runHooks("doTextToolbarRadiusCurved")
break
case"change-spacing":this.runHooks("doTextToolbarSpacingCurved")
break
case"lineheight":this.runHooks("doTextToolbarLineHeight")
break
case"letterspacing":this.runHooks("doTextToolbarLetterSpace")
break
case"delete":customConfirm(translateStrings.areYouSure,function(e){return function(){e.runHooks("deleteObject"),e.runHooks("updateIframe")}}(this),function(){})
break
case"clone":this.runHooks("cloneObject")
break
case"change-reverse":if(n&&n.curvedText){var v=[{objectID:n.objectID,oldStage:{reverse:n.reverse},newStage:{reverse:!n.reverse}}]
this.runHooks("pushUndoData",v),n.set("reverse",!n.reverse),canvas.renderAll(),this.runHooks("updateIframe")}break
case"more":var k=this.getElement("moreOptionsText_group",!0),C=this.getElement("stroke_option_group",!0)
n.curvedText?(k.addClass("curved"),C.hide()):(k.removeClass("curved"),C.show())
var w=this.getElement("helperElement",!0),I=this.getElement("blockElement",!0)
w.removeClass("active"),n.setHelper===!0?w.addClass("active"):w.removeClass("active"),I.removeClass("active"),1==n.lockRotation&&1==n.lockUniScaling&&1==n.lockMovementX&&1==n.lockMovementY&&1==n.lockScalingX&&1==n.lockScalingY?I.addClass("active"):I.removeClass("active"),k.toggleClass("edit")
break
case"locked":var l=o.data("type"),p=o.hasClass("current")?0:1,b={objectID:n.objectID,oldStage:{lockRotation:n.lockRotation,lockUniScaling:n.lockUniScaling,lockMovementX:n.lockMovementX,lockMovementY:n.lockMovementY,lockScalingX:n.lockScalingX,lockScalingY:n.lockScalingY}}
o.hasClass("current")?(n.set({lockRotation:!1,lockUniScaling:!1,lockMovementX:!1,lockMovementY:!1,lockScalingX:!1,lockScalingY:!1}),b.newStage={lockRotation:!1,lockUniScaling:!1,lockMovementX:!1,lockMovementY:!1,lockScalingX:!1,lockScalingY:!1}):(n.set({lockRotation:!0,lockUniScaling:!0,lockMovementX:!0,lockMovementY:!0,lockScalingX:!0,lockScalingY:!0}),b.newStage={lockRotation:!0,lockUniScaling:!0,lockMovementX:!0,lockMovementY:!0,lockScalingX:!0,lockScalingY:!0}),this.runHooks("pushUndoData",[b]),o.toggleClass("current"),canvas.renderAll()
break
case"helper":var l=o.data("type"),p=o.hasClass("current")?0:1,b={objectID:n.objectID,oldStage:{setHelper:"undefined"==typeof n.setHelper?null:n.setHelper}}
p?(n.setHelperDesign(!0),canvas.bringToFront(n),canvas.helpersInCanvas++,b.newStage={setHelper:!0}):(n.setHelperDesign(!1),canvas.helpersInCanvas--,b.newStage={setHelper:!1}),this.runHooks("pushUndoData",[b]),canvas.renderAll(),o.toggleClass("current"),this.runHooks("updateIframe")
break
case"clone":this.runHooks("cloneObject")
break
case"color":this.runHooks("doTextToolbarColor")}t.stopPropagation()}}}),this._on(this.element.find(this._O("fontsizeInput")),{keypress:function(t){if(13==t.which){var a=e(t.currentTarget),n=a.val()
this.closeAllChangers()
var o=[{objectId:canvas.getActiveObject().objectID,oldStage:{fontSize:canvas.getActiveObject().fontSize,textScales:canvas.getActiveObject().textScales},newStage:{fontSize:n,textScales:[1,1]}}]
this.runHooks("pushUndoData",o),canvas.getActiveObject().set("fontSize",parseInt(n)),canvas.getActiveObject().set("textScales",[1,1]),canvas.renderAll()}}})},changePreviewColorPlaceholder:function(e,t){this.element.find(".forecolor_selector").data("colorid",t).find(".current_color").css("background-color",e)},blurCurvedText:function(){this.getElement("curvedTextEdit")
e(document).off("click.curvedTextEdit").on("click.curvedTextEdit",function(t){return function(a){var n=!0
e(t.blurSelectorsCurvedText).each(function(){var o=e(this),i=e(a.target)
o[0]==i[0]&&(n=!1)
var r=e(t.blurSelectorsCurvedText).find(a.target)
r.length>0&&(n=!1)}),n&&t.closeCurvedTextEdit()}}(this))}})}(window.jQuery),!function(e){e.widget("printq.persImageToolbar",e.printq.persDefaultToolbar,{version:"1.0.0",status:"close",moreImageGroup:[],blockElement:[],helperElement:[],options:{blockElement:".moreImageGroup #BlockChoeserImage",helperElement:".moreImageGroup #HelperChoeserImage",moreImageGroup:".moreImageGroup",hide:{top:"-1500px",left:"-1500px"},qualityIcon:".quality_block span",mask:"#loading-mask"},_create:function(){canvas.on("mouse:up",function(e){return function(t){if(!(1!=t.e.which&&"touchend"!=t.e.type&&window.innerWidth<900)){var a=canvas.getActiveObject()||canvas.getActiveGroup()
"undefined"!=typeof t.target&&a&&(t.target=a),t.target&&"image"==t.target.type&&e.startToolbar(t.target)}}}(this)),canvas.on("selection:cleared",function(e){return function(t){e.stopToolbar()}}(this)),canvas.on("object:scaling",function(e){return function(t){t.target&&"image"==t.target.type&&e.stopToolbar()}}(this)),canvas.on("object:moving",function(e){return function(t){t.target&&"image"==t.target.type&&e.stopToolbar()}}(this)),this.bindEventsImageToolbar(),this.connectHooks(),this.bindToolbarActions()},setDimensions:function(){var t=5,a=this.element.find(".toolbarPhotoEdit > .group:visible"),n=0
e.each(a,function(){return function(){var t=e(this)
n+=t.outerWidth()}}()),this.element.css("width",n+t)},unbindEventsImageToolbar:function(){e(window).off("click.Image")},bindEventsImageToolbar:function(){e(window).on("click.Image",function(t){return function(a){var n=a.target,o=e("#printqTransparencyPicker").data("printq-persTransparencyToolbar"),i=e("#printqEffectPicker").data("printq-persEffectPicker")
e(".droppable > .canvas-container").find(n).length||t.element.find(n).length||o.element.find(n).length||i.element.find(n).length||t.stopToolbar()}}(this))},connectHooks:function(){this.addGlobalHook("blurEditor",this.onBlurEditorHookCallback,this),this.addGlobalHook("closeOthers",this.onCloseOthersHookCallback,this),this.addGlobalHook("bindEventsImageToolbar",this.bindEventsImageToolbar,this),this.addGlobalHook("unbindEventsImageToolbar",this.unbindEventsImageToolbar,this),this.addGlobalHook("stopImageToolbar",this.stopToolbar,this)},onBlurEditorHookCallback:function(){var e=canvas.getActiveObject()||canvas.getActiveGroup()
e&&"image"==e.type&&this.close()},_destroy:function(){this._super()},startToolbar:function(e){window.innerWidth>900&&"undefined"!=typeof e&&e&&"image"==e.type&&!canvas.enableBackgroundMove&&this.open()},stopToolbar:function(e){window.innerWidth>900&&this.close()},open:function(){this.runHooks("closeOthers"),this.status="open"
var e=(canvas.getActiveObject(),this.element)
e.addClass("edit"),this.setDefaults(),this.setDimensions(),this.setPosition(),this.runHooks("afterOpenToolbar",this)},close:function(){if("close"!==this.status){this.status="close"
var e=this.element,t=this._O("hide")
this.closeAllChangers(),e.removeClass("edit").css({top:t.top,left:t.left}).off("dblclick"),this.runHooks("afterCloseToolbar",this)}},onCloseOthersHookCallback:function(){"open"==this.status&&this.close()},setDefaults:function(){var e=this.element,t=canvas.getActiveObject()||canvas.getActiveGroup()
if(t){var a=e.find(".helper_group div.helper")
a.removeClass("current"),t.setHelper&&a.addClass("current")
var n=e.find(".locked_group div.locker")
n.removeClass("current"),1==t.lockRotation&&1==t.lockUniScaling&&1==t.lockMovementX&&1==t.lockMovementY&&1==t.lockScalingX&&1==t.lockScalingY&&n.addClass("current")}},closeAllChangers:function(e){if("more"!=e){var t=this.getElement("moreImageGroup",!0)
t.toggleClass("edit",!1)}this.element.find(".changer").removeClass("open").parent().removeClass("open"),this.runHooks("afterCloseChangers",e)},openChanger:function(e){e.toggleClass("open").parent().toggleClass("open")},bindToolbarActions:function(){this._on(this.element.find(".changer"),{mouseup:function(t){var a=(this.element,e(t.currentTarget)),n=a.data("action")
this.closeAllChangers(n||"default"),this.openChanger(a),t.stopPropagation()}}),this._on(this.element.find(".clickAction"),{mouseup:function(t){if(1==t.which){var a=(this.element,canvas.getActiveObject()||canvas.getActiveGroup()),n=e(t.currentTarget),o=a?n.data("action"):"default"
switch(this.closeAllChangers(o),o){case"transparency":this.runHooks("doImageToolbarTransparency")
break
case"position":var i=n.data("position")
this.runHooks("positionChange",i)
break
case"clone":this.runHooks("cloneObject")
break
case"delete":customConfirm(translateStrings.areYouSure,function(e){return function(){e.runHooks("deleteObject"),e.runHooks("updateIframe")}}(this),function(){})
break
case"effects":this.runHooks("doImageToolbarEffects")
break
case"locked":var r=(n.data("type"),n.hasClass("current")?0:1),s={objectID:a.objectID,oldStage:{lockRotation:a.lockRotation,lockUniScaling:a.lockUniScaling,lockMovementX:a.lockMovementX,lockMovementY:a.lockMovementY,lockScalingX:a.lockScalingX,lockScalingY:a.lockScalingY}}
n.hasClass("current")?(a.set({lockRotation:!1,lockUniScaling:!1,lockMovementX:!1,lockMovementY:!1,lockScalingX:!1,lockScalingY:!1}),s.newStage={lockRotation:!1,lockUniScaling:!1,lockMovementX:!1,lockMovementY:!1,lockScalingX:!1,lockScalingY:!1}):(a.set({lockRotation:!0,lockUniScaling:!0,lockMovementX:!0,lockMovementY:!0,lockScalingX:!0,lockScalingY:!0}),s.newStage={lockRotation:!0,lockUniScaling:!0,lockMovementX:!0,lockMovementY:!0,lockScalingX:!0,lockScalingY:!0}),this.runHooks("pushUndoData",[s]),n.toggleClass("current"),canvas.renderAll()
break
case"helper":var r=(n.data("type"),n.hasClass("current")?0:1),s={objectID:a.objectID,oldStage:{setHelper:"undefined"==typeof a.setHelper?null:a.setHelper}}
r?(a.setHelperDesign(!0),canvas.bringToFront(a),canvas.helpersInCanvas++,s.newStage={setHelper:!0}):(a.setHelperDesign(!1),canvas.helpersInCanvas--,s.newStage={setHelper:!1}),this.runHooks("pushUndoData",[s]),canvas.renderAll(),n.toggleClass("current"),this.runHooks("updateIframe")}t.stopPropagation()}}})}})}(window.jQuery),!function(e){e.widget("printq.persEffectPicker",e.printq.persBaseWidget,{version:"1.0.0",effectGallery:[],status:"close",allEffects:[],maskEffect:'<div class="selected"> <div class="imageEffect"></div><div class="mask"></div> <div class="ico icon printqicon-ok"></div></div>',options:{effectGallery:".pickerBody .effectGallery",allEffects:".pickerBody .allEffects",effectsList:["Original","Grayscale","Sepia2","Invert","Sepia","Emboss","Sharpen","Blur"],mask:"#loading-mask",hide:{top:"-1500px",left:"-1500px"}},_create:function(){this._super()},connectHooks:function(){this.addGlobalHook("doImageToolbarEffects",this.onDoImageToolbarEffects,this),this.addGlobalHook("afterjCropStartDraggable",this.onDoCloseHookCallback,this),this.addGlobalHook("afterCloseChangers",this.onAfterCloseChangersHookCallback,this)},onDoImageToolbarEffects:function(){this.open()},onDoCloseHookCallback:function(){this.close()},onAfterCloseChangersHookCallback:function(e){"effects"!=e&&this.close()},open:function(){"open"!==this.status&&(this.status="open",this.element.toggleClass("edit",!0),this.setPosition(),this.populateEffectPicker(),this.runHooks("afterEffectPickerOpen"))},close:function(){if("close"!==this.status){this.status="close"
var e=this._O("hide")
this.element.removeClass("edit").css({top:e.top,left:e.left}),this.runHooks("afterImagePickerClose")}},setPosition:function(){var t=canvas.getActiveObject()||canvas.getActiveGroup(),a=this.element,n=e(".droppable > .canvas-container").offset(),o=t.getLeft(),i=t.getTop(),r=(e(window).width(),/matrix\((-?\d*\.?\d+),\s*0,\s*0,\s*(-?\d*\.?\d+),\s*0,\s*0\)/),s=e(".droppable"),c=s.css("-webkit-transform")||s.css("-moz-transform")||s.css("-ms-transform")||s.css("-o-transform")||s.css("transform")||!1,l=c?c.match(r):[]
if(l.length&&parseFloat(l[1])<1&&(o*=parseFloat(l[1]),i*=parseFloat(l[1])),a.hasClass("edit")&&t&&["image"].indexOf(t.type)>=0){a.css("top",i-t.getHeight()/2+n.top-a.height()/2),a.css("left",o-t.getWidth()/2+n.left-a.width())}},destroyScrollableEffects:function(){var e=this.getElement("allEffects",!0)
e.data("mCS")&&e.mCustomScrollbar("destroy")},scrollableEffects:function(){var e=this.getElement("allEffects",!0)
e.data("mCS")?e.mCustomScrollbar("update"):e.mCustomScrollbar({scrollButtons:{enable:!1},theme:"printq-theme",axis:"y",scrollInertia:0})},populateEffectPicker:function(){var t=canvas.getActiveObject()||canvas.getActiveGroup()
if(t&&["image"].indexOf(t.type)>=0){this.destroyScrollableEffects()
var a=this.getElement("effectGallery",!0),n=t.thumbnail||t.getSrc()
a.html("")
var o=new Image,i=document.createElement("canvas")
o.onload=function(t,a,n){return function(){a.width=o.naturalWidth,a.height=o.naturalHeight
var i,r=a.getContext("2d")
e.each(t._O("effectsList"),function(t,a,n,r){return function(s,c){n.clearRect(0,0,a.width,a.height),n.drawImage(o,0,0,a.width,a.height)
var l=n.getImageData(0,0,a.width,a.height)
"Emboss"==c||"Sharpen"==c||"Blur"==c?(l.filterName=c,i=e.printqFiltersFunctions.Convolute(l)):i="function"==typeof e.printqFiltersFunctions[c]?e.printqFiltersFunctions[c](l):l,n.putImageData(i,0,0)
var d=e("<li />").addClass("effectContainer").data("filter",c),u=e("<u />"),g=e("<b />"),f=e("<span />").addClass("effectTitle"),h=t.getElement("effectGallery",!0),p=e(t.maskEffect)
d.append(p).append(u).append(g).append(f),d.find(".effectTitle").html(translateStrings.filtersName[c])
var v=a.toDataURL()
d.find(".imageEffect").css({"background-image":'url("'+v+'")'}),"Original"===c?d.off("click.Add").on("click.Add",function(e,t){return function(){e.runHooks("setOriginalFilter",{block:r,filterName:t})}}(t,c)):d.off("click.Add").on("click.Add",function(e,t){return function(){e.runHooks("setFilterToImage",{block:r,filterName:t})}}(t,c)),h.append(d),d.off("click.Close").on("click.Close",function(){t.close()})}}(t,a,r,n)),t.scrollableEffects()}}(this,i,t),o.src=n}},removeBlockEffect:function(){var t=e.printqEditorsStack.getCurrentElement()
if(t&&["image"].indexOf(t.type)>=0){var a=t.editableArea,n=a.find("img")
e.each(this._O("effectsList"),function(e,t){n.removeClass(t),a.data(t,"0")})}},restoreBlockEffect:function(){var t=e.printqEditorsStack.getCurrentElement()
if(t&&["image"].indexOf(t.type)>=0){var a=t.editableArea,n=a.find("img")
e.each(this._O("effectsList"),function(e,t){1==a.data(t)&&n.addClass(t)})}},removeBlockEffectUndoRedo:function(t,a){if(t&&["image"].indexOf(t.type)>=0){var n=t.editableArea,o=n.find("img")
e.each(this._O("effectsList"),function(e,t){1==a[t]?(o.addClass(t),n.data(t,"1")):(o.removeClass(t),n.data(t,"0"))})}}})}(window.jQuery),!function(e){var t=e.printqUndoRedo={}
e.extend(t,{defaults:{undoRedoContainer:"#editorTopbarContainer .navbarRight ",undoTriggerButton:"#editorTopbarContainer .navbarRight ul li.undoAction",redoTriggerButton:"#editorTopbarContainer .navbarRight  ul li.redoAction",container:"#editorTopbarContainer .navbarRight  ul#undoRedoContainer",activeClass:"active",hide:"hideUndoRedo",currentStage:[],undoStack:[],redoStack:[]},addHook:function(e,a,n){printqPluggable.PluginHooks.add(e,a,t,n)},addHookOnce:function(e,a,n){printqPluggable.PluginHooks.once(e,a,t,n)},removeHook:function(e,a,n){printqPluggable.PluginHooks.remove(e,a,t,n)},addGlobalHook:function(e,t,a){printqPluggable.PluginHooks.add(e,t,!1,a)},runHooks:function(e,a,n,o,i,r,s){return printqPluggable.PluginHooks.run(t,e,a,n,o,i,r,s)},connectHooks:function(){t.addGlobalHook("pushUndoData",t.pushUndoData),t.addGlobalHook("runRedo",t.runRedo),t.addGlobalHook("runClearUndoRedo",t.runClearUndoRedo),t.addGlobalHook("bindEventsUndoRedo",t.bindEventsUndoRedo),t.addGlobalHook("unbindEventsUndoRedo",t.unbindEventsUndoRedo),t.addGlobalHook("hideShowUndoRedo",t.hideShowUndoRedo)},runUndo:function(){var e=(t.getDefaults(),t.popUndoData())
e&&(canvas.deactivateAllWithDispatch(),e.forEach(function(e){if("undefined"!=typeof e.removed&&canvas.insertAt(e.removed,canvas.getObjects().length-canvas.helpersInCanvas),"undefined"!=typeof e.added&&canvas.getObjectByID(e.objectID).length>0&&canvas.remove(canvas.getObjectByID(e.objectID)[0]),"undefined"!=typeof e.oldStage&&canvas.getObjects().forEach(function(t){if(t&&e.objectID==t.objectID)for(var a in e.oldStage)t.set(a,e.oldStage[a]),t.setCoords()}),"undefined"!=typeof e.backgroundImage&&e.backgroundImage){var a=null===e.oldStageBackground.backgroundSrc?null:e.oldStageBackground.backgroundSrc
a?canvas.setBackgroundImage(a,function(){return function(){t.runHooks("updateSizeAndPositionBackground"),t.runHooks("updateIframe"),t.runHooks("makeBackgroundImageSelected"),canvas.renderAll()}}()):(canvas.backgroundImage="",canvas.renderAll())}if("undefined"!=typeof e.position&&"undefined"!=typeof e.objects&&e.objects.length){e.objects.sort(function(e,t){return e.oldObjectIndex<t.oldObjectIndex})
for(var n=0;n<=e.objects.length-1;n++){var o=canvas.getObjectByID(e.objects[n].objectID)[0]
canvas.moveTo(o,e.objects[n].oldObjectIndex),o.setCoords()}}"undefined"!=typeof e.filterId&&"added"==e.type&&(canvas.getObjectByID(e.objectID)[0].filters=e.oldFilter||[],canvas.getObjectByID(e.objectID)[0].applyFilters(function(){canvas.renderAll()})),"undefined"!=typeof e.filterId&&"removed"==e.type&&(canvas.getObjectByID(e.objectID)[0].filters=e.oldFilter||[],canvas.getObjectByID(e.objectID)[0].applyFilters(function(){canvas.renderAll()}))}),canvas.renderAll(),t.runHooks("updateIframe"))},runRedo:function(){var e=(t.getDefaults(),t.popRedoData())
e&&(canvas.deactivateAllWithDispatch(),e.forEach(function(e){if("undefined"!=typeof e.added&&canvas.insertAt(e.added,canvas.getObjects().length-canvas.helpersInCanvas),"undefined"!=typeof e.removed&&canvas.getObjectByID(e.objectID).length>0&&canvas.remove(canvas.getObjectByID(e.objectID)[0]),"undefined"!=typeof e.newStage&&canvas.getObjects().forEach(function(t){if(t&&e.objectID==t.objectID)for(var a in e.oldStage)t.set(a,e.newStage[a]),t.setCoords()}),"undefined"!=typeof e.backgroundImage&&e.backgroundImage){var a=null===e.newStageBackground.backgroundSrc?null:e.newStageBackground.backgroundSrc
a?canvas.setBackgroundImage(a,function(){return function(){t.runHooks("updateSizeAndPositionBackground"),t.runHooks("updateIframe"),t.runHooks("makeBackgroundImageSelected"),canvas.renderAll()}}()):(canvas.backgroundImage="",canvas.renderAll())}if("undefined"!=typeof e.position&&"undefined"!=typeof e.objects&&e.objects.length){e.objects.sort(function(e,t){return e.newObjectIndex>t.newObjectIndex})
for(var n=0;n<=e.objects.length-1;n++){var o=canvas.getObjectByID(e.objects[n].objectID)[0]
canvas.moveTo(o,e.objects[n].newObjectIndex),o.setCoords()}}"undefined"!=typeof e.filterId&&"removed"==e.type&&(canvas.getObjectByID(e.objectID)[0].filters=e.newFilter||[],canvas.getObjectByID(e.objectID)[0].applyFilters(function(){canvas.renderAll()})),"undefined"!=typeof e.filterId&&"added"==e.type&&(canvas.getObjectByID(e.objectID)[0].filters=e.newFilter||[],canvas.getObjectByID(e.objectID)[0].applyFilters(function(){canvas.renderAll()}))}),canvas.renderAll(),t.runHooks("updateIframe"))},runClearUndoRedo:function(){var a=t.getDefaults()
e(a.undoTriggerButton).removeClass(a.activeClass),e(a.redoTriggerButton).removeClass(a.activeClass),a.undoStack=[],a.redoStack=[],t.refreshUndoRedoStatus()},popRedoData:function(e){var a=t.getDefaults(),e=a.redoStack.pop()
return a.undoStack.push(e),t.refreshUndoRedoStatus(),e},pushUndoData:function(e){var a=t.getDefaults()
a.undoStack.push(e),a.redoStack=[],t.refreshUndoRedoStatus()},popUndoData:function(){var e=t.getDefaults(),a=e.undoStack.pop()
return t.pushRedoData(a),t.refreshUndoRedoStatus(),a},pushRedoData:function(e){var a=t.getDefaults()
a.redoStack.push(e)},refreshUndoRedoStatus:function(){var a=t.getDefaults()
a.undoStack.length<1?e(a.undoTriggerButton).removeClass(a.activeClass):e(a.undoTriggerButton).addClass(a.activeClass),a.redoStack.length<1?e(a.redoTriggerButton).removeClass(a.activeClass):e(a.redoTriggerButton).addClass(a.activeClass)},getDefaults:function(a){return e.extend(t.defaults,a)},bindEventsUndoRedo:function(){var a=t.getDefaults()
e(a.undoTriggerButton).off("click").on("click",function(a){return function(){e(this).hasClass(a.activeClass)&&t.runUndo()}}(a)),e(a.redoTriggerButton).off("click").on("click",function(a){return function(){e(this).hasClass(a.activeClass)&&t.runRedo()}}(a)),canvas.on("mouse:down",function(e){return function(t){var a=t.target
if(a)if("undefined"==typeof a.objects)e.currentStage=[{objectID:a.objectID,oldStage:{left:a.left,top:a.top,width:a.width,height:a.height,angle:a.angle,currentHeight:a.currentHeight,currentWidth:a.currentWidth,scaleX:a.scaleX,scaleY:a.scaleY}}]
else{e.currentStage=[]
for(var n in a.objects)a.objects[n]&&e.currentStage.push({objectID:a.objects[n].objectID,oldStage:{left:a.objects[n].left+a.left,top:a.objects[n].top+a.top,width:a.objects[n].width,height:a.objects[n].height,angle:a.objects[n].angle,currentHeight:a.objects[n].currentHeight,currentWidth:a.objects[n].currentWidth,scaleX:a.objects[n].scaleX,scaleY:a.objects[n].scaleY}})}}}(a)),canvas.on("mouse:up",function(e){return function(a){var n=a.target
if(n)if("undefined"==typeof n.objects){var o={objectID:n.objectID,newStage:{left:n.left,top:n.top,width:n.width,height:n.height,angle:n.angle,currentHeight:n.currentHeight,currentWidth:n.currentWidth,scaleX:n.scaleX,scaleY:n.scaleY}}
e.currentStage.forEach(function(e){if(o.objectID==e.objectID&&JSON.stringify(o.newStage)!=JSON.stringify(e.oldStage)){var a=e
a.newStage=o.newStage,t.pushUndoData([a])}})}else{var i=[]
for(var r in n.objects){if(n.objects[r]){var o={objectID:n.objects[r].objectID,newStage:{left:n.objects[r].left+n.left,top:n.objects[r].top+n.top,width:n.objects[r].width,height:n.objects[r].height,angle:n.objects[r].angle,currentHeight:n.objects[r].currentHeight,currentWidth:n.objects[r].currentWidth,scaleX:n.objects[r].scaleX,scaleY:n.objects[r].scaleY}}
e.currentStage.forEach(function(e){if(o.objectID==e.objectID&&JSON.stringify(o.newStage)!=JSON.stringify(e.oldStage)){var t=e
t.newStage=o.newStage,i.push(t)}})}r==n.objects.length-1&&i.length&&t.pushUndoData(i)}}}}(a))},unbindEventsUndoRedo:function(){var a=t.getDefaults()
e(a.undoTriggerButton).off("click"),e(a.redoTriggerButton).off("click")},hideShowUndoRedo:function(){var a=t.getDefaults()
e(a.container).toggleClass(a.hide)},init:function(){t.getDefaults()
t.connectHooks(),t.runClearUndoRedo(),t.bindEventsUndoRedo()}})}(window.jQuery),!function(e){e.widget("printq.baseImageGalleryWidget",e.printq.persBaseWidget,{version:"1.0.0",activeClassTrigger:"active",triggersFrames:[],parentGallery:[],placeHolder:[],previewContainer:[],scrollable:[],itemList:[],mask:[],picturesFrames:"facebookImagesFrame facebookAlbumsFrame instagramImagesFrame localImagesFrame",options:{itemList:".galleryImages",parentGallery:".galleryContainer",previewContainer:"#imageBarPlaceholder",scrollable:".scrollable",mask:"#loading-mask",placeHolder:".placeholder",triggersFrames:".uploadImagesContainer",minItems:15},_create:function(){this.connectHooks(),this.init()},init:function(){this.animateUploadButtons()},animateUploadButtons:function(){var t=this.getElement("triggersFrames")
t.mouseover(function(a){return function(){t.removeClass(a.activeClassTrigger),e(this).addClass(a.activeClassTrigger)
var n=e(this).prevAll(a._O("triggersFrames"))
e(this).hasClass("uploadInstagramContainer")?n.addClass("prevAll_All"):n.addClass("prevAll")}}(this)),t.mouseleave(function(e){return function(){t.removeClass(e.activeClassTrigger),t.removeClass("prevAll"),t.removeClass("prevAll_All")}}(this))},connectHooks:function(){this.addGlobalHook("loadImage",this._loadImage,this)},startToolbar:function(){},open:function(){this.setPosition()},setPosition:function(){},_changeFrame:function(e){var t=this.getElement("parentGallery")
t&&(t.removeClass(this.picturesFrames),t.addClass(e))},_createScrollbar:function(){var t=this.getElement("scrollable",!0)
t.mCustomScrollbar({scrollButtons:{enable:!1},theme:"dark-thin",axis:"x",autoHideScrollbar:!0,scrollInertia:0,contentTouchScroll:!0,advanced:{updateOnSelectorChange:"ul.galleryImages li.galleryItem",updateOnContentResize:!0},callbacks:{whileScrolling:function(){var t=e(this),a=t.find(".mCSB_container"),n=a.closest(".mCustomScrollBox"),o=t.find("ul.galleryImages li div.placeholder").filter(function(){var t=e(this)
if(t.data("original")==t.css("background-image"))return!1
var o=a.position().left,i=n.width(),r=t.closest("div.placeholder")
if(r.length)var s=r.position()
return s.left<i-o})
o.trigger("lazyScroll")}}})},_createDummyItem:function(){var t=this.getElement("itemList",!0)
if(t){var a=this.getElement("previewContainer"),n=e(a.html())
t.append(n)}},_enableLazyLoad:function(e){e.lazyload({event:"lazyScroll",effect:"fadeIn"})},_enableItemDraggble:function(t){t.draggable({appendTo:"body",revert:"invalid",handle:".drag",helper:function(){var t=e(this),a=t.data(),n=t.find(".placeholder"),o=n.width(),i=n.height(),r=a.image_src
return a.hasOwnProperty("thumbnail")&&(r=a.thumbnail),e("<div>").css({width:o,height:i,border:"1px solid #717173","background-color":"#ededed","background-image":'url("'+r+'")',"background-position":"center center","background-repeat":"no-repeat","background-size":"contain","z-index":"99999"})},drag:function(e,t){},start:function(e){return function(e,t){}}(t),cursor:"move"})},_removeElement:function(e){var t=this.getElement("itemList",!0)
if(t){var a=t.find(" #"+e.uniqueId)
a.length&&(a.remove(),this._createDummyItem())}},_setItemImageData:function(t,a){var n=[]
if("undefined"!=typeof a&&a.length)n=a
else{var o=this.getElement("itemList",!0)
o&&(n=o.find("#"+t.uniqueId))}return n.length&&e.each(t,function(e,t){return function(t,a){e.data(t,a)}}(n,this)),n},_createLoadingElem:function(t){var a=this.getElement("itemList",!0)
if(a){var n=a.find("li.empty")
if(n.length)var o=e(n[0])
else var i=this.getElement("previewContainer"),o=e(i.html())
var r=a.find("#"+t.uniqueId)
if(r.length&&r.remove(),a.find(".backButton").length){var s=a.find(".backButton")
o.insertAfter(s)}else a.prepend(o)
o.attr("id",t.uniqueId).removeClass("empty")}},_onError:function(e){return!(!e.hasOwnProperty("error")||!e.error.hasOwnProperty("message"))&&(alert(e.error.message,"error"),!0)},_clearFramePhotos:function(){var t=this.getElement("itemList",!0),a=0
t.find("li.image").each(function(t,a){return function(){e(this).remove(),++a<t._O("minItems")&&t._createDummyItem()}}(this,a))},_setImageOnDesigner:function(e,t){var a
e&&e.working_image&&(a=e.working_image,fabric.Image.fromURL(a,function(e,t,a){return function(n){var o=canvas.getPointer(e)
n.set({originX:"center",originY:"center",designerOptions:{type:"image",workingImage:t.working_image,originalWidth:t.width,originalHeight:t.height,actualWidth:n.width,actualHeight:n.height,imageName:t.imageName},thumbnail:t.thumbnail||t.working_image}),n.set({left:o.x,top:o.y}),n=a._resizeImage(n),canvas.insertAt(n,canvas.getObjects().length-canvas.helpersInCanvas,!1),a.runHooks("pushUndoData",[{objectID:n.objectID,added:n,type:"image"}]),a.runHooks("updateIframe")}}(t,e,this)))},_loadImage:function(e){var t=e.ui,a=e.event,n=e.ui.draggable.data()
if(n)switch(n.origin){case"socialNetwork":this._getSocialNetworkImage({data:n,ui:t,callback:function(e,t){return function(a){e._setImageOnDesigner(a,t)}}(this,a)})
break
default:this._setImageOnDesigner(n,a)}},_resizeImage:function(e){var t=400,a=400,n=0,o=e.width,i=e.height
return o>t&&(n=t/o,e.width=t,e.height=i*n,i*=n,o*=n),i>a&&(n=a/i,e.height=a,e.width=o*n,o*=n),e},_getSocialNetworkImage:function(t){if(t){var a=t.data,n=t.ui,o=t.callback,i=e.printqUniqueId({prefix:"loading_",sufix:"getSocialNetworkImage",length:6}),r=this.getElement("mask")
r.prinqLoading("start",i),e.printqAjaxRequest.postRequest({url:uploadUrlPhotoUrl,data:{custom_filename:a.imageId,createThumbnail:1,name:a.imageId,other_infos:a.other_infos,tName:a.imageId+"_thumb",width:"auto",height:"150",photo_url:encodeURIComponent(a.imageName),createWorkingImage:1,isUrlUpload:1,sid:uploadPhotoDirName,save_to_db:!0},onComplete:function(e,t,a,n,o){return function(i){if("undefined"!=typeof i){if("undefined"!=typeof i.success&&i.success){var r
r={id:i.id,uniqueId:"preload_"+i.path.replace(".","")+"_image",other_infos:i.other_infos,custom_filename:i.path,sid:i.sid,image_src:i.src},r.thumbnail=i.path,"undefined"!=typeof i.thumbnail&&(r.thumbnail=i.thumbnail),e.runHooks("addImageToLocalGallery",r)
var s,c=i.path,l=c,d=i.src
i.hasOwnProperty("thumbnail")&&i.thumbnail&&(d=i.thumbnail),s=i.hasOwnProperty("other_infos")&&i.other_infos.hasOwnProperty("working_image")?i.other_infos.working_image:i.src
var u={imagePath:c,image_src:l,imageName:i.path,imageSid:i.sid,imageId:i.id,other_infos:i.other_infos,height:i.other_infos.size.height,width:i.other_infos.size.width,working_image:s,thumbnail:d,type:"image"}
if("function"==typeof n&&n(u),o&&o.draggable){var g=o.draggable
g.data(u),g.removeData("origin")}}a.prinqLoading("stop",t)}}}(this,i,r,o,n),onFail:function(e,t,a){return function(e){alert("Error"),a.prinqLoading("stop",t)}}(this,i,r)})}}})}(window.jQuery),!function(e){e.widget("printq.localImageBarWidget",e.printq.baseImageGalleryWidget,{version:"1.0.0",frameName:"localImagesFrame",parentGallery:[],addNewTrigger:[],fileInput:[],options:{addNewTrigger:".uploadLocalContainer",fileInput:".files-upload-input",parentGallery:".galleryContainer"},_create:function(){this._changeFrame(this.frameName),this.createElementOptions(),this.initFileUpload(),this._createScrollbar(),this.connectHooks(),this.init()},createElementOptions:function(){this._off(this.element,"click span.remove"),this._on(this.element,{"click span.remove":function(t){return function(a){var n=e(a.currentTarget.parentElement.parentElement.parentElement)
if(n.length&&n.hasClass("image")){var o=n.data()
customConfirm(deletePhotoText,function(t,a){return function(){e.printqAjaxRequest.postRequest({url:deleteUserPhotoUrl,data:{sid:t.imageSid,name:t.imageName,id:t.imageId},onComplete:function(e,t){return function(a){"undefined"!=typeof a&&a.success&&t.removeElementByPhotoName(e)}}(t,a),onFail:function(){alert(translateStrings.deleteFail)}})}}(o,t),function(){})}}}(this)})},removeElementByPhotoName:function(t){var a=this.getElement("itemList",!0)
return!!t.hasOwnProperty("imageName")&&(!!t.hasOwnProperty("imageSid")&&(a.find("li.image").each(function(t,a){return function(){var n=e(this),o=n.data()
o.imageName==a.imageName&&o.imageSid==a.imageSid&&(n.remove(),t._createDummyItem())}}(this,t)),!0))},init:function(){if(imageBarData.length){e.each(imageBarData,function(e){return function(t,a){var n=e._setItemImageData(a)
if(n.length){var o=n.find(e._O("placeHolder"))
o.length&&e._enableLazyLoad(o),e._enableItemDraggble(n)}}}(this))
var t=this.getElement("scrollable",!0)
t.mCustomScrollbar("scrollTo","left")}},parseGetUserPhotosResponse:function(e){},addImageToLocalGallery:function(e){this._createLoadingElem(e),this.addImageToElement(e)},addImageToElement:function(e){var t=this.getElement("itemList",!0)
if(t){var a=t.find(" #"+e.uniqueId)
if(a.length){var n,o=a.find(this._O("placeHolder")),i=e.sid+"/"+e.custom_filename,r=e.image_src,s=r
e.hasOwnProperty("thumbnail")&&e.thumbnail&&(s=e.thumbnail),n=e.hasOwnProperty("other_infos")&&e.other_infos.hasOwnProperty("working_image")?e.other_infos.working_image:r,o.attr("data-original",s),this._enableLazyLoad(o),a.addClass("image imageContent")
var e={imagePath:i,image_src:r,imageName:e.custom_filename,imageSid:e.sid,imageId:e.id,other_infos:e.other_infos,height:e.other_infos.size.height,width:e.other_infos.size.width,working_image:n,thumbnail:s,type:"image"}
this._setItemImageData(e,a),this._enableItemDraggble(a)
var c=this.getElement("scrollable",!0)
c.mCustomScrollbar("scrollTo","left")}}},clearImageBarItems:function(t){var a=this.getElement("itemList",!0),n=[]
if(t.count>0&&e.each(t.files,function(e,t){n.push("preload_"+t.image+"_image")}),a){var o=a.find(">li.galleryItem ")
o.length&&o.each(function(t){return function(){var a=e(this)
a.hasClass(t._O("placeholder"))||e.inArray(a.attr("id"),n)||a.remove()}}(this))}},initFileUpload:function(){var t=this.getElement("parentGallery")
e.printqFileUploader.init({url:uploadUserPhotoUrl,context:"body",filesUpload:t.find(".files-upload-input").get(0),dropArea:t.find(".drop-area").get(0),onAppendParams:function(e){return function(e,t){e.append("sid",uploadPhotoDirName),e.append("createThumbnail",1),e.append("width","auto"),e.append("createWorkingImage",1),e.append("quality",90),e.append("height",150),e.append("save_to_db",!0),e.append("other_infos[type]","imageBarUpload")}}(this),onDrop:function(e){return function(){}}(this),onUpload:function(e){return function(){}}(this),onFileUploadStart:function(e){return function(t){e._createLoadingElem(t)}}(this),onFileToQueue:function(e){return function(e){}}(this),onComplete:function(t){return function(a,n){var o=e.parseJSON(a.response)
"undefined"!=typeof o.success&&o.success?(n.id=o.id,n.other_infos=o.other_infos,n.thumbnail=!1,n.sid=o.sid,n.imagePath=o.sid,n.image_src=o.src,o.thumbnail&&(n.thumbnail=o.thumbnail),t.addImageToElement(n)):t._removeElement(n)}}(this),onApiError:function(e){return function(t){e._removeElement(t)}}(this),onCompleteAll:function(e){return function(){}}(this),onApiComplete:function(e){return function(){}}(this),onProgress:function(e){return function(e,t){}}(this),onDragEnter:function(e){return function(){}}(this)})
var a=this.getElement("addNewTrigger")
a.off("click").on("click",function(e){return function(){e.triggerFileUploader()}}(this))},triggerFileUploader:function(){var e=this.getElement("parentGallery")
if(e.hasClass(this.frameName)){var t=this.getElement("fileInput")
t.click()}else{var a=this.getElement("scrollable",!0)
a.mCustomScrollbar("scrollTo","10"),this._changeFrame(this.frameName),a.mCustomScrollbar("scrollTo","left")}},connectHooks:function(){this.addGlobalHook("addImageToLocalGallery",this.addImageToLocalGallery,this)}})}(window.jQuery),!function(e){e.widget("printq.imageFacebookWidget",e.printq.baseImageGalleryWidget,{version:"1.0.0",versionFacebook:"v2.5",loaded:!1,frameName:"facebookAlbumsFrame",frame:[],facebookTriggerElement:[],itemList:[],previewContainer:[],options:{queueMaxSize:2e3,frame:".facebookAlbums",facebookTriggerElement:".uploadImagesContainer.uploadFacebookContainer",itemList:".galleryImages",previewContainer:"#imageBarPlaceholderFacebook"},_create:function(){this.init(),this._createScrollbar(),this.connectHooks()},init:function(){this.getFacebookApi()
var e=this.getElement("facebookTriggerElement")
e.off("click").on("click",function(e){return function(){var t=e.getElement("parentGallery")
t.hasClass(e.frameName)||(e.loaded?e._changeFrame(e.frameName):e.showConnectFacebook())}}(this))},getFacebookApi:function(){parseInt(allowFacebook)&&(e.ajaxSetup({cache:!0}),e.getScript("//connect.facebook.net/en_UK/all.js",function(e,t,a){return function(){FB.init({appId:facebookAppId,version:e.versionFacebook})}}(this)))},open:function(){},connectHooks:function(){},facebookShowLogin:function(){this._changeFrame(this.frameName),this._clearFramePhotos(),this.getFacebookAlbums(),this.loaded=!0},getFacebookAlbums:function(t){"undefined"==typeof t&&(t=""),FB.api(this.versionFacebook+"/me/albums?limit="+this._O("queueMaxSize")+t,function(t){return function(a){return!t._onError(a)&&void("object"==typeof a.data&&(a.data.length&&e.each(a.data,function(e){return function(t,a){e.createFacebookAlbum(a.id)}}(t)),"undefined"!=typeof a.paging&&"undefined"!=typeof a.paging.next&&t.getFacebookAlbums("&after="+a.paging.cursors.after)))}}(this))},createFacebookAlbum:function(e){FB.api(this.versionFacebook+"/"+e+"?fields=count,link,name,type,created_time,cover_photo",function(e,t){return function(e){if(t._onError(e))return!1
if("undefined"!=typeof e.count&&e.count){var a={id:e.id,uniqueId:"preload_"+e.id+"_facebookAlbum",name:e.name+" - ("+e.count+")"}
t._createLoadingElem(a),t.getFacebookImageDetails(e.cover_photo,function(e,t){return function(a){e.custom_filename=a.images[a.images.length-1].source,t.addImageToElement(e)}}(a,t))}}}(e,this))},getFacebookImageDetails:function(e,t){FB.api(this.versionFacebook+"/"+e.id+"?fields=images",function(e){return function(a){return!e._onError(a)&&void t(a)}}(this))},addImageToElement:function(e){var t=this.element,a=[]
if(t.length){var a=t.find(" #"+e.uniqueId)
if(a.length){var n=a.find(this._O("placeHolder"))
e.name&&a.find("div.itemTitle").html(e.name)
var o=e.custom_filename,i=o,r=i
e.hasOwnProperty("thumbnail")&&e.thumbnail&&(r=e.thumbnail),n.attr("data-original",r),this._enableLazyLoad(n),t.addClass("hasPhoto"),a.addClass("image openAlbum").data("id",e.id),this.bindClickAction(a)}}return a},bindClickAction:function(t){t&&t.hasClass("openAlbum")&&t.off("click").on("click",function(t){return function(){var a=e(this).data("id")
t.runHooks("openFacebookAlbum",a)}}(this))},showConnectFacebook:function(){"undefined"!=typeof FB&&FB.login(function(e){return function(t){if("undefined"!=typeof t.status)switch(t.status){case"connected":e.loaded=!0,e.facebookShowLogin()
break
case"not_authorized":alert(translateStrings.facebook.notAuthorized,"error")
break
default:alert(translateStrings.facebook.notLoggedIn,"error")}}}(this),{scope:"user_photos"})}})}(window.jQuery),!function(e){e.widget("printq.facebookAlbumsImages",e.printq.baseImageGalleryWidget,{version:"1.0.0",frameName:"facebookImagesFrame",frameAlbumsName:"facebookAlbumsFrame",versionFacebook:"v2.5",previewContainer:[],backButton:[],loaded:!1,options:{previewContainer:"#imageBarFacebookInstagramPlaceholder",backButton:".galleryItem.backButton"},_create:function(){this.connectHooks(),this.init(),this._createScrollbar()},init:function(){var e=this.getElement("backButton",!0)
e.on("click",function(e){return function(){e._changeFrame(e.frameAlbumsName)}}(this))},open:function(){},connectHooks:function(){this.addGlobalHook("openFacebookAlbum",this.openFacebookAlbum,this)},openFacebookAlbum:function(t,a){t&&(this._clearFramePhotos(),this._changeFrame(this.frameName),"undefined"==typeof a&&(a=""),FB.api(this.versionFacebook+"/"+t+"/photos?fields=source,images"+a,function(t,a){return function(n){return!a._onError(n)&&void("object"==typeof n.data&&(n.data.length&&e.each(n.data,function(e){return function(t,a){var n={id:a.id,uniqueId:"preload_"+a.id+"_facebookPhoto",custom_filename:a.images[0].source,thumbnail:a.images[a.images.length-1].source,other_infos:{type:"facebook",id:a.id,width:a.images[0].width,height:a.images[0].height}}
e._createLoadingElem(n,!1),e.addImageToElement(n)}}(a)),"undefined"!=typeof n.paging&&"undefined"!=typeof n.paging.next&&a.getFacebookAlbumPhotos(t,"&after="+n.paging.cursors.after)))}}(t,this)))},addImageToElement:function(e){var t=this.getElement("itemList",!0)
if(t){var a=t.find(" #"+e.uniqueId)
if(a.length){var n=a.find(this._O("placeHolder")),o=e.custom_filename
n.attr("data-original",o),this._enableLazyLoad(n),a.addClass("image imageContent")
var e={imageName:e.custom_filename,imageId:e.id,thumbnail:o,type:"image",origin:"socialNetwork",other_infos:{id:e.other_infos.id,type:"facebook",size:{width:e.other_infos.width,height:e.other_infos.height}}}
this._setItemImageData(e,a),this._enableItemDraggble(a)
var i=this.getElement("scrollable",!0)
i.mCustomScrollbar("scrollTo","left")}}}})}(window.jQuery),!function(e){e.widget("printq.instagramAlbumsImages",e.printq.baseImageGalleryWidget,{version:"1.0.0",frameName:"instagramImagesFrame",instagramMethod:"getUserRecent",loaded:!1,previewContainer:[],addNewTrigger:[],options:{previewContainer:"#imageBarFacebookInstagramPlaceholder",addNewTrigger:".uploadInstagramContainer"},_create:function(){this.init(),this._createScrollbar(),this.connectHooks()},init:function(){this.getInstagramApi(!1)},getInstagramApi:function(t){var a=""
t&&(a=this._O("mask")),parseInt(allowInstagram)&&e.printqAjaxRequest.postRequest({url:instagramActionUrl,data:{method:this.instagramMethod},mask:a,onComplete:function(e){return function(a){if(t){if("undefined"!=typeof a){if("undefined"!=typeof a.auth&&a.auth)return void e.instagramShowLogin(a)
var n=e.getElement("addNewTrigger")
return void n.popupWindow({windowURL:a.authUrl,windowName:"instagram_connect",centerBrowser:1,centerScreen:1,height:300,left:0,location:0,menubar:0,resizable:1,scrollbars:1,status:0,width:450,top:0,toolbar:0})}alert("Could Not Connect To Instagram","error")}else e.instagramShowNotLogin(a)}}(this)})},instagramShowLogin:function(e){this._clearFramePhotos(),this._changeFrame(this.frameName),this.getInstagramImage(e),this.loaded=!0},getInstagramImage:function(t){"getUserRecent"==this.instagramMethod&&t.data.length&&e.each(t.data,function(e){return function(t,a){if("image"==a.type){var n={id:a.id,uniqueId:"preload_"+a.id+"_instagramPhoto",custom_filename:a.images.standard_resolution.url,thumbnail:a.images.thumbnail.url,other_infos:{type:"instagram",id:a.id,height:a.images.standard_resolution.height,width:a.images.standard_resolution.width}}
e._createLoadingElem(n,!1),e.addImageToElement(n)}}}(this))},instagramShowNotLogin:function(t){var a=this.getElement("addNewTrigger")
a.off("click").on("click",function(a){return function(){a.loaded?a._changeFrame(a.frameName):e(this).popupWindow({windowURL:t.authUrl,windowName:"instagram_connect",centerBrowser:1,centerScreen:1,height:300,left:0,location:0,menubar:0,resizable:1,scrollbars:1,status:0,width:450,top:0,toolbar:0})}}(this))},open:function(){this.loaded?this._changeFrame(this.frameName):this.getInstagramApi(!0)},addImageToElement:function(e){var t=this.getElement("itemList",!0)
if(t){var a=t.find(" #"+e.uniqueId)
if(a.length){var n=a.find(this._O("placeHolder")),o=e.custom_filename
n.attr("data-original",o),this._enableLazyLoad(n),a.addClass("image imageContent")
var e={imageName:e.custom_filename,imageId:e.id,thumbnail:o,type:"image",origin:"socialNetwork",other_infos:{id:e.other_infos.id,type:"instagram",size:{width:e.other_infos.width,height:e.other_infos.height}}}
this._setItemImageData(e,a),this._enableItemDraggble(a)
var i=this.getElement("scrollable",!0)
i.mCustomScrollbar("scrollTo","left")}}},connectHooks:function(){}})}(window.jQuery),!function(e){e.widget("printq.unsplashImageGallery",e.printq.persBaseWidget,{lockGetBackgrounds:!1,picturesFrames:"searchResult backgroundResult",current_page:1,current_search_page:1,searchOldValue:null,backgroundTemplate:'<li class="listItem"><a href="javascript:void(0)" class="container"><u></u><div class="icon printqicon-ok"></div></a></li>',backgroundsGalleryList:[],backgroundsGeneralGallery:[],backgroundsSearchGallery:[],searchImage:[],searchInput:[],resetImage:[],mask:[],options:{backgroundsGalleryList:".backgroundsGalleryList",backgroundsGeneralGallery:".backgroundsGeneralGallery",backgroundsSearchGallery:".backgroundsSearchGallery",searchImage:".actions .search_unsplash_image",resetImage:".actions .reset_button",searchInput:".actions .searchImage",mask:"#loading-mask"},_create:function(){this.init(),this.blurThis()},_changeFrame:function(e){var t=this.element
t&&(t.removeClass(this.picturesFrames),t.addClass(e))},_enableLazyLoad:function(e){e.lazyload({event:"lazyScroll",effect:"fadeIn"})},init:function(){this._changeFrame("backgroundResult"),this.getBackgrounds(),this.connectHooks()
var t=this.getElement("backgroundsGeneralGallery",!0),a=this.getElement("backgroundsSearchGallery",!0),n=this.getElement("searchImage",!0),o=this.getElement("resetImage",!0)
t.mCustomScrollbar({scrollButtons:{enable:!1},theme:"white",axis:"y",callbacks:{whileScrolling:function(t){return function(){var a=this.mcs.topPct
a>94&&!t.lockGetBackgrounds&&(t.lockGetBackgrounds=!0,t.getBackgrounds({ignoreEmpty:!0}))
var n=e(this),o=n.find(".mCSB_container"),i=o.closest(".mCustomScrollBox"),r=n.find("ul.backgroundsGalleryList li a").filter(function(){var t=e(this)
if(t.data("original")==t.css("background-image").replace('url("',"").replace('")',""))return!1
var a=o.position().top,n=i.height(),r=t.closest("a")
if(r.length)var s=r.position()
return s.top<n-a})
r.trigger("lazyScroll")}}(this)}}),a.mCustomScrollbar({scrollButtons:{enable:!1},theme:"white",axis:"y",callbacks:{whileScrolling:function(t){return function(){var a=this.mcs.topPct
a>94&&!t.lockGetBackgrounds&&(t.lockGetBackgrounds=!0,t.searchUnsplashImage())
var n=e(this),o=n.find(".mCSB_container"),i=o.closest(".mCustomScrollBox"),r=n.find("ul.backgroundsGallerySearchList li a").filter(function(){var t=e(this)
if(t.data("original")==t.css("background-image").replace('url("',"").replace('")',""))return!1
var a=o.position().top,n=i.height(),r=t.closest("a")
if(r.length)var s=r.position()
return s.top<n-a})
r.trigger("lazyScroll")}}(this)}}),n.off("click").on("click",function(e){return function(){var t=e.getElement("searchInput",!0),a=t.val()
a!=e.searchOldValue&&e.searchUnsplashImage()}}(this)),o.off("click").on("click",function(e){return function(){e._changeFrame("backgroundResult")}}(this))},searchUnsplashImage:function(){var t=this.getElement("searchInput"),a=this.getElement("backgroundsSearchGallery"),n=t.val()
this.searchOldValue!==n&&(this.current_search_page=1,a.find("ul").html("")),this.searchOldValue=n,this._changeFrame("searchResult"),e.printqAjaxRequest.postRequest({mask:"",url:unsplashActionUrl,data:{query:n,page:this.current_search_page},onComplete:function(t,a){return function(n){n&&n.success?n.photos.length&&(e.each(n.photos,function(t){return function(a,n){var o=e(t.backgroundTemplate)
o.find("a").data({original:n.urls.thumb}),t._enableLazyLoad(e(o.find("a"))),o.data({full:n.urls.full,raw:n.urls.raw,regular:n.urls.regular,small:n.urls.small,thumb:n.urls.thumb}),o.off("click").on("click",function(t){return function(){t.setBackgroundImage(e(this))}}(t)),t.element.find(".backgroundsGallerySearchList").append(o)}}(t)),a.find("li.listItem a").trigger("lazyScroll"),t.current_search_page++,t.lockGetBackgrounds=!1):(t._changeFrame("backgroundResult"),t.lockGetBackgrounds=!1,alert(translateStrings.error))}}(this,a),onFail:function(e){return function(t){e._changeFrame("backgroundResult"),e.lockGetBackgrounds=!1,alert(translateStrings.error)}}(this)})},getBackgrounds:function(){e.printqAjaxRequest.postRequest({mask:"",url:unsplashActionUrl,data:{page:this.current_page,photosNumber:20},onComplete:function(t){return function(a){if(a&&a.success){if(a.photos.length){var n=t.getElement("backgroundsGeneralGallery",!0)
e.each(a.photos,function(t){return function(a,n){var o=e(t.backgroundTemplate)
o.find("a").data({original:n.urls.thumb}),t._enableLazyLoad(e(o.find("a")))
var i={full:n.urls.full,raw:n.urls.raw,regular:n.urls.regular,small:n.urls.small,thumb:n.urls.thumb,other_infos:{height:n.height,width:n.width},imageId:n.id}
"undefined"!=typeof n.wasUpload&&(i.wasUpload=1,i.full=n.image_src,i.image_src=n.image_src,i.working_image=n.working_image,i.thumb=n.thumb),o.data(i),o.off("click").on("click",function(t){return function(){var a=e(this).data()
a.wasUpload?t.setBackgroundImageFromAjax(a):t._getSocialNetworkImage({data:{imageId:a.imageId,imageName:a.raw,other_infos:a.other_infos},callback:function(e){return function(a){e.data({wasUpload:1,working_image:a.working_image,image_src:a.image_src}),t.setBackgroundImageFromAjax(a)}}(e(this))})}}(t)),t.element.find(".backgroundsGalleryList").append(o)}}(t)),n.find("li.listItem a").trigger("lazyScroll"),t.lockGetBackgrounds=!1,t.current_page++}}else t.lockGetBackgrounds=!1}}(this),onFail:function(e){return function(t){e.lockGetBackgrounds=!1,alert(translateStrings.error)}}(this)})},connectHooks:function(){},setBackgroundImage:function(e){if(e){var t=e.data(),a=t.regular,n=t.full
this.runHooks("pushUndoData",[{oldStageBackground:{backgroundSrc:"undefined"!=typeof canvas.backgroundImage&&canvas.backgroundImage&&"function"==typeof canvas.backgroundImage.getSrc?canvas.backgroundImage.getSrc():null},newStageBackground:{backgroundSrc:a},backgroundImage:!0}]),canvas.setBackgroundImage(a,function(e){return function(){e.runHooks("updateSizeAndPositionBackground"),e.runHooks("updateIframe"),e.runHooks("fitPage"),canvas.renderAll()}}(this),{crossOrigin:"Anonymous",originalSrc:n})}},blurThis:function(){var e=this.getElement("searchInput",!0)
e.keyup(function(e){return function(t){13==t.keyCode&&e.searchUnsplashImage()}}(this))},setBackgroundImageFromAjax:function(e){if(e){var t=e.working_image?e.working_image:e.image_src
this.runHooks("pushUndoData",[{oldStageBackground:{backgroundSrc:"undefined"!=typeof canvas.backgroundImage&&canvas.backgroundImage&&"function"==typeof canvas.backgroundImage.getSrc?canvas.backgroundImage.getSrc():null},newStageBackground:{backgroundSrc:t},backgroundImage:!0}]),canvas.setBackgroundImage(t,function(e){return function(){e.runHooks("updateSizeAndPositionBackground"),e.runHooks("updateIframe"),e.runHooks("fitPage"),canvas.renderAll()}}(this),{originalSrc:e.image_src})}},_getSocialNetworkImage:function(t){if(t){var a=t.data,n=t.callback,o=e.printqUniqueId({prefix:"loading_",sufix:"getSocialNetworkImage",length:6}),i=this.getElement("mask")
i.prinqLoading("start",o),e.printqAjaxRequest.postRequest({url:uploadUrlPhotoUrl,data:{custom_filename:a.imageId,createThumbnail:1,name:a.imageId,other_infos:a.other_infos,tName:a.imageId+"_thumb",width:"auto",height:"150",photo_url:encodeURIComponent(a.imageName),createWorkingImage:1,isUrlUpload:1,sid:"unsplash",save_to_db:!1},onComplete:function(e,t,a,n){return function(e){if("undefined"!=typeof e){if("undefined"!=typeof e.success&&e.success){var o
o={id:e.id,uniqueId:"preload_"+e.path.replace(".","")+"_image",other_infos:e.other_infos,custom_filename:e.path,sid:e.sid},o.thumbnail=e.path,"undefined"!=typeof e.thumbnail&&e.success&&(o.thumbnail=e.thumbnail)
var i,r=e.path,s=e.src,c=s
e.hasOwnProperty("thumbnail")&&e.thumbnail&&(c=e.thumbnail),i=e.hasOwnProperty("other_infos")&&e.other_infos.hasOwnProperty("working_image")?e.other_infos.working_image:s
var l={imagePath:r,image_src:s,imageName:e.path,imageSid:e.sid,imageId:e.id,other_infos:e.other_infos,height:e.other_infos.size.height,width:e.other_infos.size.width,working_image:i,thumbnail:c,type:"image"}
"function"==typeof n&&n(l)}else alert(e.message)
a.prinqLoading("stop",t)}else alert("Error"),a.prinqLoading("stop",t)}}(this,o,i,n),onFail:function(e,t,a){return function(e){alert("Error"),a.prinqLoading("stop",t)}}(this,o,i)})}}})}(window.jQuery),!function(e){e.widget("printq.previewWidget",e.printq.persBaseWidget,{version:"1.0.0",active:"active",body:"body",pageImageCachePreview:{},pageTemplate:'<div id="preview_page" class="page"></div>',preview_page:[],mask:[],previewButton:[],editButton:[],editArea:[],previewArea:[],pagesContainer:[],centerChoice:[],tab_pane:[],addCart:[],saveAdminEditOrder:[],checked_download:"#checked_download",bodyStates:"edit_area preview_area",options:{mask:"#loading-mask",previewButton:".previewPersonalization",editButton:".editPersonalization",editArea:"#edit_tab",previewArea:"#preview_tab",tab_pane:".tab_pane",pagesContainer:"#canvasAreaPreview",preview_page:"#preview_page",centerChoice:".centerChoice",addCart:"#addtoCartContainer #attach",saveAdminEditOrder:"#addtoCartContainer #attachAdmin"},_create:function(){this.connectHooks(),this.init()},addToCart:function(){var t=!0,a=parseInt(e(".droppable").data("page"))
if(e("body").removeClass("loading_canvas"),this.runHooks("getCanvasPageForPreview",a),e.each(themePageContent,function(e,n){if(("undefined"==typeof n.visited||!n.visited)&&parseInt(a+1)!=parseInt(n.page_number))return t=!1,!1}),!t)return this.runHooks("calculateInitialZoom"),e("body").addClass("loading_canvas"),alert(translateStrings.previewPageValidate),!1
var n=e.printqUniqueId({prefix:"loading_",sufix:"addToCart",length:6}),o=this.getElement("mask")
e.q(o).prinqLoading("start",n)
var i=[],r=[]
e.each(themePageContent,function(e,t){i.push(t.content_preview),r.push(t.preview_image.replace("data:image/jpeg;base64,",""))}),addToCartData.pqd_content=i,addToCartData.pqd_image_preview=r,e.printqAjaxRequest.postRequest({url:addToCartUrl,data:addToCartData,onComplete:function(t,a,n){return function(o){o&&!o.error?(e("body").addClass("loading_canvas"),window.location.href=wc_pqd_cart_url):o&&o.error&&(t.runHooks("calculateInitialZoom"),e("body").addClass("loading_canvas"),alert(translateStrings.error)),e.q(n).prinqLoading("stop",a)}}(this,n,o),onFail:function(t,a,n){return function(o){t.runHooks("calculateInitialZoom"),e("body").addClass("loading_canvas"),e.q(n).prinqLoading("stop",a),alert(translateStrings.error)}}(this,n,o)})},connectHooks:function(){this.addGlobalHook("changeBodyState",this.changeBodyState,this),this.addGlobalHook("addToCart",this.addToCart,this)},previewAction:function(){var t=!0,a=[],n=parseInt(e(".droppable").data("page")),o=this.getElement("tab_pane"),i=this.getElement("previewArea"),r=this.getElement("previewButton"),s=this.getElement("editButton"),c=this.getElement("centerChoice")
if(e.each(themePageContent,function(e,o){return"undefined"!=typeof o.visited&&o.visited||parseInt(n+1)==parseInt(o.page_number)?void a.push(o.content_preview):(alert(translateStrings.previewPageValidate),t=!1,!1)}),!t)return c.parent().removeClass(this.active),void s.parent().addClass(this.active)
e("body").removeClass("loading_canvas"),this.runHooks("getCanvasPageForPreview",n),c.parent().removeClass(this.active),r.parent().addClass(this.active),a[n]=themePageContent[n].content_preview,this.runHooks("createPaginationPreview"),e.editorPreviewCustomPagination.init({}),this.runHooks("runClearUndoRedo"),this.runHooks("hideShowUndoRedo"),this.changeBodyState("preview_area")
var l=e(this.pageTemplate),d=this.getElement("pagesContainer",!0)
l.html(a[0]).addClass(this.active),d.html(""),d.append(l),o.removeClass(this.active),i.addClass(this.active)},magnify:function(t){var a=0,n=0
t.mousemove(function(t){if(a||n){var o=e(this).offset(),i=t.pageX-o.left,r=t.pageY-o.top
if(i<e(this).width()&&r<e(this).height()&&i>0&&r>0?e(".large").fadeIn(100):e(".large").fadeOut(100),e(".large").is(":visible")){var s=Math.round(i/e(".small").width()*a-e(".large").width()/2)*-1,c=Math.round(r/e(".small").height()*n-e(".large").height()/2)*-1,l=s+"px "+c+"px",d=i-e(".large").width()/2,u=r-e(".large").height()/2
e(".large").css({left:d,top:u,"background-position":l,"background-size":e(".large").css("background-size")})}}else{var g=new Image
g.src=e(".small").attr("src")
var f=e(".large").css("background-size"),h=f.split("px")
a=e.trim(h[0]),n=e.trim(h[1])}})},editAction:function(){var t=this.getElement("tab_pane"),a=this.getElement("editArea"),n=this.getElement("editButton"),o=this.getElement("centerChoice"),i=this.getElement("previewButton")
this.runHooks("hideShowUndoRedo"),this.changeBodyState("edit_area"),o.parent().removeClass(this.active),n.parent().addClass(this.active),i.parent().removeClass(this.active),t.removeClass(this.active),a.addClass(this.active),this.runHooks("resetPagination"),this.runHooks("unbindPreviewTriggerPagination"),this.runHooks("bindEditTriggerPagination"),e.editorCustomPagination.init({page:1}),this.runHooks("loadCanvas",themePageContent[0])},changeBodyState:function(t){e(this.body).removeClass(this.bodyStates),t&&e(this.body).addClass(t)},init:function(){var t=this.getElement("previewButton"),a=this.getElement("editButton"),n=this.getElement("addCart")
this.getElement("saveAdminEditOrder")
t.off("click").on("click",function(t){return function(){e(this).parent().hasClass("active")||t.previewAction()}}(this)),a.off("click").on("click",function(t){return function(){e(this).parent().hasClass("active")||t.editAction()}}(this)),n.off("click").on("click",function(e){return function(){e.addToCart()}}(this))}})}(window.jQuery),!function(e){e.widget("printq.scrollerDesignerWidget",e.printq.persBaseWidget,{version:"1.0.0",canvasContainer:[],scroller:[],scrollDesign:[],ignoreScroll:!1,centerZoomOffset:{},offset:17,options:{canvasContainer:".droppable > .canvas-container",scrollDesign:".scrollDesign"},_create:function(){this.init(),this.eventLister()},init:function(){this.connectHooks()},updateScrollerDimensions:function(){var e=this.getElement("canvasContainer"),t=e[0].getBoundingClientRect()
this.element.css({width:0,height:0}),t&&this.element.css({width:t.width+this.offset,height:t.height+this.offset})
var a=this.getElement("scrollDesign",!0)
a&&a.css({width:0,height:0}),this.element.hide()},eventLister:function(){canvas.on("zoom_canvas",function(e){return function(t){var a=t.target,a=t.target
if(a){var n=a.viewportTransform,o=fabric.util.transformPoint({x:a.getWidth(),y:a.getHeight()},n,!0)
e.element.find(".scrollDesign").css({width:o.x,height:o.y}),n[4]<0&&n[5]<0?e.element.show():e.element.hide(),e.ignoreScroll=!0,e.element.scrollLeft(Math.abs(n[4])),e.element.scrollTop(Math.abs(n[5]))}}}(this)),this.element.on("scroll",function(e){return function(t){var a=e.ignoreScroll
if(e.ignoreScroll=!1,!a){canvas.deactivateAllWithDispatch()
var n=t.target.scrollLeft,o=t.target.scrollTop
canvas.viewportTransform[4]=-n,canvas.viewportTransform[5]=-o,canvas.renderAll()
for(var i=canvas.getObjects(),r=0;r<i.length;r++)i[r].setCoords()}}}(this))},connectHooks:function(){this.addGlobalHook("updateScrollerDimensions",this.updateScrollerDimensions,this)}})}(window.jQuery),!function(e){e.widget("printq.downloadWidget",e.printq.persBaseWidget,{version:"1.0.0",active:"active",imageCanvasId:"imagePlaceHolder",mask:[],dropDown:[],triggerMenu:[],downloadImg:[],blurSelectors:".downloadPdfAction, .downloadOptions li, .downloadOptions li a, .downloadPdfAction span ",options:{triggerMenu:".downloadPdfAction",dropDown:".downloadOptions",mask:"#loading-mask"},init:function(){this.connectHooks(),this.blurThis()
var t=this.getElement("triggerMenu")
t.off("click").on("click",function(t){return function(){var a=t.getElement("dropDown")
e(this).hasClass(t.active)?a.removeClass(t.active):a.addClass(t.active),e(this).toggleClass(t.active)}}(this))},_create:function(){this.connectHooks(),this.init()},getCanvasInitialDimensions:function(e,t,a){if(1!=canvasScale){var n=1-canvasScale
canvasScale=1
var o=parseInt(themePageContent[t].width),i=parseInt(themePageContent[t].height)
e.setWidth(o+2*canvasOffsetWidth),e.setHeight(i+2*canvasOffsetHeight)
var r=e.getObjects()
for(var s in r){var c=r[s].get("scaleX"),l=r[s].get("scaleY"),d=r[s].get("left"),u=r[s].get("top"),g=c*(canvasScale/(canvasScale-n)),f=l*(canvasScale/(canvasScale-n)),h=d*(canvasScale/(canvasScale-n))
h-=canvasOffsetWidth/(canvasScale-n)*n
var p=u*(canvasScale/(canvasScale-n))
p-=canvasOffsetHeight/(canvasScale-n)*n,r[s].set("scaleX",g),r[s].set("scaleY",f),r[s].set("left",h),r[s].set("top",p),r[s].setCoords()}}"function"==typeof a&&a()},clearImageCanvas:function(){e("body").remove("#"+this.imageCanvasId)},connectHooks:function(){},blurThis:function(){e(document).off("click.dropDownload").on("click.dropDownload",function(t){return function(a){var n=!0
e(t.blurSelectors).each(function(){var o=e(this),i=e(a.target)
o[0]==i[0]&&(n=!1)
var r=e(t.blurSelectors).find(a.target)
r.length>0&&(n=!1)}),n&&t.closePagination()}}(this))},closePagination:function(){var e=this.getElement("triggerMenu")
e.removeClass(this.active),this.element.removeClass(this.active)}})}(window.jQuery),!function(e){var t=e.printqTooltip={}
e.extend(t,{defaults:{hasTooltip:".hasTooltip"},_O:function(a){return e.extend({},t.defaults,a)},init:function(){var a=t._O(a),n=e(a.hasTooltip)
n.tooltip({items:"div,li,button",show:!1,hide:!1,track:!0,content:function(){var t=e(this),a=e(".tooltip"),n=t.data("tooltip")
if("undefined"!=typeof n)return a.find(".toolTipTitle p").html(tooltipTranslation[n].title),a.find(".toolTipDescription p").html(tooltipTranslation[n].description),a.html()}})}})}(window.jQuery),!function(e){var t=e.printqPositioning={}
e.extend(t,{defaults:{elem:null,minrows:1,maxrows:2},_O:function(a){return e.extend({},t.defaults,a)},position:function(e){var e=t._O(e)
if(e.elem){var a=e.elem.height(),n=e.elem.find("ul")
if(n.length){var o=e.elem.find("li").outerWidth(),i=e.elem.find("li").outerHeight(),r=parseInt(a/i),s=n.find("li").size()
return e.minrows>r?r=e.minrows:e.maxrows<r&&(r=e.maxrows),s%2!=0&&r>1&&s++,window.innerWidth<s*o/r?n.css({width:s*o/r}):n.css({width:"100%"}),t.attachEvent(e),!0}}},attachEvent:function(e){var e=t._O(e)
window.onresize=function(){return function(a){t.position(e)}}(e)}}),e.fn.printqPositioning=function(){var e=t._O({elem:this})
return t.position(e)}}(window.jQuery),!function(e){var t=e.printqEscaper={},a=Object.keys
e.extend(t,{defaults:{escapeMap:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"," ":"&nbsp;"},canvas:null},_O:function(a){return e.extend({},t.defaults,a)},_createEscaper:function(e){var a=function(t){return e[t]},n="(?:"+t._keys(e).join("|")+")",o=RegExp(n),i=RegExp(n,"g")
return function(e){return e=null==e?"":""+e,o.test(e)?e.replace(i,a):e}},_keys:function(e){if(!t._isObject(e))return[]
if(a)return a(e)
var n=[]
for(var o in e)t._has(e,o)&&n.push(o)
return n},_isObject:function(e){var t=typeof e
return"function"===t||"object"===t&&!!e},_has:function(e,t){return null!=e&&hasOwnProperty.call(e,t)},_invert:function(e){for(var a={},n=t._keys(e),o=0,i=n.length;o<i;o++)a[e[n[o]]]=n[o]
return a},_escape:function(e,a){var a=t._O(a),n=t._createEscaper(a.escapeMap)
return n(e)},_unescape:function(e,a){var a=t._O(a),n=t._createEscaper(t._invert(a.escapeMap))
return n(e)},_decodeEntities:function(e){if(e&&"string"==typeof e){var t=document.getElementsByClassName("fabric_edit_text")
e=encodeURIComponent(e).replace(/%26/g,"&").replace(/%23/g,"#").replace(/%3B/g,";"),t.innerHTML=e,t.innerText?(e=t.innerText,t.innerText=""):(e=t.textContent,t.textContent="")}return decodeURIComponent(e).replace(new RegExp("\n","g"),"").replace(new RegExp("<br>$","g"),"").replace(new RegExp("<br>","g"),"\n")}}),e.fn.pqEscape=function(){var a=e(this)
return t._escape(a.html())},e.fn.pqUnescape=function(){var a=e(this),n=a.html()
return n=n.replace(/<br>$/,""),t._unescape(n)},e.fn.pqDecodeEntities=function(){var a=e(this),n=a.html()
return t._decodeEntities(n)}}(window.jQuery),!function(e){var t=e.fitText={}
e.extend(t,{defaults:{minFontSize:1,maxIterations:500,multiplier:.5,callback:null,widthToFit:null,heightToFit:null,e:{iterations:0},target:null,checkFont:!1,textArea:".fabric_edit_text"},_O:function(a){var n=e.extend(!0,{},t.defaults)
return e.extend(!0,n,a)},init:function(a){var n=t._O(a)
if(n.target)if(n.checkFont){var o=n.target.css("font-family")
"undefined"!=typeof o&&e.inArray(o,defaultFonts)>=0?WebFont.load({custom:{families:[o]},active:function(e){return function(){t.adjustText(e)}}(n),fontactive:function(e,a){return function(n,o){a==n&&t.adjustText(e)}}(n,o)}):t.adjustText(n)}else t.adjustText(n)
return!1},getLocalFontSize:function(e,t){return parseFloat((e*t).toFixed(4))},adjustText:function(a){var a=t._O(a),n=a.e,o=(!!navigator.userAgent.match(/Trident.*/),1)
n.iterations=0
var i=parseFloat(a.target.data("font_size_default")),r=e.fitText.getLocalFontSize(i,o),s=r+"pt",c=e.q(a.textArea),l=c.get(0),d=a.target.get(0),u=a.target.pqDecodeEntities()
for(c.val(u),c.css({width:a.widthToFit,height:a.heightToFit,"font-size":a.target.css("font-size"),"font-weight":a.target.css("font-weight"),"font-family":"'"+a.target.css("font-family")+"'","letter-spacing":a.target.css("letter-spacing"),"line-height":a.target.css("line-height"),"word-spacing":a.target.css("word-spacing"),resize:"none",margin:0,padding:0,border:"none"});(a.widthToFit<l.scrollWidth||a.heightToFit<l.scrollHeight||a.widthToFit<d.scrollWidth-1||a.heightToFit<a.target.height()-1)&&a.maxIterations>n.iterations&&i>0;)i-=a.multiplier,r=e.printqEditor.getLocalFontSize(i,o),s=r+"pt",a.target.css({"font-size":s,"min-height":s}),c.val(""),c.css("overflow","hidden"),c.css({width:a.widthToFit,height:a.heightToFit,"font-size":a.target.css("font-size"),"font-weight":a.target.css("font-weight"),"font-family":"'"+a.target.css("font-family")+"'","letter-spacing":a.target.css("letter-spacing"),"line-height":a.target.css("line-height"),"word-spacing":a.target.css("word-spacing"),resize:"none",margin:0,padding:0,border:"none"}),c.val(u),c.css("overflow","auto"),n.iterations++
n.iterations>0&&a.target.data({font_size:r,font_size_default:parseFloat(i),changed_font_size:!0}),t.runHooks("afterFontSizeChange"),"function"==typeof a.callback&&a.callback(this,n)},addGlobalHook:function(e,t,a){printqPluggable.PluginHooks.add(e,t,!1,a)},addHookOnce:function(e,a,n){printqPluggable.PluginHooks.once(e,a,t,n)},addGlobalHookOnce:function(e,t,a){printqPluggable.PluginHooks.once(e,t,!1,a)},removeHook:function(e,a){printqPluggable.PluginHooks.remove(e,a,t)},runHooks:function(e,a,n,o,i,r,s){return printqPluggable.PluginHooks.run(t,e,a,n,o,i,r,s)}}),e.fn.fitText=function(a){var n=t._O(a)
return this.each(function(a){return function(){var n=e(this),o=n
return a.target&&(o=e(a.target+":first",n)),a.target=o,t.init(a),!1}}(n))},e.printqPxToPT=function(e){return parseFloat((72*parseInt(e)/96).toFixed(2))}}(window.jQuery),!function(e){var t=e.printqFitBgImage=function(){}
e.extend(t,{defaults:{elem:null,image_src:null,image_name:null,preloadBgImage:"#preloadBgImage",onImageLoaded:function(e){},actionType:"preload",noImageContainer:!1,autocenter:!0,uid:null,mask:"#loading-mask",cancelLoading:!1},_O:function(a){return e.extend({},t.defaults,a)},preloadBgImageOld:function(a){var a=t._O(a),n=e.printqUniqueId({prefix:"loading_",sufix:"preloadBgImage",length:6}),o=e("<img/>").attr({src:a.image_src+(isSafari&&t.isLink(a.image_src)?"?t="+e.printqUniqueId({length:10}):"")})
e.q(a.mask).prinqLoading("start",n,{cancelLoading:a.cancelLoading}),o.imagesLoaded().always(function(t,a){return function(n){t.onImageLoaded(n.images[0].img),e.q(t.mask).prinqLoading("stop",a,{cancelLoading:t.cancelLoading})}}(a,n))},preloadBgImage:function(a){var a=t._O(a),n=e.printqUniqueId({prefix:"loading_",sufix:"preloadBgImage",length:6}),o=new Image
o.onload=function(e,t){return function(){e.onImageLoaded(this)}}(a,n),o.onerror=function(e){return function(){"undefined"!=typeof e&&"function"==typeof e.onImageLoadedFailed&&e.onImageLoadedFailed(this)}}(a),o.src=a.image_src,"undefined"===a.loading&&e.q(a.mask).prinqLoading("start",n,{cancelLoading:a.cancelLoading})},fitBgImageToDiv:function(a){var a=t._O(a),n=e.printqUniqueId({prefix:"loading_",sufix:"fitBgImageToDiv",length:6}),o=a.onImageLoaded
e.q(a.mask).prinqLoading("start",n,{cancelLoading:a.cancelLoading}),a.onImageLoaded=function(t,a,n){return function(o){var i=a.elem
if(i.css("background-image",'url("'+a.image_src+'")'),a.autocenter){var r=parseInt(i.width()/o.naturalWidth*100),s=parseInt(i.height()/o.naturalHeight*100),c=parseInt(o.naturalHeight*r/100),l=parseInt(o.naturalWidth*s/100)
c<i.height()?(i.css("background-size","auto "+i.height()+"px"),i.css("background-position","-"+parseInt((l-i.width())/2+.5)+"px 0"),i.data("resizeWidth",!0)):(i.css("background-size",i.width()+"px auto"),i.css("background-position","0 -"+parseInt((c-i.height())/2+.5)+"px"))}else o.naturalWidth<o.naturalHeight?i.css("background-size","auto "+i.height()+"px"):i.css("background-size",i.width()+"px auto"),i.css("background-position","center center")
t(o,a),e.q(a.mask).prinqLoading("stop",n,{cancelLoading:a.cancelLoading})}}(o,a,n),t.preloadBgImage(a)},fitImageToDiv:function(a){var a=t._O(a),n=e.printqUniqueId({prefix:"loading_",sufix:"fitImageToDiv",length:6}),o=a.onImageLoaded
e.q(a.mask).prinqLoading("start",n,{cancelLoading:a.cancelLoading}),a.onImageLoaded=function(t,a,n){return function(o){var i=a.elem,r=!1,s=e(o)
if("undefined"!=typeof a.noImageContainer&&a.noImageContainer)var r=!0
if(r)var c=i.append(s)
else{var c=e("<div />").append(s)
i.prepend(c)}if("undefined"!=typeof a.append_elements&&c.append(a.append_elements),a.autocenter){var l=parseInt(i.width()/o.naturalWidth*100),d=parseInt(i.height()/o.naturalHeight*100),u=parseInt(o.naturalHeight*l/100),g=parseInt(o.naturalWidth*d/100)
u<i.height()?(s.css({width:"auto",height:i.height()+"px",left:"-"+parseInt((g-i.width())/2+.5)+"px",top:0,position:"relative"}),i.data("resizeWidth",!0)):s.css({width:i.width()+"px",height:"auto",left:0,top:"-"+parseInt((u-i.height())/2+.5)+"px",position:"relative"})}else{s.css({"max-width":i.width()+"px","max-height":i.height()+"px",margin:"0 auto"})
var l=parseInt(i.width()/o.naturalWidth*100),d=parseInt(i.height()/o.naturalHeight*100),u=parseInt(o.naturalHeight*l/100),g=parseInt(o.naturalWidth*d/100)
g<=i.width()&&u>=i.height()?s.css({display:"block"}):(s.css({display:"inline-block"}),s.parent().addClass("fit"))}t(s),e.q(a.mask).prinqLoading("stop",n,{cancelLoading:a.cancelLoading})}}(o,a,n),t.preloadBgImage(a)}}),e.fn.printqFitBgImage=function(a){return this.each(function(a){return function(){switch(a.elem=e(this),a.actionType){case"preload":t.preloadBgImage(a)
break
case"fitToDiv":t.fitBgImageToDiv(a)
break
case"fitImageToDiv":t.fitImageToDiv(a)}}}(a))}}(window.jQuery)
var printqPluggable=function(){}
!function(e,t,a){t.PluginHookClass=function(){function e(){this.hooks=t(),this.globalBucket={}}var t=function(){return{afterOpenToolbar:[]}}
return e.prototype.getBucket=function(e){return e?(e.pluginHookBucket||(e.pluginHookBucket={}),e.pluginHookBucket):this.globalBucket},e.prototype.add=function(e,t,a,n){if(Array.isArray(t))for(var o=0,i=t.length;o<i;o++)t[o].triggerInstance=n||null,this.add(e,t[o])
else{var r=this.getBucket(a)
"undefined"==typeof r[e]&&(r[e]=[]),t.skip=!1,t.triggerInstance=n||null,r[e].indexOf(t)==-1?r[e].push(t):console.log(e)}return this},e.prototype.once=function(e,t,a,n){if(Array.isArray(t))for(var o=0,i=t.length;o<i;o++)t[o].runOnce=!0,t[o].triggerInstance=n||null,this.add(e,t[o],a)
else t.runOnce=!0,t.triggerInstance=n||null,this.add(e,t,a)},e.prototype.remove=function(e,t,a){var n=!1,o=this.getBucket(a)
if("undefined"!=typeof o[e])for(var i=0,r=o[e].length;i<r;i++)if(o[e][i]==t){o[e][i].skip=!0,n=!0
break}return n},e.prototype.destroy=function(e){var t=this.getBucket(e)
for(var a in t)if(t.hasOwnProperty(a))for(var n=0,o=t[a].length;n<o;n++)this.remove(a,t[a],e)},e.prototype.run=function(e,t,a,n,o,i,r,s){return a=this._runBucket(this.globalBucket,e,t,a,n,o,i,r,s),a=this._runBucket(this.getBucket(e),e,t,a,n,o,i,r,s)},e.prototype._runBucket=function(e,t,a,n,o,i,r,s,c){var l,d,u,g=e[a]
if(g)for(d=0,u=g.length;d<u;d++)g[d].skip||(l=g[d].call(g[d].triggerInstance||t,n,o,i,r,s,c),void 0!==l&&(n=l),g[d].runOnce&&this.remove(a,g[d],e===this.globalBucket?null:t))
return n},e.prototype.register=function(e){this.isRegistered(e)||(this.hooks[e]=[])},e.prototype.deregister=function(e){delete this.hooks[e]},e.prototype.isRegistered=function(e){return"undefined"!=typeof this.hooks[e]},e.prototype.getRegistered=function(){return Object.keys(this.hooks)},e}(),t.PluginHooks=new t.PluginHookClass}(window,printqPluggable,window.jQuery),window.jQuery(function(e){e("#canvasAreaDesigner").responsiveWidget(),e.designerStartEditor.init(),e(".downloadOptions").downloadWidget(),e.printqUndoRedo.init(),e(".paginationContainer").PagePickerWidget(),e(".paginationPreviewContainer").PagePickerWidgetPreview(),e("#contextMenuCanvasRightClick").objectListSelect(),e("#tdIframe").threedWidget(),e(".sidebar").sidebarWidget(),e.printqSnaptoObject.init(),e.printqPositionBlock.init(),e.printqImageFilters.init(),e.printqDroppable.init(),e.printqTooltip.init(),e.printqImageQuality.init(),e(".printqDefaultToolbar").persDefaultToolbar(),e("#printqEditorToolbar").persTextToolbar(),e("#printqImageEditorToolbar").persImageToolbar(),e("#printqEffectPicker").persEffectPicker(),e("#printqTransparencyPicker").persTransparencyToolbar(),e("#printqSpacingPicker").persSpacingToolbar(),e("#printqLetterSpacingPicker").persLetterSpacingToolbar(),e("#printqRadiusPicker").printqRadiusPicker(),e("#printqLineHeightPicker").persLineHeightToolbar(),e(".mainTabsColorContainer").persColorToolbar(),e(".galleryContainer").baseImageGalleryWidget(),e(".allImagesGallery").localImageBarWidget(),e(".allFacebookAlbums").imageFacebookWidget(),e(".allFacebookAlbumsImages").facebookAlbumsImages(),e(".allInstagramAlbumsImages").instagramAlbumsImages(),e(".scrollerContainer").scrollerDesignerWidget(),e("#editorTopbarContainer").previewWidget(),e(".fontsContainerMobile").printqPositioning(),e(".effectToolBarMobile").printqPositioning(),e(".colorToolBarMobile").printqPositioning(),e(".layoutsContainerMobile").printqPositioning(),e(".backgroundsGallery").unsplashImageGallery(),e(".navbarCenter li").mouseover(function(){e(this).hasClass("active")||e(".navbarCenter ul").find("li.active span").css({width:"0px"})}).mouseleave(function(){e(".navbarCenter ul").find("li.active span").css({width:"100%"})})})
